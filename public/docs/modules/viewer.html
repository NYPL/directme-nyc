<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>viewer.js</title>
  <link rel="stylesheet" href="http://jashkenas.github.com/docco/resources/docco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div id="jump_to">
    Jump To &hellip;
    <div id="jump_wrapper">
      <div id="jump_page">
          <a class="source" href="../app.html">app.js</a>
          <a class="source" href="../main.html">main.js</a>
          <a class="source" href="DV_load.html">DV_load.js</a>
          <a class="source" href="async_tk.html">async_tk.js</a>
          <a class="source" href="map.html">map.js</a>
          <a class="source" href="templates.html">templates.js</a>
          <a class="source" href="viewer.html">viewer.js</a>
          <a class="source" href="ytube.html">ytube.js</a>
      </div>
    </div>
  </div>
  <table cellspacing=0 cellpadding=0>
  <thead>
    <tr>
      <th class=docs><h1>viewer.js</h1></th>
      <th class=code></th>
    </tr>
  </thead>
  <tbody>
    <tr id='section-1'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-1">&#182;</a>
        </div>
        
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="cm">/*!</span>
<span class="cm"> * jQuery UI 1.8.1</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2010 AUTHORS.txt (http://jqueryui.com/about)</span>
<span class="cm"> * Dual licensed under the MIT (MIT-LICENSE.txt)</span>
<span class="cm"> * and GPL (GPL-LICENSE.txt) licenses.</span>
<span class="cm"> *</span>
<span class="cm"> * http://docs.jquery.com/UI</span>
<span class="cm"> */</span>
<span class="nx">jQuery</span><span class="p">.</span><span class="nx">ui</span><span class="o">||</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">){</span><span class="nx">c</span><span class="p">.</span><span class="nx">ui</span><span class="o">=</span><span class="p">{</span><span class="nx">version</span><span class="o">:</span><span class="s2">&quot;1.8.1&quot;</span><span class="p">,</span><span class="nx">plugin</span><span class="o">:</span><span class="p">{</span><span class="nx">add</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">){</span><span class="nx">a</span><span class="o">=</span><span class="nx">c</span><span class="p">.</span><span class="nx">ui</span><span class="p">[</span><span class="nx">a</span><span class="p">].</span><span class="nx">prototype</span><span class="p">;</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">e</span> <span class="k">in</span> <span class="nx">d</span><span class="p">){</span><span class="nx">a</span><span class="p">.</span><span class="nx">plugins</span><span class="p">[</span><span class="nx">e</span><span class="p">]</span><span class="o">=</span><span class="nx">a</span><span class="p">.</span><span class="nx">plugins</span><span class="p">[</span><span class="nx">e</span><span class="p">]</span><span class="o">||</span><span class="p">[];</span><span class="nx">a</span><span class="p">.</span><span class="nx">plugins</span><span class="p">[</span><span class="nx">e</span><span class="p">].</span><span class="nx">push</span><span class="p">([</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">[</span><span class="nx">e</span><span class="p">]])}},</span><span class="nx">call</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">){</span><span class="k">if</span><span class="p">((</span><span class="nx">b</span><span class="o">=</span><span class="nx">a</span><span class="p">.</span><span class="nx">plugins</span><span class="p">[</span><span class="nx">b</span><span class="p">])</span><span class="o">&amp;&amp;</span><span class="nx">a</span><span class="p">.</span><span class="nx">element</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">parentNode</span><span class="p">)</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">e</span><span class="o">&lt;</span><span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">e</span><span class="o">++</span><span class="p">)</span><span class="nx">a</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="nx">b</span><span class="p">[</span><span class="nx">e</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span><span class="o">&amp;&amp;</span><span class="nx">b</span><span class="p">[</span><span class="nx">e</span><span class="p">][</span><span class="mi">1</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">element</span><span class="p">,</span><span class="nx">d</span><span class="p">)}},</span><span class="nx">contains</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">){</span><span class="k">return</span> <span class="nb">document</span><span class="p">.</span><span class="nx">compareDocumentPosition</span><span class="o">?</span><span class="nx">a</span><span class="p">.</span><span class="nx">compareDocumentPosition</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">16</span><span class="o">:</span><span class="nx">a</span><span class="o">!==</span><span class="nx">b</span><span class="o">&amp;&amp;</span><span class="nx">a</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">b</span><span class="p">)},</span><span class="nx">hasScroll</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">c</span><span class="p">(</span><span class="nx">a</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;overflow&quot;</span><span class="p">)</span><span class="o">==</span><span class="s2">&quot;hidden&quot;</span><span class="p">)</span><span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="nx">b</span><span class="o">=</span><span class="nx">b</span><span class="o">&amp;&amp;</span><span class="nx">b</span><span class="o">==</span><span class="s2">&quot;left&quot;</span><span class="o">?</span><span class="s2">&quot;scrollLeft&quot;</span><span class="o">:</span><span class="s2">&quot;scrollTop&quot;</span><span class="p">;</span><span class="kd">var</span> <span class="nx">d</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">b</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="k">return</span> <span class="kc">true</span><span class="p">;</span><span class="nx">a</span><span class="p">[</span><span class="nx">b</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="nx">d</span><span class="o">=</span><span class="nx">a</span><span class="p">[</span><span class="nx">b</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">;</span><span class="nx">a</span><span class="p">[</span><span class="nx">b</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="k">return</span> <span class="nx">d</span><span class="p">},</span><span class="nx">isOverAxis</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">){</span><span class="k">return</span> <span class="nx">a</span><span class="o">&gt;</span><span class="nx">b</span><span class="o">&amp;&amp;</span><span class="nx">a</span><span class="o">&lt;</span><span class="nx">b</span><span class="o">+</span><span class="nx">d</span><span class="p">},</span><span class="nx">isOver</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">f</span><span class="p">,</span><span class="nx">g</span><span class="p">){</span><span class="k">return</span> <span class="nx">c</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">isOverAxis</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">f</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="nx">c</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">isOverAxis</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">g</span><span class="p">)},</span><span class="nx">keyCode</span><span class="o">:</span><span class="p">{</span><span class="nx">ALT</span><span class="o">:</span><span class="mi">18</span><span class="p">,</span><span class="nx">BACKSPACE</span><span class="o">:</span><span class="mi">8</span><span class="p">,</span><span class="nx">CAPS_LOCK</span><span class="o">:</span><span class="mi">20</span><span class="p">,</span><span class="nx">COMMA</span><span class="o">:</span><span class="mi">188</span><span class="p">,</span><span class="nx">CONTROL</span><span class="o">:</span><span class="mi">17</span><span class="p">,</span><span class="nx">DELETE</span><span class="o">:</span><span class="mi">46</span><span class="p">,</span><span class="nx">DOWN</span><span class="o">:</span><span class="mi">40</span><span class="p">,</span><span class="nx">END</span><span class="o">:</span><span class="mi">35</span><span class="p">,</span><span class="nx">ENTER</span><span class="o">:</span><span class="mi">13</span><span class="p">,</span><span class="nx">ESCAPE</span><span class="o">:</span><span class="mi">27</span><span class="p">,</span><span class="nx">HOME</span><span class="o">:</span><span class="mi">36</span><span class="p">,</span><span class="nx">INSERT</span><span class="o">:</span><span class="mi">45</span><span class="p">,</span><span class="nx">LEFT</span><span class="o">:</span><span class="mi">37</span><span class="p">,</span><span class="nx">NUMPAD_ADD</span><span class="o">:</span><span class="mi">107</span><span class="p">,</span><span class="nx">NUMPAD_DECIMAL</span><span class="o">:</span><span class="mi">110</span><span class="p">,</span><span class="nx">NUMPAD_DIVIDE</span><span class="o">:</span><span class="mi">111</span><span class="p">,</span><span class="nx">NUMPAD_ENTER</span><span class="o">:</span><span class="mi">108</span><span class="p">,</span><span class="nx">NUMPAD_MULTIPLY</span><span class="o">:</span><span class="mi">106</span><span class="p">,</span><span class="nx">NUMPAD_SUBTRACT</span><span class="o">:</span><span class="mi">109</span><span class="p">,</span><span class="nx">PAGE_DOWN</span><span class="o">:</span><span class="mi">34</span><span class="p">,</span><span class="nx">PAGE_UP</span><span class="o">:</span><span class="mi">33</span><span class="p">,</span>
<span class="nx">PERIOD</span><span class="o">:</span><span class="mi">190</span><span class="p">,</span><span class="nx">RIGHT</span><span class="o">:</span><span class="mi">39</span><span class="p">,</span><span class="nx">SHIFT</span><span class="o">:</span><span class="mi">16</span><span class="p">,</span><span class="nx">SPACE</span><span class="o">:</span><span class="mi">32</span><span class="p">,</span><span class="nx">TAB</span><span class="o">:</span><span class="mi">9</span><span class="p">,</span><span class="nx">UP</span><span class="o">:</span><span class="mi">38</span><span class="p">}};</span><span class="nx">c</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span><span class="nx">_focus</span><span class="o">:</span><span class="nx">c</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">focus</span><span class="p">,</span><span class="nx">focus</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">){</span><span class="k">return</span> <span class="k">typeof</span> <span class="nx">a</span><span class="o">===</span><span class="s2">&quot;number&quot;</span><span class="o">?</span><span class="k">this</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">d</span><span class="o">=</span><span class="k">this</span><span class="p">;</span><span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="nx">c</span><span class="p">(</span><span class="nx">d</span><span class="p">).</span><span class="nx">focus</span><span class="p">();</span><span class="nx">b</span><span class="o">&amp;&amp;</span><span class="nx">b</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">d</span><span class="p">)},</span><span class="nx">a</span><span class="p">)})</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">_focus</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">arguments</span><span class="p">)},</span><span class="nx">enableSelection</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;unselectable&quot;</span><span class="p">,</span><span class="s2">&quot;off&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;MozUserSelect&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)},</span><span class="nx">disableSelection</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;unselectable&quot;</span><span class="p">,</span><span class="s2">&quot;on&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;MozUserSelect&quot;</span><span class="p">,</span><span class="s2">&quot;none&quot;</span><span class="p">)},</span><span class="nx">scrollParent</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">a</span><span class="p">;</span><span class="nx">a</span><span class="o">=</span><span class="nx">c</span><span class="p">.</span><span class="nx">browser</span><span class="p">.</span><span class="nx">msie</span><span class="o">&amp;&amp;</span><span class="sr">/(static|relative)/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">))</span><span class="o">||</span>
<span class="sr">/absolute/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">))</span><span class="o">?</span><span class="k">this</span><span class="p">.</span><span class="nx">parents</span><span class="p">().</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span><span class="sr">/(relative|absolute|fixed)/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">curCSS</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">&amp;&amp;</span><span class="sr">/(auto|scroll)/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">curCSS</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="s2">&quot;overflow&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="nx">c</span><span class="p">.</span><span class="nx">curCSS</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="s2">&quot;overflow-y&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="nx">c</span><span class="p">.</span><span class="nx">curCSS</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="s2">&quot;overflow-x&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">))}).</span><span class="nx">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">parents</span><span class="p">().</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span><span class="sr">/(auto|scroll)/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">curCSS</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="s2">&quot;overflow&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="nx">c</span><span class="p">.</span><span class="nx">curCSS</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="s2">&quot;overflow-y&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="nx">c</span><span class="p">.</span><span class="nx">curCSS</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="s2">&quot;overflow-x&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">))}).</span><span class="nx">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="k">return</span><span class="sr">/fixed/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">))</span><span class="o">||!</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="o">?</span><span class="nx">c</span><span class="p">(</span><span class="nb">document</span><span class="p">)</span><span class="o">:</span><span class="nx">a</span><span class="p">},</span><span class="nx">zIndex</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="o">!==</span>
<span class="kc">undefined</span><span class="p">)</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;zIndex&quot;</span><span class="p">,</span><span class="nx">a</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">length</span><span class="p">){</span><span class="nx">a</span><span class="o">=</span><span class="nx">c</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">b</span><span class="p">;</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="o">&amp;&amp;</span><span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!==</span><span class="nb">document</span><span class="p">;){</span><span class="nx">b</span><span class="o">=</span><span class="nx">a</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">b</span><span class="o">==</span><span class="s2">&quot;absolute&quot;</span><span class="o">||</span><span class="nx">b</span><span class="o">==</span><span class="s2">&quot;relative&quot;</span><span class="o">||</span><span class="nx">b</span><span class="o">==</span><span class="s2">&quot;fixed&quot;</span><span class="p">){</span><span class="nx">b</span><span class="o">=</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;zIndex&quot;</span><span class="p">));</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="nx">b</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span><span class="k">return</span> <span class="nx">b</span><span class="p">}</span><span class="nx">a</span><span class="o">=</span><span class="nx">a</span><span class="p">.</span><span class="nx">parent</span><span class="p">()}}</span><span class="k">return</span> <span class="mi">0</span><span class="p">}});</span><span class="nx">c</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">expr</span><span class="p">[</span><span class="s2">&quot;:&quot;</span><span class="p">],{</span><span class="nx">data</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">){</span><span class="k">return</span><span class="o">!!</span><span class="nx">c</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">d</span><span class="p">[</span><span class="mi">3</span><span class="p">])},</span><span class="nx">focusable</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">){</span><span class="kd">var</span> <span class="nx">b</span><span class="o">=</span><span class="nx">a</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">(),</span><span class="nx">d</span><span class="o">=</span><span class="nx">c</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="s2">&quot;tabindex&quot;</span><span class="p">);</span><span class="k">return</span><span class="p">(</span><span class="sr">/input|select|textarea|button|object/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span><span class="o">?!</span><span class="nx">a</span><span class="p">.</span><span class="nx">disabled</span><span class="o">:</span><span class="s2">&quot;a&quot;</span><span class="o">==</span><span class="nx">b</span><span class="o">||</span><span class="s2">&quot;area&quot;</span><span class="o">==</span><span class="nx">b</span><span class="o">?</span><span class="nx">a</span><span class="p">.</span><span class="nx">href</span><span class="o">||!</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span><span class="o">:!</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">d</span><span class="p">))</span><span class="o">&amp;&amp;</span>
<span class="o">!</span><span class="nx">c</span><span class="p">(</span><span class="nx">a</span><span class="p">)[</span><span class="s2">&quot;area&quot;</span><span class="o">==</span><span class="nx">b</span><span class="o">?</span><span class="s2">&quot;parents&quot;</span><span class="o">:</span><span class="s2">&quot;closest&quot;</span><span class="p">](</span><span class="s2">&quot;:hidden&quot;</span><span class="p">).</span><span class="nx">length</span><span class="p">},</span><span class="nx">tabbable</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">){</span><span class="kd">var</span> <span class="nx">b</span><span class="o">=</span><span class="nx">c</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="s2">&quot;tabindex&quot;</span><span class="p">);</span><span class="k">return</span><span class="p">(</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span><span class="o">||</span><span class="nx">b</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="nx">c</span><span class="p">(</span><span class="nx">a</span><span class="p">).</span><span class="nx">is</span><span class="p">(</span><span class="s2">&quot;:focusable&quot;</span><span class="p">)}})}(</span><span class="nx">jQuery</span><span class="p">);</span>
<span class="p">;</span><span class="cm">/*!</span>
<span class="cm"> * jQuery UI Widget 1.8.1</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2010 AUTHORS.txt (http://jqueryui.com/about)</span>
<span class="cm"> * Dual licensed under the MIT (MIT-LICENSE.txt)</span>
<span class="cm"> * and GPL (GPL-LICENSE.txt) licenses.</span>
<span class="cm"> *</span>
<span class="cm"> * http://docs.jquery.com/UI/Widget</span>
<span class="cm"> */</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">b</span><span class="p">){</span><span class="kd">var</span> <span class="nx">j</span><span class="o">=</span><span class="nx">b</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">remove</span><span class="p">;</span><span class="nx">b</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">remove</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">c</span><span class="p">){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">c</span><span class="p">)</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">a</span><span class="o">||</span><span class="nx">b</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">a</span><span class="p">,[</span><span class="k">this</span><span class="p">]).</span><span class="nx">length</span><span class="p">)</span><span class="nx">b</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="nx">b</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">triggerHandler</span><span class="p">(</span><span class="s2">&quot;remove&quot;</span><span class="p">)});</span><span class="k">return</span> <span class="nx">j</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">b</span><span class="p">(</span><span class="k">this</span><span class="p">),</span><span class="nx">a</span><span class="p">,</span><span class="nx">c</span><span class="p">)})};</span><span class="nx">b</span><span class="p">.</span><span class="nx">widget</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">c</span><span class="p">,</span><span class="nx">d</span><span class="p">){</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="nx">a</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="nx">f</span><span class="p">;</span><span class="nx">a</span><span class="o">=</span><span class="nx">a</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span><span class="nx">f</span><span class="o">=</span><span class="nx">e</span><span class="o">+</span><span class="s2">&quot;-&quot;</span><span class="o">+</span><span class="nx">a</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">d</span><span class="p">){</span><span class="nx">d</span><span class="o">=</span><span class="nx">c</span><span class="p">;</span><span class="nx">c</span><span class="o">=</span><span class="nx">b</span><span class="p">.</span><span class="nx">Widget</span><span class="p">}</span><span class="nx">b</span><span class="p">.</span><span class="nx">expr</span><span class="p">[</span><span class="s2">&quot;:&quot;</span><span class="p">][</span><span class="nx">f</span><span class="p">]</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">h</span><span class="p">){</span><span class="k">return</span><span class="o">!!</span><span class="nx">b</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">h</span><span class="p">,</span><span class="nx">a</span><span class="p">)};</span><span class="nx">b</span><span class="p">[</span><span class="nx">e</span><span class="p">]</span><span class="o">=</span><span class="nx">b</span><span class="p">[</span><span class="nx">e</span><span class="p">]</span><span class="o">||</span><span class="p">{};</span><span class="nx">b</span><span class="p">[</span><span class="nx">e</span><span class="p">][</span><span class="nx">a</span><span class="p">]</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">h</span><span class="p">,</span><span class="nx">g</span><span class="p">){</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">_createWidget</span><span class="p">(</span><span class="nx">h</span><span class="p">,</span><span class="nx">g</span><span class="p">)};</span><span class="nx">c</span><span class="o">=</span><span class="k">new</span> <span class="nx">c</span><span class="p">;</span><span class="nx">c</span><span class="p">.</span><span class="nx">options</span><span class="o">=</span><span class="nx">b</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span><span class="nx">c</span><span class="p">.</span><span class="nx">options</span><span class="p">);</span><span class="nx">b</span><span class="p">[</span><span class="nx">e</span><span class="p">][</span><span class="nx">a</span><span class="p">].</span><span class="nx">prototype</span><span class="o">=</span>
<span class="nx">b</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span><span class="nx">c</span><span class="p">,{</span><span class="nx">namespace</span><span class="o">:</span><span class="nx">e</span><span class="p">,</span><span class="nx">widgetName</span><span class="o">:</span><span class="nx">a</span><span class="p">,</span><span class="nx">widgetEventPrefix</span><span class="o">:</span><span class="nx">b</span><span class="p">[</span><span class="nx">e</span><span class="p">][</span><span class="nx">a</span><span class="p">].</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">widgetEventPrefix</span><span class="o">||</span><span class="nx">a</span><span class="p">,</span><span class="nx">widgetBaseClass</span><span class="o">:</span><span class="nx">f</span><span class="p">},</span><span class="nx">d</span><span class="p">);</span><span class="nx">b</span><span class="p">.</span><span class="nx">widget</span><span class="p">.</span><span class="nx">bridge</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">[</span><span class="nx">e</span><span class="p">][</span><span class="nx">a</span><span class="p">])};</span><span class="nx">b</span><span class="p">.</span><span class="nx">widget</span><span class="p">.</span><span class="nx">bridge</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">c</span><span class="p">){</span><span class="nx">b</span><span class="p">.</span><span class="nx">fn</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">){</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="k">typeof</span> <span class="nx">d</span><span class="o">===</span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="nx">f</span><span class="o">=</span><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="nx">h</span><span class="o">=</span><span class="k">this</span><span class="p">;</span><span class="nx">d</span><span class="o">=!</span><span class="nx">e</span><span class="o">&amp;&amp;</span><span class="nx">f</span><span class="p">.</span><span class="nx">length</span><span class="o">?</span><span class="nx">b</span><span class="p">.</span><span class="nx">extend</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,[</span><span class="kc">true</span><span class="p">,</span><span class="nx">d</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">f</span><span class="p">))</span><span class="o">:</span><span class="nx">d</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">e</span><span class="o">&amp;&amp;</span><span class="nx">d</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">===</span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="k">return</span> <span class="nx">h</span><span class="p">;</span><span class="nx">e</span><span class="o">?</span><span class="k">this</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">g</span><span class="o">=</span><span class="nx">b</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">a</span><span class="p">),</span><span class="nx">i</span><span class="o">=</span><span class="nx">g</span><span class="o">&amp;&amp;</span><span class="nx">b</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">g</span><span class="p">[</span><span class="nx">d</span><span class="p">])</span><span class="o">?</span><span class="nx">g</span><span class="p">[</span><span class="nx">d</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="nx">g</span><span class="p">,</span><span class="nx">f</span><span class="p">)</span><span class="o">:</span><span class="nx">g</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="o">!==</span><span class="nx">g</span><span class="o">&amp;&amp;</span><span class="nx">i</span><span class="o">!==</span><span class="kc">undefined</span><span class="p">){</span><span class="nx">h</span><span class="o">=</span><span class="nx">i</span><span class="p">;</span><span class="k">return</span> <span class="kc">false</span><span class="p">}})</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">g</span><span class="o">=</span>
<span class="nx">b</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">a</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">g</span><span class="p">){</span><span class="nx">d</span><span class="o">&amp;&amp;</span><span class="nx">g</span><span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span><span class="nx">g</span><span class="p">.</span><span class="nx">_init</span><span class="p">()}</span><span class="k">else</span> <span class="nx">b</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="k">new</span> <span class="nx">c</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="k">this</span><span class="p">))});</span><span class="k">return</span> <span class="nx">h</span><span class="p">}};</span><span class="nx">b</span><span class="p">.</span><span class="nx">Widget</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">c</span><span class="p">){</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">_createWidget</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">c</span><span class="p">)};</span><span class="nx">b</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">prototype</span><span class="o">=</span><span class="p">{</span><span class="nx">widgetName</span><span class="o">:</span><span class="s2">&quot;widget&quot;</span><span class="p">,</span><span class="nx">widgetEventPrefix</span><span class="o">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="nx">options</span><span class="o">:</span><span class="p">{</span><span class="nx">disabled</span><span class="o">:</span><span class="kc">false</span><span class="p">},</span><span class="nx">_createWidget</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">c</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="o">=</span><span class="nx">b</span><span class="p">(</span><span class="nx">c</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">widgetName</span><span class="p">,</span><span class="k">this</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="o">=</span><span class="nx">b</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="p">,{},</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">,</span><span class="nx">b</span><span class="p">.</span><span class="nx">metadata</span><span class="o">&amp;&amp;</span><span class="nx">b</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">c</span><span class="p">)[</span><span class="k">this</span><span class="p">.</span><span class="nx">widgetName</span><span class="p">],</span><span class="nx">a</span><span class="p">);</span><span class="kd">var</span> <span class="nx">d</span><span class="o">=</span><span class="k">this</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;remove.&quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">widgetName</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span><span class="nx">d</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()});</span><span class="k">this</span><span class="p">.</span><span class="nx">_create</span><span class="p">();</span>
<span class="k">this</span><span class="p">.</span><span class="nx">_init</span><span class="p">()},</span><span class="nx">_create</span><span class="o">:</span><span class="kd">function</span><span class="p">(){},</span><span class="nx">_init</span><span class="o">:</span><span class="kd">function</span><span class="p">(){},</span><span class="nx">destroy</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">widgetName</span><span class="p">).</span><span class="nx">removeData</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">widgetName</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">widget</span><span class="p">().</span><span class="nx">unbind</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">widgetName</span><span class="p">).</span><span class="nx">removeAttr</span><span class="p">(</span><span class="s2">&quot;aria-disabled&quot;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">widgetBaseClass</span><span class="o">+</span><span class="s2">&quot;-disabled ui-state-disabled&quot;</span><span class="p">)},</span><span class="nx">widget</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">},</span><span class="nx">option</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">c</span><span class="p">){</span><span class="kd">var</span> <span class="nx">d</span><span class="o">=</span><span class="nx">a</span><span class="p">,</span><span class="nx">e</span><span class="o">=</span><span class="k">this</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span><span class="k">return</span> <span class="nx">b</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span><span class="nx">e</span><span class="p">.</span><span class="nx">options</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">a</span><span class="o">===</span><span class="s2">&quot;string&quot;</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">c</span><span class="o">===</span><span class="kc">undefined</span><span class="p">)</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="nx">a</span><span class="p">];</span><span class="nx">d</span><span class="o">=</span><span class="p">{};</span><span class="nx">d</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span><span class="o">=</span><span class="nx">c</span><span class="p">}</span><span class="nx">b</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span>
<span class="nx">h</span><span class="p">){</span><span class="nx">e</span><span class="p">.</span><span class="nx">_setOption</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span><span class="nx">h</span><span class="p">)});</span><span class="k">return</span> <span class="nx">e</span><span class="p">},</span><span class="nx">_setOption</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">c</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span><span class="o">=</span><span class="nx">c</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="o">===</span><span class="s2">&quot;disabled&quot;</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">widget</span><span class="p">()[</span><span class="nx">c</span><span class="o">?</span><span class="s2">&quot;addClass&quot;</span><span class="o">:</span><span class="s2">&quot;removeClass&quot;</span><span class="p">](</span><span class="k">this</span><span class="p">.</span><span class="nx">widgetBaseClass</span><span class="o">+</span><span class="s2">&quot;-disabled ui-state-disabled&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;aria-disabled&quot;</span><span class="p">,</span><span class="nx">c</span><span class="p">);</span><span class="k">return</span> <span class="k">this</span><span class="p">},</span><span class="nx">enable</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_setOption</span><span class="p">(</span><span class="s2">&quot;disabled&quot;</span><span class="p">,</span><span class="kc">false</span><span class="p">)},</span><span class="nx">disable</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_setOption</span><span class="p">(</span><span class="s2">&quot;disabled&quot;</span><span class="p">,</span><span class="kc">true</span><span class="p">)},</span><span class="nx">_trigger</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">c</span><span class="p">,</span><span class="nx">d</span><span class="p">){</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="nx">a</span><span class="p">];</span><span class="nx">c</span><span class="o">=</span><span class="nx">b</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="nx">c</span><span class="p">);</span><span class="nx">c</span><span class="p">.</span><span class="nx">type</span><span class="o">=</span><span class="p">(</span><span class="nx">a</span><span class="o">===</span><span class="k">this</span><span class="p">.</span><span class="nx">widgetEventPrefix</span><span class="o">?</span><span class="nx">a</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">widgetEventPrefix</span><span class="o">+</span><span class="nx">a</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">();</span><span class="nx">d</span><span class="o">=</span><span class="nx">d</span><span class="o">||</span><span class="p">{};</span><span class="k">if</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">originalEvent</span><span class="p">){</span><span class="nx">a</span><span class="o">=</span>
<span class="nx">b</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">f</span><span class="p">;</span><span class="nx">a</span><span class="p">;){</span><span class="nx">f</span><span class="o">=</span><span class="nx">b</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">props</span><span class="p">[</span><span class="o">--</span><span class="nx">a</span><span class="p">];</span><span class="nx">c</span><span class="p">[</span><span class="nx">f</span><span class="p">]</span><span class="o">=</span><span class="nx">c</span><span class="p">.</span><span class="nx">originalEvent</span><span class="p">[</span><span class="nx">f</span><span class="p">]}}</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">d</span><span class="p">);</span><span class="k">return</span><span class="o">!</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="nx">e</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nx">c</span><span class="p">,</span><span class="nx">d</span><span class="p">)</span><span class="o">===</span><span class="kc">false</span><span class="o">||</span><span class="nx">c</span><span class="p">.</span><span class="nx">isDefaultPrevented</span><span class="p">())}}})(</span><span class="nx">jQuery</span><span class="p">);</span>
<span class="p">;</span><span class="cm">/*!</span>
<span class="cm"> * jQuery UI Mouse 1.8.1</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2010 AUTHORS.txt (http://jqueryui.com/about)</span>
<span class="cm"> * Dual licensed under the MIT (MIT-LICENSE.txt)</span>
<span class="cm"> * and GPL (GPL-LICENSE.txt) licenses.</span>
<span class="cm"> *</span>
<span class="cm"> * http://docs.jquery.com/UI/Mouse</span>
<span class="cm"> *</span>
<span class="cm"> * Depends:</span>
<span class="cm"> *	jquery.ui.widget.js</span>
<span class="cm"> */</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">){</span><span class="nx">c</span><span class="p">.</span><span class="nx">widget</span><span class="p">(</span><span class="s2">&quot;ui.mouse&quot;</span><span class="p">,{</span><span class="nx">options</span><span class="o">:</span><span class="p">{</span><span class="nx">cancel</span><span class="o">:</span><span class="s2">&quot;:input,option&quot;</span><span class="p">,</span><span class="nx">distance</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">delay</span><span class="o">:</span><span class="mi">0</span><span class="p">},</span><span class="nx">_mouseInit</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">a</span><span class="o">=</span><span class="k">this</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;mousedown.&quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">widgetName</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">b</span><span class="p">){</span><span class="k">return</span> <span class="nx">a</span><span class="p">.</span><span class="nx">_mouseDown</span><span class="p">(</span><span class="nx">b</span><span class="p">)}).</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;click.&quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">widgetName</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">b</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">_preventClickEvent</span><span class="p">){</span><span class="nx">a</span><span class="p">.</span><span class="nx">_preventClickEvent</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span><span class="nx">b</span><span class="p">.</span><span class="nx">stopImmediatePropagation</span><span class="p">();</span><span class="k">return</span> <span class="kc">false</span><span class="p">}});</span><span class="k">this</span><span class="p">.</span><span class="nx">started</span><span class="o">=</span><span class="kc">false</span><span class="p">},</span><span class="nx">_mouseDestroy</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">widgetName</span><span class="p">)},</span><span class="nx">_mouseDown</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">){</span><span class="nx">a</span><span class="p">.</span><span class="nx">originalEvent</span><span class="o">=</span><span class="nx">a</span><span class="p">.</span><span class="nx">originalEvent</span><span class="o">||</span><span class="p">{};</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">a</span><span class="p">.</span><span class="nx">originalEvent</span><span class="p">.</span><span class="nx">mouseHandled</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseStarted</span><span class="o">&amp;&amp;</span>
<span class="k">this</span><span class="p">.</span><span class="nx">_mouseUp</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseDownEvent</span><span class="o">=</span><span class="nx">a</span><span class="p">;</span><span class="kd">var</span> <span class="nx">b</span><span class="o">=</span><span class="k">this</span><span class="p">,</span><span class="nx">e</span><span class="o">=</span><span class="nx">a</span><span class="p">.</span><span class="nx">which</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span><span class="nx">f</span><span class="o">=</span><span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">cancel</span><span class="o">==</span><span class="s2">&quot;string&quot;</span><span class="o">?</span><span class="nx">c</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">parents</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">filter</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">cancel</span><span class="p">).</span><span class="nx">length</span><span class="o">:</span><span class="kc">false</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">e</span><span class="o">||</span><span class="nx">f</span><span class="o">||!</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseCapture</span><span class="p">(</span><span class="nx">a</span><span class="p">))</span><span class="k">return</span> <span class="kc">true</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">mouseDelayMet</span><span class="o">=!</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">delay</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">mouseDelayMet</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseDelayTimer</span><span class="o">=</span><span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="nx">b</span><span class="p">.</span><span class="nx">mouseDelayMet</span><span class="o">=</span><span class="kc">true</span><span class="p">},</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">delay</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseDistanceMet</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseDelayMet</span><span class="p">(</span><span class="nx">a</span><span class="p">)){</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseStarted</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseStart</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span><span class="o">!==</span><span class="kc">false</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseStarted</span><span class="p">){</span><span class="nx">a</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
<span class="k">return</span> <span class="kc">true</span><span class="p">}}</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseMoveDelegate</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">){</span><span class="k">return</span> <span class="nx">b</span><span class="p">.</span><span class="nx">_mouseMove</span><span class="p">(</span><span class="nx">d</span><span class="p">)};</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseUpDelegate</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">){</span><span class="k">return</span> <span class="nx">b</span><span class="p">.</span><span class="nx">_mouseUp</span><span class="p">(</span><span class="nx">d</span><span class="p">)};</span><span class="nx">c</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;mousemove.&quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">widgetName</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseMoveDelegate</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;mouseup.&quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">widgetName</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseUpDelegate</span><span class="p">);</span><span class="nx">c</span><span class="p">.</span><span class="nx">browser</span><span class="p">.</span><span class="nx">safari</span><span class="o">||</span><span class="nx">a</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span><span class="k">return</span> <span class="nx">a</span><span class="p">.</span><span class="nx">originalEvent</span><span class="p">.</span><span class="nx">mouseHandled</span><span class="o">=</span><span class="kc">true</span><span class="p">}},</span><span class="nx">_mouseMove</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">browser</span><span class="p">.</span><span class="nx">msie</span><span class="o">&amp;&amp;!</span><span class="nx">a</span><span class="p">.</span><span class="nx">button</span><span class="p">)</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_mouseUp</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseStarted</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseDrag</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span><span class="k">return</span> <span class="nx">a</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()}</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseDistanceMet</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span><span class="o">&amp;&amp;</span>
<span class="k">this</span><span class="p">.</span><span class="nx">_mouseDelayMet</span><span class="p">(</span><span class="nx">a</span><span class="p">))(</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseStarted</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseStart</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseDownEvent</span><span class="p">,</span><span class="nx">a</span><span class="p">)</span><span class="o">!==</span><span class="kc">false</span><span class="p">)</span><span class="o">?</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseDrag</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseUp</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span><span class="k">return</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseStarted</span><span class="p">},</span><span class="nx">_mouseUp</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">){</span><span class="nx">c</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">unbind</span><span class="p">(</span><span class="s2">&quot;mousemove.&quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">widgetName</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseMoveDelegate</span><span class="p">).</span><span class="nx">unbind</span><span class="p">(</span><span class="s2">&quot;mouseup.&quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">widgetName</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseUpDelegate</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseStarted</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseStarted</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">_preventClickEvent</span><span class="o">=</span><span class="nx">a</span><span class="p">.</span><span class="nx">target</span><span class="o">==</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseDownEvent</span><span class="p">.</span><span class="nx">target</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseStop</span><span class="p">(</span><span class="nx">a</span><span class="p">)}</span><span class="k">return</span> <span class="kc">false</span><span class="p">},</span><span class="nx">_mouseDistanceMet</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">){</span><span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseDownEvent</span><span class="p">.</span><span class="nx">pageX</span><span class="o">-</span>
<span class="nx">a</span><span class="p">.</span><span class="nx">pageX</span><span class="p">),</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseDownEvent</span><span class="p">.</span><span class="nx">pageY</span><span class="o">-</span><span class="nx">a</span><span class="p">.</span><span class="nx">pageY</span><span class="p">))</span><span class="o">&gt;=</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">distance</span><span class="p">},</span><span class="nx">_mouseDelayMet</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">mouseDelayMet</span><span class="p">},</span><span class="nx">_mouseStart</span><span class="o">:</span><span class="kd">function</span><span class="p">(){},</span><span class="nx">_mouseDrag</span><span class="o">:</span><span class="kd">function</span><span class="p">(){},</span><span class="nx">_mouseStop</span><span class="o">:</span><span class="kd">function</span><span class="p">(){},</span><span class="nx">_mouseCapture</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="kc">true</span><span class="p">}})})(</span><span class="nx">jQuery</span><span class="p">);</span>
<span class="p">;</span><span class="cm">/*</span>
<span class="cm"> * jQuery UI Position 1.8.1</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2010 AUTHORS.txt (http://jqueryui.com/about)</span>
<span class="cm"> * Dual licensed under the MIT (MIT-LICENSE.txt)</span>
<span class="cm"> * and GPL (GPL-LICENSE.txt) licenses.</span>
<span class="cm"> *</span>
<span class="cm"> * http://docs.jquery.com/UI/Position</span>
<span class="cm"> */</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">){</span><span class="nx">c</span><span class="p">.</span><span class="nx">ui</span><span class="o">=</span><span class="nx">c</span><span class="p">.</span><span class="nx">ui</span><span class="o">||</span><span class="p">{};</span><span class="kd">var</span> <span class="nx">m</span><span class="o">=</span><span class="sr">/left|center|right/</span><span class="p">,</span><span class="nx">n</span><span class="o">=</span><span class="sr">/top|center|bottom/</span><span class="p">,</span><span class="nx">p</span><span class="o">=</span><span class="nx">c</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">position</span><span class="p">,</span><span class="nx">q</span><span class="o">=</span><span class="nx">c</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">offset</span><span class="p">;</span><span class="nx">c</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">position</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">a</span><span class="o">||!</span><span class="nx">a</span><span class="p">.</span><span class="nx">of</span><span class="p">)</span><span class="k">return</span> <span class="nx">p</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">arguments</span><span class="p">);</span><span class="nx">a</span><span class="o">=</span><span class="nx">c</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span><span class="nx">a</span><span class="p">);</span><span class="kd">var</span> <span class="nx">b</span><span class="o">=</span><span class="nx">c</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">of</span><span class="p">),</span><span class="nx">d</span><span class="o">=</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">collision</span><span class="o">||</span><span class="s2">&quot;flip&quot;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span><span class="nx">e</span><span class="o">=</span><span class="nx">a</span><span class="p">.</span><span class="nx">offset</span><span class="o">?</span><span class="nx">a</span><span class="p">.</span><span class="nx">offset</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">:</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="nx">g</span><span class="p">,</span><span class="nx">h</span><span class="p">,</span><span class="nx">i</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">of</span><span class="p">.</span><span class="nx">nodeType</span><span class="o">===</span><span class="mi">9</span><span class="p">){</span><span class="nx">g</span><span class="o">=</span><span class="nx">b</span><span class="p">.</span><span class="nx">width</span><span class="p">();</span><span class="nx">h</span><span class="o">=</span><span class="nx">b</span><span class="p">.</span><span class="nx">height</span><span class="p">();</span><span class="nx">i</span><span class="o">=</span><span class="p">{</span><span class="nx">top</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="nx">left</span><span class="o">:</span><span class="mi">0</span><span class="p">}}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">of</span><span class="p">.</span><span class="nx">scrollTo</span><span class="o">&amp;&amp;</span><span class="nx">a</span><span class="p">.</span><span class="nx">of</span><span class="p">.</span><span class="nb">document</span><span class="p">){</span><span class="nx">g</span><span class="o">=</span><span class="nx">b</span><span class="p">.</span><span class="nx">width</span><span class="p">();</span><span class="nx">h</span><span class="o">=</span><span class="nx">b</span><span class="p">.</span><span class="nx">height</span><span class="p">();</span><span class="nx">i</span><span class="o">=</span><span class="p">{</span><span class="nx">top</span><span class="o">:</span><span class="nx">b</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">(),</span><span class="nx">left</span><span class="o">:</span><span class="nx">b</span><span class="p">.</span><span class="nx">scrollLeft</span><span class="p">()}}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">of</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">){</span><span class="nx">a</span><span class="p">.</span><span class="nx">at</span><span class="o">=</span><span class="s2">&quot;left top&quot;</span><span class="p">;</span><span class="nx">g</span><span class="o">=</span><span class="nx">h</span><span class="o">=</span>
<span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">=</span><span class="p">{</span><span class="nx">top</span><span class="o">:</span><span class="nx">a</span><span class="p">.</span><span class="nx">of</span><span class="p">.</span><span class="nx">pageY</span><span class="p">,</span><span class="nx">left</span><span class="o">:</span><span class="nx">a</span><span class="p">.</span><span class="nx">of</span><span class="p">.</span><span class="nx">pageX</span><span class="p">}}</span><span class="k">else</span><span class="p">{</span><span class="nx">g</span><span class="o">=</span><span class="nx">b</span><span class="p">.</span><span class="nx">outerWidth</span><span class="p">();</span><span class="nx">h</span><span class="o">=</span><span class="nx">b</span><span class="p">.</span><span class="nx">outerHeight</span><span class="p">();</span><span class="nx">i</span><span class="o">=</span><span class="nx">b</span><span class="p">.</span><span class="nx">offset</span><span class="p">()}</span><span class="nx">c</span><span class="p">.</span><span class="nx">each</span><span class="p">([</span><span class="s2">&quot;my&quot;</span><span class="p">,</span><span class="s2">&quot;at&quot;</span><span class="p">],</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">f</span><span class="o">=</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="k">this</span><span class="p">]</span><span class="o">||</span><span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">1</span><span class="p">)</span><span class="nx">f</span><span class="o">=</span><span class="nx">m</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">f</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">?</span><span class="nx">f</span><span class="p">.</span><span class="nx">concat</span><span class="p">([</span><span class="s2">&quot;center&quot;</span><span class="p">])</span><span class="o">:</span><span class="nx">n</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">f</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">?</span><span class="p">[</span><span class="s2">&quot;center&quot;</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;center&quot;</span><span class="p">,</span><span class="s2">&quot;center&quot;</span><span class="p">];</span><span class="nx">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="nx">m</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">f</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">?</span><span class="nx">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">:</span><span class="s2">&quot;center&quot;</span><span class="p">;</span><span class="nx">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="nx">n</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">f</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">?</span><span class="nx">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">:</span><span class="s2">&quot;center&quot;</span><span class="p">;</span><span class="nx">a</span><span class="p">[</span><span class="k">this</span><span class="p">]</span><span class="o">=</span><span class="nx">f</span><span class="p">});</span><span class="k">if</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">1</span><span class="p">)</span><span class="nx">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="nx">d</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="nx">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">e</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">10</span><span class="p">)</span><span class="o">||</span><span class="mi">0</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">1</span><span class="p">)</span><span class="nx">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="nx">e</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="nx">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">e</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">10</span><span class="p">)</span><span class="o">||</span><span class="mi">0</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">at</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">===</span><span class="s2">&quot;right&quot;</span><span class="p">)</span><span class="nx">i</span><span class="p">.</span><span class="nx">left</span><span class="o">+=</span><span class="nx">g</span><span class="p">;</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">at</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">===</span><span class="s2">&quot;center&quot;</span><span class="p">)</span><span class="nx">i</span><span class="p">.</span><span class="nx">left</span><span class="o">+=</span>
<span class="nx">g</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">at</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">===</span><span class="s2">&quot;bottom&quot;</span><span class="p">)</span><span class="nx">i</span><span class="p">.</span><span class="nx">top</span><span class="o">+=</span><span class="nx">h</span><span class="p">;</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">at</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">===</span><span class="s2">&quot;center&quot;</span><span class="p">)</span><span class="nx">i</span><span class="p">.</span><span class="nx">top</span><span class="o">+=</span><span class="nx">h</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span><span class="nx">i</span><span class="p">.</span><span class="nx">left</span><span class="o">+=</span><span class="nx">e</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="nx">i</span><span class="p">.</span><span class="nx">top</span><span class="o">+=</span><span class="nx">e</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">f</span><span class="o">=</span><span class="nx">c</span><span class="p">(</span><span class="k">this</span><span class="p">),</span><span class="nx">k</span><span class="o">=</span><span class="nx">f</span><span class="p">.</span><span class="nx">outerWidth</span><span class="p">(),</span><span class="nx">l</span><span class="o">=</span><span class="nx">f</span><span class="p">.</span><span class="nx">outerHeight</span><span class="p">(),</span><span class="nx">j</span><span class="o">=</span><span class="nx">c</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span><span class="nx">i</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">my</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">===</span><span class="s2">&quot;right&quot;</span><span class="p">)</span><span class="nx">j</span><span class="p">.</span><span class="nx">left</span><span class="o">-=</span><span class="nx">k</span><span class="p">;</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">my</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">===</span><span class="s2">&quot;center&quot;</span><span class="p">)</span><span class="nx">j</span><span class="p">.</span><span class="nx">left</span><span class="o">-=</span><span class="nx">k</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">my</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">===</span><span class="s2">&quot;bottom&quot;</span><span class="p">)</span><span class="nx">j</span><span class="p">.</span><span class="nx">top</span><span class="o">-=</span><span class="nx">l</span><span class="p">;</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">my</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">===</span><span class="s2">&quot;center&quot;</span><span class="p">)</span><span class="nx">j</span><span class="p">.</span><span class="nx">top</span><span class="o">-=</span><span class="nx">l</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span><span class="nx">j</span><span class="p">.</span><span class="nx">left</span><span class="o">=</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">j</span><span class="p">.</span><span class="nx">left</span><span class="p">);</span><span class="nx">j</span><span class="p">.</span><span class="nx">top</span><span class="o">=</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">j</span><span class="p">.</span><span class="nx">top</span><span class="p">);</span><span class="nx">c</span><span class="p">.</span><span class="nx">each</span><span class="p">([</span><span class="s2">&quot;left&quot;</span><span class="p">,</span><span class="s2">&quot;top&quot;</span><span class="p">],</span><span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span><span class="nx">r</span><span class="p">){</span><span class="nx">c</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">position</span><span class="p">[</span><span class="nx">d</span><span class="p">[</span><span class="nx">o</span><span class="p">]]</span><span class="o">&amp;&amp;</span><span class="nx">c</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">position</span><span class="p">[</span><span class="nx">d</span><span class="p">[</span><span class="nx">o</span><span class="p">]][</span><span class="nx">r</span><span class="p">](</span><span class="nx">j</span><span class="p">,{</span><span class="nx">targetWidth</span><span class="o">:</span><span class="nx">g</span><span class="p">,</span><span class="nx">targetHeight</span><span class="o">:</span><span class="nx">h</span><span class="p">,</span><span class="nx">elemWidth</span><span class="o">:</span><span class="nx">k</span><span class="p">,</span>
<span class="nx">elemHeight</span><span class="o">:</span><span class="nx">l</span><span class="p">,</span><span class="nx">offset</span><span class="o">:</span><span class="nx">e</span><span class="p">,</span><span class="nx">my</span><span class="o">:</span><span class="nx">a</span><span class="p">.</span><span class="nx">my</span><span class="p">,</span><span class="nx">at</span><span class="o">:</span><span class="nx">a</span><span class="p">.</span><span class="nx">at</span><span class="p">})});</span><span class="nx">c</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">bgiframe</span><span class="o">&amp;&amp;</span><span class="nx">f</span><span class="p">.</span><span class="nx">bgiframe</span><span class="p">();</span><span class="nx">f</span><span class="p">.</span><span class="nx">offset</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">j</span><span class="p">,{</span><span class="nx">using</span><span class="o">:</span><span class="nx">a</span><span class="p">.</span><span class="nx">using</span><span class="p">}))})};</span><span class="nx">c</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">position</span><span class="o">=</span><span class="p">{</span><span class="nx">fit</span><span class="o">:</span><span class="p">{</span><span class="nx">left</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">){</span><span class="kd">var</span> <span class="nx">d</span><span class="o">=</span><span class="nx">c</span><span class="p">(</span><span class="nb">window</span><span class="p">);</span><span class="nx">b</span><span class="o">=</span><span class="nx">a</span><span class="p">.</span><span class="nx">left</span><span class="o">+</span><span class="nx">b</span><span class="p">.</span><span class="nx">elemWidth</span><span class="o">-</span><span class="nx">d</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span><span class="o">-</span><span class="nx">d</span><span class="p">.</span><span class="nx">scrollLeft</span><span class="p">();</span><span class="nx">a</span><span class="p">.</span><span class="nx">left</span><span class="o">=</span><span class="nx">b</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">?</span><span class="nx">a</span><span class="p">.</span><span class="nx">left</span><span class="o">-</span><span class="nx">b</span><span class="o">:</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nx">a</span><span class="p">.</span><span class="nx">left</span><span class="p">)},</span><span class="nx">top</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">){</span><span class="kd">var</span> <span class="nx">d</span><span class="o">=</span><span class="nx">c</span><span class="p">(</span><span class="nb">window</span><span class="p">);</span><span class="nx">b</span><span class="o">=</span><span class="nx">a</span><span class="p">.</span><span class="nx">top</span><span class="o">+</span><span class="nx">b</span><span class="p">.</span><span class="nx">elemHeight</span><span class="o">-</span><span class="nx">d</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span><span class="o">-</span><span class="nx">d</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">();</span><span class="nx">a</span><span class="p">.</span><span class="nx">top</span><span class="o">=</span><span class="nx">b</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">?</span><span class="nx">a</span><span class="p">.</span><span class="nx">top</span><span class="o">-</span><span class="nx">b</span><span class="o">:</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nx">a</span><span class="p">.</span><span class="nx">top</span><span class="p">)}},</span><span class="nx">flip</span><span class="o">:</span><span class="p">{</span><span class="nx">left</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">at</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!==</span><span class="s2">&quot;center&quot;</span><span class="p">){</span><span class="kd">var</span> <span class="nx">d</span><span class="o">=</span><span class="nx">c</span><span class="p">(</span><span class="nb">window</span><span class="p">);</span><span class="nx">d</span><span class="o">=</span><span class="nx">a</span><span class="p">.</span><span class="nx">left</span><span class="o">+</span><span class="nx">b</span><span class="p">.</span><span class="nx">elemWidth</span><span class="o">-</span><span class="nx">d</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span><span class="o">-</span><span class="nx">d</span><span class="p">.</span><span class="nx">scrollLeft</span><span class="p">();</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="nx">b</span><span class="p">.</span><span class="nx">my</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">===</span><span class="s2">&quot;left&quot;</span><span class="o">?</span>
<span class="o">-</span><span class="nx">b</span><span class="p">.</span><span class="nx">elemWidth</span><span class="o">:</span><span class="nx">b</span><span class="p">.</span><span class="nx">my</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">===</span><span class="s2">&quot;right&quot;</span><span class="o">?</span><span class="nx">b</span><span class="p">.</span><span class="nx">elemWidth</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="nx">g</span><span class="o">=-</span><span class="mi">2</span><span class="o">*</span><span class="nx">b</span><span class="p">.</span><span class="nx">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="nx">a</span><span class="p">.</span><span class="nx">left</span><span class="o">+=</span><span class="nx">a</span><span class="p">.</span><span class="nx">left</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">?</span><span class="nx">e</span><span class="o">+</span><span class="nx">b</span><span class="p">.</span><span class="nx">targetWidth</span><span class="o">+</span><span class="nx">g</span><span class="o">:</span><span class="nx">d</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">?</span><span class="nx">e</span><span class="o">-</span><span class="nx">b</span><span class="p">.</span><span class="nx">targetWidth</span><span class="o">+</span><span class="nx">g</span><span class="o">:</span><span class="mi">0</span><span class="p">}},</span><span class="nx">top</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">at</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">!==</span><span class="s2">&quot;center&quot;</span><span class="p">){</span><span class="kd">var</span> <span class="nx">d</span><span class="o">=</span><span class="nx">c</span><span class="p">(</span><span class="nb">window</span><span class="p">);</span><span class="nx">d</span><span class="o">=</span><span class="nx">a</span><span class="p">.</span><span class="nx">top</span><span class="o">+</span><span class="nx">b</span><span class="p">.</span><span class="nx">elemHeight</span><span class="o">-</span><span class="nx">d</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span><span class="o">-</span><span class="nx">d</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">();</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="nx">b</span><span class="p">.</span><span class="nx">my</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">===</span><span class="s2">&quot;top&quot;</span><span class="o">?-</span><span class="nx">b</span><span class="p">.</span><span class="nx">elemHeight</span><span class="o">:</span><span class="nx">b</span><span class="p">.</span><span class="nx">my</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">===</span><span class="s2">&quot;bottom&quot;</span><span class="o">?</span><span class="nx">b</span><span class="p">.</span><span class="nx">elemHeight</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="nx">g</span><span class="o">=</span><span class="nx">b</span><span class="p">.</span><span class="nx">at</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">===</span><span class="s2">&quot;top&quot;</span><span class="o">?</span><span class="nx">b</span><span class="p">.</span><span class="nx">targetHeight</span><span class="o">:-</span><span class="nx">b</span><span class="p">.</span><span class="nx">targetHeight</span><span class="p">,</span><span class="nx">h</span><span class="o">=-</span><span class="mi">2</span><span class="o">*</span><span class="nx">b</span><span class="p">.</span><span class="nx">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="nx">a</span><span class="p">.</span><span class="nx">top</span><span class="o">+=</span><span class="nx">a</span><span class="p">.</span><span class="nx">top</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">?</span><span class="nx">e</span><span class="o">+</span><span class="nx">b</span><span class="p">.</span><span class="nx">targetHeight</span><span class="o">+</span><span class="nx">h</span><span class="o">:</span><span class="nx">d</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">?</span><span class="nx">e</span><span class="o">+</span><span class="nx">g</span><span class="o">+</span><span class="nx">h</span><span class="o">:</span><span class="mi">0</span><span class="p">}}}};</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">c</span><span class="p">.</span><span class="nx">offset</span><span class="p">.</span><span class="nx">setOffset</span><span class="p">){</span><span class="nx">c</span><span class="p">.</span><span class="nx">offset</span><span class="p">.</span><span class="nx">setOffset</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="sr">/static/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">curCSS</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="s2">&quot;position&quot;</span><span class="p">)))</span><span class="nx">a</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">position</span><span class="o">=</span>
<span class="s2">&quot;relative&quot;</span><span class="p">;</span><span class="kd">var</span> <span class="nx">d</span><span class="o">=</span><span class="nx">c</span><span class="p">(</span><span class="nx">a</span><span class="p">),</span><span class="nx">e</span><span class="o">=</span><span class="nx">d</span><span class="p">.</span><span class="nx">offset</span><span class="p">(),</span><span class="nx">g</span><span class="o">=</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">curCSS</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="s2">&quot;top&quot;</span><span class="p">,</span><span class="kc">true</span><span class="p">),</span><span class="mi">10</span><span class="p">)</span><span class="o">||</span><span class="mi">0</span><span class="p">,</span><span class="nx">h</span><span class="o">=</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">curCSS</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="s2">&quot;left&quot;</span><span class="p">,</span><span class="kc">true</span><span class="p">),</span><span class="mi">10</span><span class="p">)</span><span class="o">||</span><span class="mi">0</span><span class="p">;</span><span class="nx">e</span><span class="o">=</span><span class="p">{</span><span class="nx">top</span><span class="o">:</span><span class="nx">b</span><span class="p">.</span><span class="nx">top</span><span class="o">-</span><span class="nx">e</span><span class="p">.</span><span class="nx">top</span><span class="o">+</span><span class="nx">g</span><span class="p">,</span><span class="nx">left</span><span class="o">:</span><span class="nx">b</span><span class="p">.</span><span class="nx">left</span><span class="o">-</span><span class="nx">e</span><span class="p">.</span><span class="nx">left</span><span class="o">+</span><span class="nx">h</span><span class="p">};</span><span class="s2">&quot;using&quot;</span><span class="k">in</span> <span class="nx">b</span><span class="o">?</span><span class="nx">b</span><span class="p">.</span><span class="nx">using</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">e</span><span class="p">)</span><span class="o">:</span><span class="nx">d</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="nx">e</span><span class="p">)};</span><span class="nx">c</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">offset</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">){</span><span class="kd">var</span> <span class="nx">b</span><span class="o">=</span><span class="k">this</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">b</span><span class="o">||!</span><span class="nx">b</span><span class="p">.</span><span class="nx">ownerDocument</span><span class="p">)</span><span class="k">return</span> <span class="kc">null</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="nx">c</span><span class="p">.</span><span class="nx">offset</span><span class="p">.</span><span class="nx">setOffset</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">a</span><span class="p">)});</span><span class="k">return</span> <span class="nx">q</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">)}}})(</span><span class="nx">jQuery</span><span class="p">);</span>
<span class="p">;</span><span class="cm">/*</span>
<span class="cm"> * jQuery UI Slider 1.8.1</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2010 AUTHORS.txt (http://jqueryui.com/about)</span>
<span class="cm"> * Dual licensed under the MIT (MIT-LICENSE.txt)</span>
<span class="cm"> * and GPL (GPL-LICENSE.txt) licenses.</span>
<span class="cm"> *</span>
<span class="cm"> * http://docs.jquery.com/UI/Slider</span>
<span class="cm"> *</span>
<span class="cm"> * Depends:</span>
<span class="cm"> *	jquery.ui.core.js</span>
<span class="cm"> *	jquery.ui.mouse.js</span>
<span class="cm"> *	jquery.ui.widget.js</span>
<span class="cm"> */</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">){</span><span class="nx">d</span><span class="p">.</span><span class="nx">widget</span><span class="p">(</span><span class="s2">&quot;ui.slider&quot;</span><span class="p">,</span><span class="nx">d</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">mouse</span><span class="p">,{</span><span class="nx">widgetEventPrefix</span><span class="o">:</span><span class="s2">&quot;slide&quot;</span><span class="p">,</span><span class="nx">options</span><span class="o">:</span><span class="p">{</span><span class="nx">animate</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span><span class="nx">distance</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="nx">max</span><span class="o">:</span><span class="mi">100</span><span class="p">,</span><span class="nx">min</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="nx">orientation</span><span class="o">:</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span><span class="nx">range</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span><span class="nx">step</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">value</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="nx">values</span><span class="o">:</span><span class="kc">null</span><span class="p">},</span><span class="nx">_create</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">b</span><span class="o">=</span><span class="k">this</span><span class="p">,</span><span class="nx">a</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseSliding</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_keySliding</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">_animateOff</span><span class="o">=</span><span class="kc">true</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">_handleIndex</span><span class="o">=</span><span class="kc">null</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">_detectOrientation</span><span class="p">();</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseInit</span><span class="p">();</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;ui-slider ui-slider-&quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">orientation</span><span class="o">+</span><span class="s2">&quot; ui-widget ui-widget-content ui-corner-all&quot;</span><span class="p">);</span><span class="nx">a</span><span class="p">.</span><span class="nx">disabled</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;ui-slider-disabled ui-disabled&quot;</span><span class="p">);</span>
<span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="o">=</span><span class="nx">d</span><span class="p">([]);</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">range</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">range</span><span class="o">===</span><span class="kc">true</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="o">=</span><span class="nx">d</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;&lt;/div&gt;&quot;</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">a</span><span class="p">.</span><span class="nx">values</span><span class="p">)</span><span class="nx">a</span><span class="p">.</span><span class="nx">values</span><span class="o">=</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">_valueMin</span><span class="p">(),</span><span class="k">this</span><span class="p">.</span><span class="nx">_valueMin</span><span class="p">()];</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">length</span><span class="o">&amp;&amp;</span><span class="nx">a</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">length</span><span class="o">!==</span><span class="mi">2</span><span class="p">)</span><span class="nx">a</span><span class="p">.</span><span class="nx">values</span><span class="o">=</span><span class="p">[</span><span class="nx">a</span><span class="p">.</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nx">a</span><span class="p">.</span><span class="nx">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]]}</span><span class="k">else</span> <span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="o">=</span><span class="nx">d</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;&lt;/div&gt;&quot;</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;ui-slider-range&quot;</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">range</span><span class="o">===</span><span class="s2">&quot;min&quot;</span><span class="o">||</span><span class="nx">a</span><span class="p">.</span><span class="nx">range</span><span class="o">===</span><span class="s2">&quot;max&quot;</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;ui-slider-range-&quot;</span><span class="o">+</span><span class="nx">a</span><span class="p">.</span><span class="nx">range</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;ui-widget-header&quot;</span><span class="p">)}</span><span class="nx">d</span><span class="p">(</span><span class="s2">&quot;.ui-slider-handle&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">).</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="o">&amp;&amp;</span><span class="nx">d</span><span class="p">(</span><span class="s2">&quot;&lt;a href=&#39;#&#39;&gt;&lt;/a&gt;&quot;</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;ui-slider-handle&quot;</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">values</span><span class="o">&amp;&amp;</span><span class="nx">a</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span><span class="k">for</span><span class="p">(;</span><span class="nx">d</span><span class="p">(</span><span class="s2">&quot;.ui-slider-handle&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">).</span><span class="nx">length</span><span class="o">&lt;</span><span class="nx">a</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">length</span><span class="p">;)</span><span class="nx">d</span><span class="p">(</span><span class="s2">&quot;&lt;a href=&#39;#&#39;&gt;&lt;/a&gt;&quot;</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;ui-slider-handle&quot;</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">handles</span><span class="o">=</span><span class="nx">d</span><span class="p">(</span><span class="s2">&quot;.ui-slider-handle&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;ui-state-default ui-corner-all&quot;</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">handle</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">handles</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">handles</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">).</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">){</span><span class="nx">c</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()}).</span><span class="nx">hover</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="nx">a</span><span class="p">.</span><span class="nx">disabled</span><span class="o">||</span><span class="nx">d</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;ui-state-hover&quot;</span><span class="p">)},</span><span class="kd">function</span><span class="p">(){</span><span class="nx">d</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;ui-state-hover&quot;</span><span class="p">)}).</span><span class="nx">focus</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">disabled</span><span class="p">)</span><span class="nx">d</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">blur</span><span class="p">();</span>
<span class="k">else</span><span class="p">{</span><span class="nx">d</span><span class="p">(</span><span class="s2">&quot;.ui-slider .ui-state-focus&quot;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;ui-state-focus&quot;</span><span class="p">);</span><span class="nx">d</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;ui-state-focus&quot;</span><span class="p">)}}).</span><span class="nx">blur</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="nx">d</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;ui-state-focus&quot;</span><span class="p">)});</span><span class="k">this</span><span class="p">.</span><span class="nx">handles</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">){</span><span class="nx">d</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;index.ui-slider-handle&quot;</span><span class="p">,</span><span class="nx">c</span><span class="p">)});</span><span class="k">this</span><span class="p">.</span><span class="nx">handles</span><span class="p">.</span><span class="nx">keydown</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">){</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="kc">true</span><span class="p">,</span><span class="nx">f</span><span class="o">=</span><span class="nx">d</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;index.ui-slider-handle&quot;</span><span class="p">),</span><span class="nx">g</span><span class="p">,</span><span class="nx">h</span><span class="p">,</span><span class="nx">i</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">b</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">disabled</span><span class="p">){</span><span class="k">switch</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">){</span><span class="k">case</span> <span class="nx">d</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">.</span><span class="nx">HOME</span><span class="o">:</span><span class="k">case</span> <span class="nx">d</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">.</span><span class="nx">END</span><span class="o">:</span><span class="k">case</span> <span class="nx">d</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">.</span><span class="nx">PAGE_UP</span><span class="o">:</span><span class="k">case</span> <span class="nx">d</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">.</span><span class="nx">PAGE_DOWN</span><span class="o">:</span><span class="k">case</span> <span class="nx">d</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">.</span><span class="nx">UP</span><span class="o">:</span><span class="k">case</span> <span class="nx">d</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">.</span><span class="nx">RIGHT</span><span class="o">:</span><span class="k">case</span> <span class="nx">d</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">.</span><span class="nx">DOWN</span><span class="o">:</span><span class="k">case</span> <span class="nx">d</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">.</span><span class="nx">LEFT</span><span class="o">:</span><span class="nx">e</span><span class="o">=</span>
<span class="kc">false</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">b</span><span class="p">.</span><span class="nx">_keySliding</span><span class="p">){</span><span class="nx">b</span><span class="p">.</span><span class="nx">_keySliding</span><span class="o">=</span><span class="kc">true</span><span class="p">;</span><span class="nx">d</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;ui-state-active&quot;</span><span class="p">);</span><span class="nx">g</span><span class="o">=</span><span class="nx">b</span><span class="p">.</span><span class="nx">_start</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">f</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">g</span><span class="o">===</span><span class="kc">false</span><span class="p">)</span><span class="k">return</span><span class="p">}</span><span class="k">break</span><span class="p">}</span><span class="nx">i</span><span class="o">=</span><span class="nx">b</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">step</span><span class="p">;</span><span class="nx">g</span><span class="o">=</span><span class="nx">b</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">values</span><span class="o">&amp;&amp;</span><span class="nx">b</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">length</span><span class="o">?</span><span class="p">(</span><span class="nx">h</span><span class="o">=</span><span class="nx">b</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">f</span><span class="p">))</span><span class="o">:</span><span class="p">(</span><span class="nx">h</span><span class="o">=</span><span class="nx">b</span><span class="p">.</span><span class="nx">value</span><span class="p">());</span><span class="k">switch</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">){</span><span class="k">case</span> <span class="nx">d</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">.</span><span class="nx">HOME</span><span class="o">:</span><span class="nx">h</span><span class="o">=</span><span class="nx">b</span><span class="p">.</span><span class="nx">_valueMin</span><span class="p">();</span><span class="k">break</span><span class="p">;</span><span class="k">case</span> <span class="nx">d</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">.</span><span class="nx">END</span><span class="o">:</span><span class="nx">h</span><span class="o">=</span><span class="nx">b</span><span class="p">.</span><span class="nx">_valueMax</span><span class="p">();</span><span class="k">break</span><span class="p">;</span><span class="k">case</span> <span class="nx">d</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">.</span><span class="nx">PAGE_UP</span><span class="o">:</span><span class="nx">h</span><span class="o">=</span><span class="nx">g</span><span class="o">+</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">_valueMax</span><span class="p">()</span><span class="o">-</span><span class="nx">b</span><span class="p">.</span><span class="nx">_valueMin</span><span class="p">())</span><span class="o">/</span><span class="mi">5</span><span class="p">;</span><span class="k">break</span><span class="p">;</span><span class="k">case</span> <span class="nx">d</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">.</span><span class="nx">PAGE_DOWN</span><span class="o">:</span><span class="nx">h</span><span class="o">=</span><span class="nx">g</span><span class="o">-</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">_valueMax</span><span class="p">()</span><span class="o">-</span><span class="nx">b</span><span class="p">.</span><span class="nx">_valueMin</span><span class="p">())</span><span class="o">/</span><span class="mi">5</span><span class="p">;</span><span class="k">break</span><span class="p">;</span><span class="k">case</span> <span class="nx">d</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">.</span><span class="nx">UP</span><span class="o">:</span><span class="k">case</span> <span class="nx">d</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">.</span><span class="nx">RIGHT</span><span class="o">:</span><span class="k">if</span><span class="p">(</span><span class="nx">g</span><span class="o">===</span>
<span class="nx">b</span><span class="p">.</span><span class="nx">_valueMax</span><span class="p">())</span><span class="k">return</span><span class="p">;</span><span class="nx">h</span><span class="o">=</span><span class="nx">g</span><span class="o">+</span><span class="nx">i</span><span class="p">;</span><span class="k">break</span><span class="p">;</span><span class="k">case</span> <span class="nx">d</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">.</span><span class="nx">DOWN</span><span class="o">:</span><span class="k">case</span> <span class="nx">d</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">.</span><span class="nx">LEFT</span><span class="o">:</span><span class="k">if</span><span class="p">(</span><span class="nx">g</span><span class="o">===</span><span class="nx">b</span><span class="p">.</span><span class="nx">_valueMin</span><span class="p">())</span><span class="k">return</span><span class="p">;</span><span class="nx">h</span><span class="o">=</span><span class="nx">g</span><span class="o">-</span><span class="nx">i</span><span class="p">;</span><span class="k">break</span><span class="p">}</span><span class="nx">b</span><span class="p">.</span><span class="nx">_slide</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">f</span><span class="p">,</span><span class="nx">h</span><span class="p">);</span><span class="k">return</span> <span class="nx">e</span><span class="p">}}).</span><span class="nx">keyup</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">){</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="nx">d</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;index.ui-slider-handle&quot;</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">_keySliding</span><span class="p">){</span><span class="nx">b</span><span class="p">.</span><span class="nx">_keySliding</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span><span class="nx">b</span><span class="p">.</span><span class="nx">_stop</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">e</span><span class="p">);</span><span class="nx">b</span><span class="p">.</span><span class="nx">_change</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">e</span><span class="p">);</span><span class="nx">d</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;ui-state-active&quot;</span><span class="p">)}});</span><span class="k">this</span><span class="p">.</span><span class="nx">_refreshValue</span><span class="p">();</span><span class="k">this</span><span class="p">.</span><span class="nx">_animateOff</span><span class="o">=</span><span class="kc">false</span><span class="p">},</span><span class="nx">destroy</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">this</span><span class="p">.</span><span class="nx">handles</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span><span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all&quot;</span><span class="p">).</span><span class="nx">removeData</span><span class="p">(</span><span class="s2">&quot;slider&quot;</span><span class="p">).</span><span class="nx">unbind</span><span class="p">(</span><span class="s2">&quot;.slider&quot;</span><span class="p">);</span>
<span class="k">this</span><span class="p">.</span><span class="nx">_mouseDestroy</span><span class="p">();</span><span class="k">return</span> <span class="k">this</span><span class="p">},</span><span class="nx">_mouseCapture</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">b</span><span class="p">){</span><span class="kd">var</span> <span class="nx">a</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">,</span><span class="nx">c</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">f</span><span class="p">,</span><span class="nx">g</span><span class="p">,</span><span class="nx">h</span><span class="p">,</span><span class="nx">i</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">disabled</span><span class="p">)</span><span class="k">return</span> <span class="kc">false</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">elementSize</span><span class="o">=</span><span class="p">{</span><span class="nx">width</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">outerWidth</span><span class="p">(),</span><span class="nx">height</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">outerHeight</span><span class="p">()};</span><span class="k">this</span><span class="p">.</span><span class="nx">elementOffset</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">offset</span><span class="p">();</span><span class="nx">c</span><span class="o">=</span><span class="p">{</span><span class="nx">x</span><span class="o">:</span><span class="nx">b</span><span class="p">.</span><span class="nx">pageX</span><span class="p">,</span><span class="nx">y</span><span class="o">:</span><span class="nx">b</span><span class="p">.</span><span class="nx">pageY</span><span class="p">};</span><span class="nx">e</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_normValueFromMouse</span><span class="p">(</span><span class="nx">c</span><span class="p">);</span><span class="nx">f</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_valueMax</span><span class="p">()</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">_valueMin</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="nx">h</span><span class="o">=</span><span class="k">this</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">handles</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">j</span><span class="p">){</span><span class="kd">var</span> <span class="nx">k</span><span class="o">=</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">e</span><span class="o">-</span><span class="nx">h</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">j</span><span class="p">));</span><span class="k">if</span><span class="p">(</span><span class="nx">f</span><span class="o">&gt;</span><span class="nx">k</span><span class="p">){</span><span class="nx">f</span><span class="o">=</span><span class="nx">k</span><span class="p">;</span><span class="nx">g</span><span class="o">=</span><span class="nx">d</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="nx">i</span><span class="o">=</span><span class="nx">j</span><span class="p">}});</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">range</span><span class="o">===</span><span class="kc">true</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">===</span><span class="nx">a</span><span class="p">.</span><span class="nx">min</span><span class="p">){</span><span class="nx">i</span><span class="o">+=</span><span class="mi">1</span><span class="p">;</span><span class="nx">g</span><span class="o">=</span><span class="nx">d</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">handles</span><span class="p">[</span><span class="nx">i</span><span class="p">])}</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_start</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span>
<span class="nx">i</span><span class="p">)</span><span class="o">===</span><span class="kc">false</span><span class="p">)</span><span class="k">return</span> <span class="kc">false</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseSliding</span><span class="o">=</span><span class="kc">true</span><span class="p">;</span><span class="nx">h</span><span class="p">.</span><span class="nx">_handleIndex</span><span class="o">=</span><span class="nx">i</span><span class="p">;</span><span class="nx">g</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;ui-state-active&quot;</span><span class="p">).</span><span class="nx">focus</span><span class="p">();</span><span class="nx">a</span><span class="o">=</span><span class="nx">g</span><span class="p">.</span><span class="nx">offset</span><span class="p">();</span><span class="k">this</span><span class="p">.</span><span class="nx">_clickOffset</span><span class="o">=!</span><span class="nx">d</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">parents</span><span class="p">().</span><span class="nx">andSelf</span><span class="p">().</span><span class="nx">is</span><span class="p">(</span><span class="s2">&quot;.ui-slider-handle&quot;</span><span class="p">)</span><span class="o">?</span><span class="p">{</span><span class="nx">left</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="nx">top</span><span class="o">:</span><span class="mi">0</span><span class="p">}</span><span class="o">:</span><span class="p">{</span><span class="nx">left</span><span class="o">:</span><span class="nx">b</span><span class="p">.</span><span class="nx">pageX</span><span class="o">-</span><span class="nx">a</span><span class="p">.</span><span class="nx">left</span><span class="o">-</span><span class="nx">g</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="nx">top</span><span class="o">:</span><span class="nx">b</span><span class="p">.</span><span class="nx">pageY</span><span class="o">-</span><span class="nx">a</span><span class="p">.</span><span class="nx">top</span><span class="o">-</span><span class="nx">g</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">g</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;borderTopWidth&quot;</span><span class="p">),</span><span class="mi">10</span><span class="p">)</span><span class="o">||</span><span class="mi">0</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">g</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;borderBottomWidth&quot;</span><span class="p">),</span><span class="mi">10</span><span class="p">)</span><span class="o">||</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">g</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;marginTop&quot;</span><span class="p">),</span><span class="mi">10</span><span class="p">)</span><span class="o">||</span><span class="mi">0</span><span class="p">)};</span><span class="nx">e</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_normValueFromMouse</span><span class="p">(</span><span class="nx">c</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">_slide</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span><span class="nx">i</span><span class="p">,</span><span class="nx">e</span><span class="p">);</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_animateOff</span><span class="o">=</span><span class="kc">true</span><span class="p">},</span><span class="nx">_mouseStart</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="kc">true</span><span class="p">},</span>
<span class="nx">_mouseDrag</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">b</span><span class="p">){</span><span class="kd">var</span> <span class="nx">a</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_normValueFromMouse</span><span class="p">({</span><span class="nx">x</span><span class="o">:</span><span class="nx">b</span><span class="p">.</span><span class="nx">pageX</span><span class="p">,</span><span class="nx">y</span><span class="o">:</span><span class="nx">b</span><span class="p">.</span><span class="nx">pageY</span><span class="p">});</span><span class="k">this</span><span class="p">.</span><span class="nx">_slide</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">_handleIndex</span><span class="p">,</span><span class="nx">a</span><span class="p">);</span><span class="k">return</span> <span class="kc">false</span><span class="p">},</span><span class="nx">_mouseStop</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">b</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">handles</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;ui-state-active&quot;</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseSliding</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">_stop</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">_handleIndex</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">_change</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">_handleIndex</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">_clickOffset</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_handleIndex</span><span class="o">=</span><span class="kc">null</span><span class="p">;</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_animateOff</span><span class="o">=</span><span class="kc">false</span><span class="p">},</span><span class="nx">_detectOrientation</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">this</span><span class="p">.</span><span class="nx">orientation</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">orientation</span><span class="o">===</span><span class="s2">&quot;vertical&quot;</span><span class="o">?</span><span class="s2">&quot;vertical&quot;</span><span class="o">:</span><span class="s2">&quot;horizontal&quot;</span><span class="p">},</span><span class="nx">_normValueFromMouse</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">b</span><span class="p">){</span><span class="kd">var</span> <span class="nx">a</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">orientation</span><span class="o">===</span><span class="s2">&quot;horizontal&quot;</span><span class="p">){</span><span class="nx">a</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">elementSize</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span><span class="nx">b</span><span class="o">=</span><span class="nx">b</span><span class="p">.</span><span class="nx">x</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">elementOffset</span><span class="p">.</span><span class="nx">left</span><span class="o">-</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_clickOffset</span><span class="o">?</span><span class="k">this</span><span class="p">.</span><span class="nx">_clickOffset</span><span class="p">.</span><span class="nx">left</span><span class="o">:</span><span class="mi">0</span><span class="p">)}</span><span class="k">else</span><span class="p">{</span><span class="nx">a</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">elementSize</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span><span class="nx">b</span><span class="o">=</span><span class="nx">b</span><span class="p">.</span><span class="nx">y</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">elementOffset</span><span class="p">.</span><span class="nx">top</span><span class="o">-</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_clickOffset</span><span class="o">?</span><span class="k">this</span><span class="p">.</span><span class="nx">_clickOffset</span><span class="p">.</span><span class="nx">top</span><span class="o">:</span><span class="mi">0</span><span class="p">)}</span><span class="nx">a</span><span class="o">=</span><span class="nx">b</span><span class="o">/</span><span class="nx">a</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span><span class="nx">a</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span><span class="nx">a</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">orientation</span><span class="o">===</span><span class="s2">&quot;vertical&quot;</span><span class="p">)</span><span class="nx">a</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="nx">a</span><span class="p">;</span><span class="nx">b</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_valueMax</span><span class="p">()</span><span class="o">-</span><span class="k">this</span><span class="p">.</span><span class="nx">_valueMin</span><span class="p">();</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_trimAlignValue</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_valueMin</span><span class="p">()</span><span class="o">+</span><span class="nx">a</span><span class="o">*</span><span class="nx">b</span><span class="p">)},</span><span class="nx">_start</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span><span class="nx">a</span><span class="p">){</span><span class="kd">var</span> <span class="nx">c</span><span class="o">=</span><span class="p">{</span><span class="nx">handle</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">handles</span><span class="p">[</span><span class="nx">a</span><span class="p">],</span><span class="nx">value</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">()};</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">values</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">length</span><span class="p">){</span><span class="nx">c</span><span class="p">.</span><span class="nx">value</span><span class="o">=</span>
<span class="k">this</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span><span class="nx">c</span><span class="p">.</span><span class="nx">values</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">values</span><span class="p">()}</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_trigger</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">c</span><span class="p">)},</span><span class="nx">_slide</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">c</span><span class="p">){</span><span class="kd">var</span> <span class="nx">e</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">values</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">length</span><span class="p">){</span><span class="nx">e</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">a</span><span class="o">?</span><span class="mi">0</span><span class="o">:</span><span class="mi">1</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">2</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">range</span><span class="o">===</span><span class="kc">true</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="nx">a</span><span class="o">===</span><span class="mi">0</span><span class="o">&amp;&amp;</span><span class="nx">c</span><span class="o">&gt;</span><span class="nx">e</span><span class="o">||</span><span class="nx">a</span><span class="o">===</span><span class="mi">1</span><span class="o">&amp;&amp;</span><span class="nx">c</span><span class="o">&lt;</span><span class="nx">e</span><span class="p">))</span><span class="nx">c</span><span class="o">=</span><span class="nx">e</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">c</span><span class="o">!==</span><span class="k">this</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">a</span><span class="p">)){</span><span class="nx">e</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">values</span><span class="p">();</span><span class="nx">e</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span><span class="o">=</span><span class="nx">c</span><span class="p">;</span><span class="nx">b</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_trigger</span><span class="p">(</span><span class="s2">&quot;slide&quot;</span><span class="p">,</span><span class="nx">b</span><span class="p">,{</span><span class="nx">handle</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">handles</span><span class="p">[</span><span class="nx">a</span><span class="p">],</span><span class="nx">value</span><span class="o">:</span><span class="nx">c</span><span class="p">,</span><span class="nx">values</span><span class="o">:</span><span class="nx">e</span><span class="p">});</span><span class="k">this</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">a</span><span class="o">?</span><span class="mi">0</span><span class="o">:</span><span class="mi">1</span><span class="p">);</span><span class="nx">b</span><span class="o">!==</span><span class="kc">false</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">c</span><span class="p">,</span><span class="kc">true</span><span class="p">)}}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">c</span><span class="o">!==</span><span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">()){</span><span class="nx">b</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_trigger</span><span class="p">(</span><span class="s2">&quot;slide&quot;</span><span class="p">,</span><span class="nx">b</span><span class="p">,{</span><span class="nx">handle</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">handles</span><span class="p">[</span><span class="nx">a</span><span class="p">],</span>
<span class="nx">value</span><span class="o">:</span><span class="nx">c</span><span class="p">});</span><span class="nx">b</span><span class="o">!==</span><span class="kc">false</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">(</span><span class="nx">c</span><span class="p">)}},</span><span class="nx">_stop</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span><span class="nx">a</span><span class="p">){</span><span class="kd">var</span> <span class="nx">c</span><span class="o">=</span><span class="p">{</span><span class="nx">handle</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">handles</span><span class="p">[</span><span class="nx">a</span><span class="p">],</span><span class="nx">value</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">()};</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">values</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">length</span><span class="p">){</span><span class="nx">c</span><span class="p">.</span><span class="nx">value</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span><span class="nx">c</span><span class="p">.</span><span class="nx">values</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">values</span><span class="p">()}</span><span class="k">this</span><span class="p">.</span><span class="nx">_trigger</span><span class="p">(</span><span class="s2">&quot;stop&quot;</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">c</span><span class="p">)},</span><span class="nx">_change</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span><span class="nx">a</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_keySliding</span><span class="o">&amp;&amp;!</span><span class="k">this</span><span class="p">.</span><span class="nx">_mouseSliding</span><span class="p">){</span><span class="kd">var</span> <span class="nx">c</span><span class="o">=</span><span class="p">{</span><span class="nx">handle</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">handles</span><span class="p">[</span><span class="nx">a</span><span class="p">],</span><span class="nx">value</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">()};</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">values</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">length</span><span class="p">){</span><span class="nx">c</span><span class="p">.</span><span class="nx">value</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span><span class="nx">c</span><span class="p">.</span><span class="nx">values</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">values</span><span class="p">()}</span><span class="k">this</span><span class="p">.</span><span class="nx">_trigger</span><span class="p">(</span><span class="s2">&quot;change&quot;</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">c</span><span class="p">)}},</span><span class="nx">value</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">b</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">value</span><span class="o">=</span>
<span class="k">this</span><span class="p">.</span><span class="nx">_trimAlignValue</span><span class="p">(</span><span class="nx">b</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">_refreshValue</span><span class="p">();</span><span class="k">this</span><span class="p">.</span><span class="nx">_change</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="mi">0</span><span class="p">)}</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_value</span><span class="p">()},</span><span class="nx">values</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span><span class="nx">a</span><span class="p">){</span><span class="kd">var</span> <span class="nx">c</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">f</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">values</span><span class="p">[</span><span class="nx">b</span><span class="p">]</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_trimAlignValue</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">_refreshValue</span><span class="p">();</span><span class="k">this</span><span class="p">.</span><span class="nx">_change</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="nx">b</span><span class="p">)}</span><span class="k">if</span><span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span><span class="k">if</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">])){</span><span class="nx">c</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">values</span><span class="p">;</span><span class="nx">e</span><span class="o">=</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="k">for</span><span class="p">(</span><span class="nx">f</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">f</span><span class="o">&lt;</span><span class="nx">c</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">f</span><span class="o">+=</span><span class="mi">1</span><span class="p">){</span><span class="nx">c</span><span class="p">[</span><span class="nx">f</span><span class="p">]</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_trimAlignValue</span><span class="p">(</span><span class="nx">e</span><span class="p">[</span><span class="nx">f</span><span class="p">]);</span><span class="k">this</span><span class="p">.</span><span class="nx">_change</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="nx">f</span><span class="p">)}</span><span class="k">this</span><span class="p">.</span><span class="nx">_refreshValue</span><span class="p">()}</span><span class="k">else</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">values</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">length</span><span class="o">?</span><span class="k">this</span><span class="p">.</span><span class="nx">_values</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">();</span>
<span class="k">else</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_values</span><span class="p">()},</span><span class="nx">_setOption</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span><span class="nx">a</span><span class="p">){</span><span class="kd">var</span> <span class="nx">c</span><span class="p">,</span><span class="nx">e</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">values</span><span class="p">))</span><span class="nx">e</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">d</span><span class="p">.</span><span class="nx">Widget</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_setOption</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">arguments</span><span class="p">);</span><span class="k">switch</span><span class="p">(</span><span class="nx">b</span><span class="p">){</span><span class="k">case</span> <span class="s2">&quot;disabled&quot;</span><span class="o">:</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="p">){</span><span class="k">this</span><span class="p">.</span><span class="nx">handles</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;.ui-state-focus&quot;</span><span class="p">).</span><span class="nx">blur</span><span class="p">();</span><span class="k">this</span><span class="p">.</span><span class="nx">handles</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;ui-state-hover&quot;</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">handles</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;disabled&quot;</span><span class="p">,</span><span class="s2">&quot;disabled&quot;</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;ui-disabled&quot;</span><span class="p">)}</span><span class="k">else</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handles</span><span class="p">.</span><span class="nx">removeAttr</span><span class="p">(</span><span class="s2">&quot;disabled&quot;</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;ui-disabled&quot;</span><span class="p">)}</span><span class="k">break</span><span class="p">;</span><span class="k">case</span> <span class="s2">&quot;orientation&quot;</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">_detectOrientation</span><span class="p">();</span>
<span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;ui-slider-horizontal ui-slider-vertical&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;ui-slider-&quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">orientation</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">_refreshValue</span><span class="p">();</span><span class="k">break</span><span class="p">;</span><span class="k">case</span> <span class="s2">&quot;value&quot;</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">_animateOff</span><span class="o">=</span><span class="kc">true</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">_refreshValue</span><span class="p">();</span><span class="k">this</span><span class="p">.</span><span class="nx">_change</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">_animateOff</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span><span class="k">break</span><span class="p">;</span><span class="k">case</span> <span class="s2">&quot;values&quot;</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">_animateOff</span><span class="o">=</span><span class="kc">true</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">_refreshValue</span><span class="p">();</span><span class="k">for</span><span class="p">(</span><span class="nx">c</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">c</span><span class="o">&lt;</span><span class="nx">e</span><span class="p">;</span><span class="nx">c</span><span class="o">+=</span><span class="mi">1</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">_change</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="nx">c</span><span class="p">);</span><span class="k">this</span><span class="p">.</span><span class="nx">_animateOff</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span><span class="k">break</span><span class="p">}},</span><span class="nx">_value</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">b</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span><span class="k">return</span> <span class="nx">b</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_trimAlignValue</span><span class="p">(</span><span class="nx">b</span><span class="p">)},</span><span class="nx">_values</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">b</span><span class="p">){</span><span class="kd">var</span> <span class="nx">a</span><span class="p">,</span><span class="nx">c</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="p">){</span><span class="nx">a</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">values</span><span class="p">[</span><span class="nx">b</span><span class="p">];</span>
<span class="k">return</span> <span class="nx">a</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_trimAlignValue</span><span class="p">(</span><span class="nx">a</span><span class="p">)}</span><span class="k">else</span><span class="p">{</span><span class="nx">a</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">slice</span><span class="p">();</span><span class="k">for</span><span class="p">(</span><span class="nx">c</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">c</span><span class="o">&lt;</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">c</span><span class="o">+=</span><span class="mi">1</span><span class="p">)</span><span class="nx">a</span><span class="p">[</span><span class="nx">c</span><span class="p">]</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_trimAlignValue</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">c</span><span class="p">]);</span><span class="k">return</span> <span class="nx">a</span><span class="p">}},</span><span class="nx">_trimAlignValue</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">b</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">b</span><span class="o">&lt;</span><span class="k">this</span><span class="p">.</span><span class="nx">_valueMin</span><span class="p">())</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_valueMin</span><span class="p">();</span><span class="k">if</span><span class="p">(</span><span class="nx">b</span><span class="o">&gt;</span><span class="k">this</span><span class="p">.</span><span class="nx">_valueMax</span><span class="p">())</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_valueMax</span><span class="p">();</span><span class="kd">var</span> <span class="nx">a</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">step</span><span class="p">,</span><span class="nx">c</span><span class="o">=</span><span class="nx">b</span><span class="o">%</span><span class="nx">a</span><span class="p">;</span><span class="nx">b</span><span class="o">=</span><span class="nx">b</span><span class="o">-</span><span class="nx">c</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">c</span><span class="o">&gt;=</span><span class="nx">a</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="nx">b</span><span class="o">+=</span><span class="nx">a</span><span class="p">;</span><span class="k">return</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">5</span><span class="p">))},</span><span class="nx">_valueMin</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">min</span><span class="p">},</span><span class="nx">_valueMax</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">max</span><span class="p">},</span><span class="nx">_refreshValue</span><span class="o">:</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">b</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">range</span><span class="p">,</span><span class="nx">a</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">,</span><span class="nx">c</span><span class="o">=</span><span class="k">this</span><span class="p">,</span>
<span class="nx">e</span><span class="o">=!</span><span class="k">this</span><span class="p">.</span><span class="nx">_animateOff</span><span class="o">?</span><span class="nx">a</span><span class="p">.</span><span class="nx">animate</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span><span class="nx">f</span><span class="p">,</span><span class="nx">g</span><span class="o">=</span><span class="p">{},</span><span class="nx">h</span><span class="p">,</span><span class="nx">i</span><span class="p">,</span><span class="nx">j</span><span class="p">,</span><span class="nx">k</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">values</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">values</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">handles</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">l</span><span class="p">){</span><span class="nx">f</span><span class="o">=</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="nx">l</span><span class="p">)</span><span class="o">-</span><span class="nx">c</span><span class="p">.</span><span class="nx">_valueMin</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">_valueMax</span><span class="p">()</span><span class="o">-</span><span class="nx">c</span><span class="p">.</span><span class="nx">_valueMin</span><span class="p">())</span><span class="o">*</span><span class="mi">100</span><span class="p">;</span><span class="nx">g</span><span class="p">[</span><span class="nx">c</span><span class="p">.</span><span class="nx">orientation</span><span class="o">===</span><span class="s2">&quot;horizontal&quot;</span><span class="o">?</span><span class="s2">&quot;left&quot;</span><span class="o">:</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span><span class="o">=</span><span class="nx">f</span><span class="o">+</span><span class="s2">&quot;%&quot;</span><span class="p">;</span><span class="nx">d</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">stop</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)[</span><span class="nx">e</span><span class="o">?</span><span class="s2">&quot;animate&quot;</span><span class="o">:</span><span class="s2">&quot;css&quot;</span><span class="p">](</span><span class="nx">g</span><span class="p">,</span><span class="nx">a</span><span class="p">.</span><span class="nx">animate</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">range</span><span class="o">===</span><span class="kc">true</span><span class="p">)</span><span class="k">if</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">orientation</span><span class="o">===</span><span class="s2">&quot;horizontal&quot;</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">l</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span><span class="nx">c</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">stop</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)[</span><span class="nx">e</span><span class="o">?</span><span class="s2">&quot;animate&quot;</span><span class="o">:</span><span class="s2">&quot;css&quot;</span><span class="p">]({</span><span class="nx">left</span><span class="o">:</span><span class="nx">f</span><span class="o">+</span><span class="s2">&quot;%&quot;</span><span class="p">},</span><span class="nx">a</span><span class="p">.</span><span class="nx">animate</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">l</span><span class="o">===</span><span class="mi">1</span><span class="p">)</span><span class="nx">c</span><span class="p">.</span><span class="nx">range</span><span class="p">[</span><span class="nx">e</span><span class="o">?</span><span class="s2">&quot;animate&quot;</span><span class="o">:</span><span class="s2">&quot;css&quot;</span><span class="p">]({</span><span class="nx">width</span><span class="o">:</span><span class="nx">f</span><span class="o">-</span><span class="nx">h</span><span class="o">+</span><span class="s2">&quot;%&quot;</span><span class="p">},{</span><span class="nx">queue</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span><span class="nx">duration</span><span class="o">:</span><span class="nx">a</span><span class="p">.</span><span class="nx">animate</span><span class="p">})}</span><span class="k">else</span><span class="p">{</span><span class="k">if</span><span class="p">(</span><span class="nx">l</span><span class="o">===</span>
<span class="mi">0</span><span class="p">)</span><span class="nx">c</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">stop</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)[</span><span class="nx">e</span><span class="o">?</span><span class="s2">&quot;animate&quot;</span><span class="o">:</span><span class="s2">&quot;css&quot;</span><span class="p">]({</span><span class="nx">bottom</span><span class="o">:</span><span class="nx">f</span><span class="o">+</span><span class="s2">&quot;%&quot;</span><span class="p">},</span><span class="nx">a</span><span class="p">.</span><span class="nx">animate</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">l</span><span class="o">===</span><span class="mi">1</span><span class="p">)</span><span class="nx">c</span><span class="p">.</span><span class="nx">range</span><span class="p">[</span><span class="nx">e</span><span class="o">?</span><span class="s2">&quot;animate&quot;</span><span class="o">:</span><span class="s2">&quot;css&quot;</span><span class="p">]({</span><span class="nx">height</span><span class="o">:</span><span class="nx">f</span><span class="o">-</span><span class="nx">h</span><span class="o">+</span><span class="s2">&quot;%&quot;</span><span class="p">},{</span><span class="nx">queue</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span><span class="nx">duration</span><span class="o">:</span><span class="nx">a</span><span class="p">.</span><span class="nx">animate</span><span class="p">})}</span><span class="nx">h</span><span class="o">=</span><span class="nx">f</span><span class="p">});</span><span class="k">else</span><span class="p">{</span><span class="nx">i</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">();</span><span class="nx">j</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_valueMin</span><span class="p">();</span><span class="nx">k</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_valueMax</span><span class="p">();</span><span class="nx">f</span><span class="o">=</span><span class="nx">k</span><span class="o">!==</span><span class="nx">j</span><span class="o">?</span><span class="p">(</span><span class="nx">i</span><span class="o">-</span><span class="nx">j</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="nx">k</span><span class="o">-</span><span class="nx">j</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="o">:</span><span class="mi">0</span><span class="p">;</span><span class="nx">g</span><span class="p">[</span><span class="nx">c</span><span class="p">.</span><span class="nx">orientation</span><span class="o">===</span><span class="s2">&quot;horizontal&quot;</span><span class="o">?</span><span class="s2">&quot;left&quot;</span><span class="o">:</span><span class="s2">&quot;bottom&quot;</span><span class="p">]</span><span class="o">=</span><span class="nx">f</span><span class="o">+</span><span class="s2">&quot;%&quot;</span><span class="p">;</span><span class="k">this</span><span class="p">.</span><span class="nx">handle</span><span class="p">.</span><span class="nx">stop</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)[</span><span class="nx">e</span><span class="o">?</span><span class="s2">&quot;animate&quot;</span><span class="o">:</span><span class="s2">&quot;css&quot;</span><span class="p">](</span><span class="nx">g</span><span class="p">,</span><span class="nx">a</span><span class="p">.</span><span class="nx">animate</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">b</span><span class="o">===</span><span class="s2">&quot;min&quot;</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">orientation</span><span class="o">===</span><span class="s2">&quot;horizontal&quot;</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">stop</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)[</span><span class="nx">e</span><span class="o">?</span><span class="s2">&quot;animate&quot;</span><span class="o">:</span><span class="s2">&quot;css&quot;</span><span class="p">]({</span><span class="nx">width</span><span class="o">:</span><span class="nx">f</span><span class="o">+</span><span class="s2">&quot;%&quot;</span><span class="p">},</span><span class="nx">a</span><span class="p">.</span><span class="nx">animate</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">b</span><span class="o">===</span><span class="s2">&quot;max&quot;</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">orientation</span><span class="o">===</span><span class="s2">&quot;horizontal&quot;</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">[</span><span class="nx">e</span><span class="o">?</span>
<span class="s2">&quot;animate&quot;</span><span class="o">:</span><span class="s2">&quot;css&quot;</span><span class="p">]({</span><span class="nx">width</span><span class="o">:</span><span class="mi">100</span><span class="o">-</span><span class="nx">f</span><span class="o">+</span><span class="s2">&quot;%&quot;</span><span class="p">},{</span><span class="nx">queue</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span><span class="nx">duration</span><span class="o">:</span><span class="nx">a</span><span class="p">.</span><span class="nx">animate</span><span class="p">});</span><span class="k">if</span><span class="p">(</span><span class="nx">b</span><span class="o">===</span><span class="s2">&quot;min&quot;</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">orientation</span><span class="o">===</span><span class="s2">&quot;vertical&quot;</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">.</span><span class="nx">stop</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)[</span><span class="nx">e</span><span class="o">?</span><span class="s2">&quot;animate&quot;</span><span class="o">:</span><span class="s2">&quot;css&quot;</span><span class="p">]({</span><span class="nx">height</span><span class="o">:</span><span class="nx">f</span><span class="o">+</span><span class="s2">&quot;%&quot;</span><span class="p">},</span><span class="nx">a</span><span class="p">.</span><span class="nx">animate</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">b</span><span class="o">===</span><span class="s2">&quot;max&quot;</span><span class="o">&amp;&amp;</span><span class="k">this</span><span class="p">.</span><span class="nx">orientation</span><span class="o">===</span><span class="s2">&quot;vertical&quot;</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nx">range</span><span class="p">[</span><span class="nx">e</span><span class="o">?</span><span class="s2">&quot;animate&quot;</span><span class="o">:</span><span class="s2">&quot;css&quot;</span><span class="p">]({</span><span class="nx">height</span><span class="o">:</span><span class="mi">100</span><span class="o">-</span><span class="nx">f</span><span class="o">+</span><span class="s2">&quot;%&quot;</span><span class="p">},{</span><span class="nx">queue</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span><span class="nx">duration</span><span class="o">:</span><span class="nx">a</span><span class="p">.</span><span class="nx">animate</span><span class="p">})}}});</span><span class="nx">d</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">slider</span><span class="p">,{</span><span class="nx">version</span><span class="o">:</span><span class="s2">&quot;1.8.1&quot;</span><span class="p">})})(</span><span class="nx">jQuery</span><span class="p">);</span>
<span class="p">;</span><span class="cm">/*</span>
<span class="cm"> * jQuery UI Effects 1.8.1</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2010 AUTHORS.txt (http://jqueryui.com/about)</span>
<span class="cm"> * Dual licensed under the MIT (MIT-LICENSE.txt)</span>
<span class="cm"> * and GPL (GPL-LICENSE.txt) licenses.</span>
<span class="cm"> *</span>
<span class="cm"> * http://docs.jquery.com/UI/Effects/</span>
<span class="cm"> */</span>
<span class="nx">jQuery</span><span class="p">.</span><span class="nx">effects</span><span class="o">||</span><span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">){</span><span class="kd">function</span> <span class="nx">k</span><span class="p">(</span><span class="nx">c</span><span class="p">){</span><span class="kd">var</span> <span class="nx">a</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">c</span><span class="o">&amp;&amp;</span><span class="nx">c</span><span class="p">.</span><span class="nx">constructor</span><span class="o">==</span><span class="nb">Array</span><span class="o">&amp;&amp;</span><span class="nx">c</span><span class="p">.</span><span class="nx">length</span><span class="o">==</span><span class="mi">3</span><span class="p">)</span><span class="k">return</span> <span class="nx">c</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="o">=</span><span class="sr">/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">c</span><span class="p">))</span><span class="k">return</span><span class="p">[</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">10</span><span class="p">),</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="mi">10</span><span class="p">),</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="mi">10</span><span class="p">)];</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="o">=</span><span class="sr">/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">c</span><span class="p">))</span><span class="k">return</span><span class="p">[</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">2.55</span><span class="p">,</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="mf">2.55</span><span class="p">,</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">*</span><span class="mf">2.55</span><span class="p">];</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="o">=</span><span class="sr">/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">c</span><span class="p">))</span><span class="k">return</span><span class="p">[</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="mi">16</span><span class="p">),</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="mi">16</span><span class="p">),</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="mi">16</span><span class="p">)];</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="o">=</span><span class="sr">/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">c</span><span class="p">))</span><span class="k">return</span><span class="p">[</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="nx">a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">16</span><span class="p">),</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="nx">a</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="mi">16</span><span class="p">),</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="nx">a</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="mi">16</span><span class="p">)];</span><span class="k">if</span><span class="p">(</span><span class="sr">/rgba\(0, 0, 0, 0\)/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">c</span><span class="p">))</span><span class="k">return</span> <span class="nx">l</span><span class="p">.</span><span class="nx">transparent</span><span class="p">;</span><span class="k">return</span> <span class="nx">l</span><span class="p">[</span><span class="nx">f</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span><span class="nx">c</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">()]}</span><span class="kd">function</span> <span class="nx">q</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">){</span><span class="kd">var</span> <span class="nx">b</span><span class="p">;</span><span class="k">do</span><span class="p">{</span><span class="nx">b</span><span class="o">=</span><span class="nx">f</span><span class="p">.</span><span class="nx">curCSS</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">b</span><span class="o">!=</span><span class="s2">&quot;&quot;</span><span class="o">&amp;&amp;</span><span class="nx">b</span><span class="o">!=</span><span class="s2">&quot;transparent&quot;</span><span class="o">||</span><span class="nx">f</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="s2">&quot;body&quot;</span><span class="p">))</span><span class="k">break</span><span class="p">;</span><span class="nx">a</span><span class="o">=</span><span class="s2">&quot;backgroundColor&quot;</span><span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="nx">c</span><span class="o">=</span><span class="nx">c</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">);</span><span class="k">return</span> <span class="nx">k</span><span class="p">(</span><span class="nx">b</span><span class="p">)}</span><span class="kd">function</span> <span class="nx">m</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">c</span><span class="o">=</span><span class="nb">document</span><span class="p">.</span><span class="nx">defaultView</span><span class="o">?</span><span class="nb">document</span><span class="p">.</span><span class="nx">defaultView</span><span class="p">.</span><span class="nx">getComputedStyle</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="kc">null</span><span class="p">)</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">currentStyle</span><span class="p">,</span>
<span class="nx">a</span><span class="o">=</span><span class="p">{},</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">c</span><span class="o">&amp;&amp;</span><span class="nx">c</span><span class="p">.</span><span class="nx">length</span><span class="o">&amp;&amp;</span><span class="nx">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&amp;&amp;</span><span class="nx">c</span><span class="p">[</span><span class="nx">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="nx">c</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">e</span><span class="o">--</span><span class="p">;){</span><span class="nx">b</span><span class="o">=</span><span class="nx">c</span><span class="p">[</span><span class="nx">e</span><span class="p">];</span><span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">c</span><span class="p">[</span><span class="nx">b</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;string&quot;</span><span class="p">){</span><span class="nx">d</span><span class="o">=</span><span class="nx">b</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\-(\w)/g</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">g</span><span class="p">,</span><span class="nx">h</span><span class="p">){</span><span class="k">return</span> <span class="nx">h</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()});</span><span class="nx">a</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span><span class="o">=</span><span class="nx">c</span><span class="p">[</span><span class="nx">b</span><span class="p">]}}</span><span class="k">else</span> <span class="k">for</span><span class="p">(</span><span class="nx">b</span> <span class="k">in</span> <span class="nx">c</span><span class="p">)</span><span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">c</span><span class="p">[</span><span class="nx">b</span><span class="p">]</span><span class="o">===</span><span class="s2">&quot;string&quot;</span><span class="p">)</span><span class="nx">a</span><span class="p">[</span><span class="nx">b</span><span class="p">]</span><span class="o">=</span><span class="nx">c</span><span class="p">[</span><span class="nx">b</span><span class="p">];</span><span class="k">return</span> <span class="nx">a</span><span class="p">}</span><span class="kd">function</span> <span class="nx">n</span><span class="p">(</span><span class="nx">c</span><span class="p">){</span><span class="kd">var</span> <span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">;</span><span class="k">for</span><span class="p">(</span><span class="nx">a</span> <span class="k">in</span> <span class="nx">c</span><span class="p">){</span><span class="nx">b</span><span class="o">=</span><span class="nx">c</span><span class="p">[</span><span class="nx">a</span><span class="p">];</span><span class="k">if</span><span class="p">(</span><span class="nx">b</span><span class="o">==</span><span class="kc">null</span><span class="o">||</span><span class="nx">f</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span><span class="o">||</span><span class="nx">a</span> <span class="k">in</span> <span class="nx">r</span><span class="o">||</span><span class="sr">/scrollbar/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span><span class="o">||!</span><span class="sr">/color/i</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="nb">isNaN</span><span class="p">(</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">b</span><span class="p">)))</span><span class="k">delete</span> <span class="nx">c</span><span class="p">[</span><span class="nx">a</span><span class="p">]}</span><span class="k">return</span> <span class="nx">c</span><span class="p">}</span><span class="kd">function</span> <span class="nx">s</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">){</span><span class="kd">var</span> <span class="nx">b</span><span class="o">=</span><span class="p">{</span><span class="nx">_</span><span class="o">:</span><span class="mi">0</span><span class="p">},</span><span class="nx">d</span><span class="p">;</span><span class="k">for</span><span class="p">(</span><span class="nx">d</span> <span class="k">in</span> <span class="nx">a</span><span class="p">)</span><span class="k">if</span><span class="p">(</span><span class="nx">c</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span><span class="o">!=</span><span class="nx">a</span><span class="p">[</span><span class="nx">d</span><span class="p">])</span><span class="nx">b</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span><span class="o">=</span><span class="nx">a</span><span class="p">[</span><span class="nx">d</span><span class="p">];</span><span class="k">return</span> <span class="nx">b</span><span class="p">}</span><span class="kd">function</span> <span class="nx">j</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">c</span><span class="o">==</span><span class="s2">&quot;object&quot;</span><span class="p">){</span><span class="nx">d</span><span class="o">=</span>
<span class="nx">a</span><span class="p">;</span><span class="nx">b</span><span class="o">=</span><span class="kc">null</span><span class="p">;</span><span class="nx">a</span><span class="o">=</span><span class="nx">c</span><span class="p">;</span><span class="nx">c</span><span class="o">=</span><span class="nx">a</span><span class="p">.</span><span class="nx">effect</span><span class="p">}</span><span class="k">if</span><span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">a</span><span class="p">)){</span><span class="nx">d</span><span class="o">=</span><span class="nx">a</span><span class="p">;</span><span class="nx">b</span><span class="o">=</span><span class="kc">null</span><span class="p">;</span><span class="nx">a</span><span class="o">=</span><span class="p">{}}</span><span class="k">if</span><span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">b</span><span class="p">)){</span><span class="nx">d</span><span class="o">=</span><span class="nx">b</span><span class="p">;</span><span class="nx">b</span><span class="o">=</span><span class="kc">null</span><span class="p">}</span><span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">a</span><span class="o">==</span><span class="s2">&quot;number&quot;</span><span class="o">||</span><span class="nx">f</span><span class="p">.</span><span class="nx">fx</span><span class="p">.</span><span class="nx">speeds</span><span class="p">[</span><span class="nx">a</span><span class="p">]){</span><span class="nx">d</span><span class="o">=</span><span class="nx">b</span><span class="p">;</span><span class="nx">b</span><span class="o">=</span><span class="nx">a</span><span class="p">;</span><span class="nx">a</span><span class="o">=</span><span class="p">{}}</span><span class="nx">a</span><span class="o">=</span><span class="nx">a</span><span class="o">||</span><span class="p">{};</span><span class="nx">b</span><span class="o">=</span><span class="nx">b</span><span class="o">||</span><span class="nx">a</span><span class="p">.</span><span class="nx">duration</span><span class="p">;</span><span class="nx">b</span><span class="o">=</span><span class="nx">f</span><span class="p">.</span><span class="nx">fx</span><span class="p">.</span><span class="nx">off</span><span class="o">?</span><span class="mi">0</span><span class="o">:</span><span class="k">typeof</span> <span class="nx">b</span><span class="o">==</span><span class="s2">&quot;number&quot;</span><span class="o">?</span><span class="nx">b</span><span class="o">:</span><span class="nx">f</span><span class="p">.</span><span class="nx">fx</span><span class="p">.</span><span class="nx">speeds</span><span class="p">[</span><span class="nx">b</span><span class="p">]</span><span class="o">||</span><span class="nx">f</span><span class="p">.</span><span class="nx">fx</span><span class="p">.</span><span class="nx">speeds</span><span class="p">.</span><span class="nx">_default</span><span class="p">;</span><span class="nx">d</span><span class="o">=</span><span class="nx">d</span><span class="o">||</span><span class="nx">a</span><span class="p">.</span><span class="nx">complete</span><span class="p">;</span><span class="k">return</span><span class="p">[</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">]}</span><span class="nx">f</span><span class="p">.</span><span class="nx">effects</span><span class="o">=</span><span class="p">{};</span><span class="nx">f</span><span class="p">.</span><span class="nx">each</span><span class="p">([</span><span class="s2">&quot;backgroundColor&quot;</span><span class="p">,</span><span class="s2">&quot;borderBottomColor&quot;</span><span class="p">,</span><span class="s2">&quot;borderLeftColor&quot;</span><span class="p">,</span><span class="s2">&quot;borderRightColor&quot;</span><span class="p">,</span><span class="s2">&quot;borderTopColor&quot;</span><span class="p">,</span><span class="s2">&quot;color&quot;</span><span class="p">,</span><span class="s2">&quot;outlineColor&quot;</span><span class="p">],</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">){</span><span class="nx">f</span><span class="p">.</span><span class="nx">fx</span><span class="p">.</span><span class="nx">step</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">b</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">b</span><span class="p">.</span><span class="nx">colorInit</span><span class="p">){</span><span class="nx">b</span><span class="p">.</span><span class="nx">start</span><span class="o">=</span><span class="nx">q</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">elem</span><span class="p">,</span><span class="nx">a</span><span class="p">);</span><span class="nx">b</span><span class="p">.</span><span class="nx">end</span><span class="o">=</span><span class="nx">k</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">end</span><span class="p">);</span><span class="nx">b</span><span class="p">.</span><span class="nx">colorInit</span><span class="o">=</span>
<span class="kc">true</span><span class="p">}</span><span class="nx">b</span><span class="p">.</span><span class="nx">elem</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="nx">a</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;rgb(&quot;</span><span class="o">+</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">pos</span><span class="o">*</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">end</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="nx">b</span><span class="p">.</span><span class="nx">start</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="nx">b</span><span class="p">.</span><span class="nx">start</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">10</span><span class="p">),</span><span class="mi">255</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">pos</span><span class="o">*</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">end</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="nx">b</span><span class="p">.</span><span class="nx">start</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="nx">b</span><span class="p">.</span><span class="nx">start</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">10</span><span class="p">),</span><span class="mi">255</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">pos</span><span class="o">*</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">end</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="nx">b</span><span class="p">.</span><span class="nx">start</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="nx">b</span><span class="p">.</span><span class="nx">start</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="mi">10</span><span class="p">),</span><span class="mi">255</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">}});</span><span class="kd">var</span> <span class="nx">l</span><span class="o">=</span><span class="p">{</span><span class="nx">aqua</span><span class="o">:</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">],</span><span class="nx">azure</span><span class="o">:</span><span class="p">[</span><span class="mi">240</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">],</span><span class="nx">beige</span><span class="o">:</span><span class="p">[</span><span class="mi">245</span><span class="p">,</span><span class="mi">245</span><span class="p">,</span><span class="mi">220</span><span class="p">],</span><span class="nx">black</span><span class="o">:</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="nx">blue</span><span class="o">:</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">],</span><span class="nx">brown</span><span class="o">:</span><span class="p">[</span><span class="mi">165</span><span class="p">,</span><span class="mi">42</span><span class="p">,</span><span class="mi">42</span><span class="p">],</span><span class="nx">cyan</span><span class="o">:</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">],</span><span class="nx">darkblue</span><span class="o">:</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">139</span><span class="p">],</span><span class="nx">darkcyan</span><span class="o">:</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">139</span><span class="p">,</span><span class="mi">139</span><span class="p">],</span><span class="nx">darkgrey</span><span class="o">:</span><span class="p">[</span><span class="mi">169</span><span class="p">,</span><span class="mi">169</span><span class="p">,</span><span class="mi">169</span><span class="p">],</span><span class="nx">darkgreen</span><span class="o">:</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="nx">darkkhaki</span><span class="o">:</span><span class="p">[</span><span class="mi">189</span><span class="p">,</span>
<span class="mi">183</span><span class="p">,</span><span class="mi">107</span><span class="p">],</span><span class="nx">darkmagenta</span><span class="o">:</span><span class="p">[</span><span class="mi">139</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">139</span><span class="p">],</span><span class="nx">darkolivegreen</span><span class="o">:</span><span class="p">[</span><span class="mi">85</span><span class="p">,</span><span class="mi">107</span><span class="p">,</span><span class="mi">47</span><span class="p">],</span><span class="nx">darkorange</span><span class="o">:</span><span class="p">[</span><span class="mi">255</span><span class="p">,</span><span class="mi">140</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="nx">darkorchid</span><span class="o">:</span><span class="p">[</span><span class="mi">153</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">204</span><span class="p">],</span><span class="nx">darkred</span><span class="o">:</span><span class="p">[</span><span class="mi">139</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="nx">darksalmon</span><span class="o">:</span><span class="p">[</span><span class="mi">233</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">122</span><span class="p">],</span><span class="nx">darkviolet</span><span class="o">:</span><span class="p">[</span><span class="mi">148</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">211</span><span class="p">],</span><span class="nx">fuchsia</span><span class="o">:</span><span class="p">[</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">],</span><span class="nx">gold</span><span class="o">:</span><span class="p">[</span><span class="mi">255</span><span class="p">,</span><span class="mi">215</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="nx">green</span><span class="o">:</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="nx">indigo</span><span class="o">:</span><span class="p">[</span><span class="mi">75</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">130</span><span class="p">],</span><span class="nx">khaki</span><span class="o">:</span><span class="p">[</span><span class="mi">240</span><span class="p">,</span><span class="mi">230</span><span class="p">,</span><span class="mi">140</span><span class="p">],</span><span class="nx">lightblue</span><span class="o">:</span><span class="p">[</span><span class="mi">173</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span><span class="mi">230</span><span class="p">],</span><span class="nx">lightcyan</span><span class="o">:</span><span class="p">[</span><span class="mi">224</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">],</span><span class="nx">lightgreen</span><span class="o">:</span><span class="p">[</span><span class="mi">144</span><span class="p">,</span><span class="mi">238</span><span class="p">,</span><span class="mi">144</span><span class="p">],</span><span class="nx">lightgrey</span><span class="o">:</span><span class="p">[</span><span class="mi">211</span><span class="p">,</span><span class="mi">211</span><span class="p">,</span><span class="mi">211</span><span class="p">],</span><span class="nx">lightpink</span><span class="o">:</span><span class="p">[</span><span class="mi">255</span><span class="p">,</span><span class="mi">182</span><span class="p">,</span><span class="mi">193</span><span class="p">],</span><span class="nx">lightyellow</span><span class="o">:</span><span class="p">[</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">224</span><span class="p">],</span><span class="nx">lime</span><span class="o">:</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="nx">magenta</span><span class="o">:</span><span class="p">[</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">],</span><span class="nx">maroon</span><span class="o">:</span><span class="p">[</span><span class="mi">128</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="nx">navy</span><span class="o">:</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">128</span><span class="p">],</span><span class="nx">olive</span><span class="o">:</span><span class="p">[</span><span class="mi">128</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="nx">orange</span><span class="o">:</span><span class="p">[</span><span class="mi">255</span><span class="p">,</span>
<span class="mi">165</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="nx">pink</span><span class="o">:</span><span class="p">[</span><span class="mi">255</span><span class="p">,</span><span class="mi">192</span><span class="p">,</span><span class="mi">203</span><span class="p">],</span><span class="nx">purple</span><span class="o">:</span><span class="p">[</span><span class="mi">128</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">128</span><span class="p">],</span><span class="nx">violet</span><span class="o">:</span><span class="p">[</span><span class="mi">128</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">128</span><span class="p">],</span><span class="nx">red</span><span class="o">:</span><span class="p">[</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="nx">silver</span><span class="o">:</span><span class="p">[</span><span class="mi">192</span><span class="p">,</span><span class="mi">192</span><span class="p">,</span><span class="mi">192</span><span class="p">],</span><span class="nx">white</span><span class="o">:</span><span class="p">[</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">],</span><span class="nx">yellow</span><span class="o">:</span><span class="p">[</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="nx">transparent</span><span class="o">:</span><span class="p">[</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">]},</span><span class="nx">o</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;add&quot;</span><span class="p">,</span><span class="s2">&quot;remove&quot;</span><span class="p">,</span><span class="s2">&quot;toggle&quot;</span><span class="p">],</span><span class="nx">r</span><span class="o">=</span><span class="p">{</span><span class="nx">border</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">borderBottom</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">borderColor</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">borderLeft</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">borderRight</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">borderTop</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">borderWidth</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">margin</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">padding</span><span class="o">:</span><span class="mi">1</span><span class="p">};</span><span class="nx">f</span><span class="p">.</span><span class="nx">effects</span><span class="p">.</span><span class="nx">animateClass</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">b</span><span class="p">)){</span><span class="nx">d</span><span class="o">=</span><span class="nx">b</span><span class="p">;</span><span class="nx">b</span><span class="o">=</span><span class="kc">null</span><span class="p">}</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="nx">f</span><span class="p">(</span><span class="k">this</span><span class="p">),</span><span class="nx">g</span><span class="o">=</span><span class="nx">e</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;style&quot;</span><span class="p">)</span><span class="o">||</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="nx">h</span><span class="o">=</span><span class="nx">n</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">)),</span><span class="nx">p</span><span class="p">,</span><span class="nx">t</span><span class="o">=</span><span class="nx">e</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;className&quot;</span><span class="p">);</span><span class="nx">f</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">u</span><span class="p">,</span>
<span class="nx">i</span><span class="p">){</span><span class="nx">c</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">&amp;&amp;</span><span class="nx">e</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="s2">&quot;Class&quot;</span><span class="p">](</span><span class="nx">c</span><span class="p">[</span><span class="nx">i</span><span class="p">])});</span><span class="nx">p</span><span class="o">=</span><span class="nx">n</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">));</span><span class="nx">e</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;className&quot;</span><span class="p">,</span><span class="nx">t</span><span class="p">);</span><span class="nx">e</span><span class="p">.</span><span class="nx">animate</span><span class="p">(</span><span class="nx">s</span><span class="p">(</span><span class="nx">h</span><span class="p">,</span><span class="nx">p</span><span class="p">),</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span><span class="nx">f</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">u</span><span class="p">,</span><span class="nx">i</span><span class="p">){</span><span class="nx">c</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">&amp;&amp;</span><span class="nx">e</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="s2">&quot;Class&quot;</span><span class="p">](</span><span class="nx">c</span><span class="p">[</span><span class="nx">i</span><span class="p">])});</span><span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">e</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;style&quot;</span><span class="p">)</span><span class="o">==</span><span class="s2">&quot;object&quot;</span><span class="p">){</span><span class="nx">e</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;style&quot;</span><span class="p">).</span><span class="nx">cssText</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">;</span><span class="nx">e</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;style&quot;</span><span class="p">).</span><span class="nx">cssText</span><span class="o">=</span><span class="nx">g</span><span class="p">}</span><span class="k">else</span> <span class="nx">e</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;style&quot;</span><span class="p">,</span><span class="nx">g</span><span class="p">);</span><span class="nx">d</span><span class="o">&amp;&amp;</span><span class="nx">d</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">arguments</span><span class="p">)})})};</span><span class="nx">f</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span><span class="nx">_addClass</span><span class="o">:</span><span class="nx">f</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">addClass</span><span class="p">,</span><span class="nx">addClass</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">){</span><span class="k">return</span> <span class="nx">a</span><span class="o">?</span><span class="nx">f</span><span class="p">.</span><span class="nx">effects</span><span class="p">.</span><span class="nx">animateClass</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,[{</span><span class="nx">add</span><span class="o">:</span><span class="nx">c</span><span class="p">},</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">])</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">_addClass</span><span class="p">(</span><span class="nx">c</span><span class="p">)},</span><span class="nx">_removeClass</span><span class="o">:</span><span class="nx">f</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">,</span><span class="nx">removeClass</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">){</span><span class="k">return</span> <span class="nx">a</span><span class="o">?</span>
<span class="nx">f</span><span class="p">.</span><span class="nx">effects</span><span class="p">.</span><span class="nx">animateClass</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,[{</span><span class="nx">remove</span><span class="o">:</span><span class="nx">c</span><span class="p">},</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">])</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">_removeClass</span><span class="p">(</span><span class="nx">c</span><span class="p">)},</span><span class="nx">_toggleClass</span><span class="o">:</span><span class="nx">f</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">toggleClass</span><span class="p">,</span><span class="nx">toggleClass</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span> <span class="k">typeof</span> <span class="nx">a</span><span class="o">==</span><span class="s2">&quot;boolean&quot;</span><span class="o">||</span><span class="nx">a</span><span class="o">===</span><span class="kc">undefined</span><span class="o">?</span><span class="nx">b</span><span class="o">?</span><span class="nx">f</span><span class="p">.</span><span class="nx">effects</span><span class="p">.</span><span class="nx">animateClass</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,[</span><span class="nx">a</span><span class="o">?</span><span class="p">{</span><span class="nx">add</span><span class="o">:</span><span class="nx">c</span><span class="p">}</span><span class="o">:</span><span class="p">{</span><span class="nx">remove</span><span class="o">:</span><span class="nx">c</span><span class="p">},</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">])</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">_toggleClass</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">)</span><span class="o">:</span><span class="nx">f</span><span class="p">.</span><span class="nx">effects</span><span class="p">.</span><span class="nx">animateClass</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,[{</span><span class="nx">toggle</span><span class="o">:</span><span class="nx">c</span><span class="p">},</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">])},</span><span class="nx">switchClass</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span> <span class="nx">f</span><span class="p">.</span><span class="nx">effects</span><span class="p">.</span><span class="nx">animateClass</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,[{</span><span class="nx">add</span><span class="o">:</span><span class="nx">a</span><span class="p">,</span><span class="nx">remove</span><span class="o">:</span><span class="nx">c</span><span class="p">},</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">])}});</span><span class="nx">f</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">effects</span><span class="p">,{</span><span class="nx">version</span><span class="o">:</span><span class="s2">&quot;1.8.1&quot;</span><span class="p">,</span><span class="nx">save</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">){</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">b</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">b</span><span class="o">&lt;</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">b</span><span class="o">++</span><span class="p">)</span><span class="nx">a</span><span class="p">[</span><span class="nx">b</span><span class="p">]</span><span class="o">!==</span>
<span class="kc">null</span><span class="o">&amp;&amp;</span><span class="nx">c</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;ec.storage.&quot;</span><span class="o">+</span><span class="nx">a</span><span class="p">[</span><span class="nx">b</span><span class="p">],</span><span class="nx">c</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">style</span><span class="p">[</span><span class="nx">a</span><span class="p">[</span><span class="nx">b</span><span class="p">]])},</span><span class="nx">restore</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">){</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">b</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">b</span><span class="o">&lt;</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">b</span><span class="o">++</span><span class="p">)</span><span class="nx">a</span><span class="p">[</span><span class="nx">b</span><span class="p">]</span><span class="o">!==</span><span class="kc">null</span><span class="o">&amp;&amp;</span><span class="nx">c</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">b</span><span class="p">],</span><span class="nx">c</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;ec.storage.&quot;</span><span class="o">+</span><span class="nx">a</span><span class="p">[</span><span class="nx">b</span><span class="p">]))},</span><span class="nx">setMode</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="o">==</span><span class="s2">&quot;toggle&quot;</span><span class="p">)</span><span class="nx">a</span><span class="o">=</span><span class="nx">c</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="s2">&quot;:hidden&quot;</span><span class="p">)</span><span class="o">?</span><span class="s2">&quot;show&quot;</span><span class="o">:</span><span class="s2">&quot;hide&quot;</span><span class="p">;</span><span class="k">return</span> <span class="nx">a</span><span class="p">},</span><span class="nx">getBaseline</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">){</span><span class="kd">var</span> <span class="nx">b</span><span class="p">;</span><span class="k">switch</span><span class="p">(</span><span class="nx">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]){</span><span class="k">case</span> <span class="s2">&quot;top&quot;</span><span class="o">:</span><span class="nx">b</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="k">break</span><span class="p">;</span><span class="k">case</span> <span class="s2">&quot;middle&quot;</span><span class="o">:</span><span class="nx">b</span><span class="o">=</span><span class="mf">0.5</span><span class="p">;</span><span class="k">break</span><span class="p">;</span><span class="k">case</span> <span class="s2">&quot;bottom&quot;</span><span class="o">:</span><span class="nx">b</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="k">break</span><span class="p">;</span><span class="k">default</span><span class="o">:</span><span class="nx">b</span><span class="o">=</span><span class="nx">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="nx">a</span><span class="p">.</span><span class="nx">height</span><span class="p">}</span><span class="k">switch</span><span class="p">(</span><span class="nx">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]){</span><span class="k">case</span> <span class="s2">&quot;left&quot;</span><span class="o">:</span><span class="nx">c</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="k">break</span><span class="p">;</span><span class="k">case</span> <span class="s2">&quot;center&quot;</span><span class="o">:</span><span class="nx">c</span><span class="o">=</span><span class="mf">0.5</span><span class="p">;</span><span class="k">break</span><span class="p">;</span><span class="k">case</span> <span class="s2">&quot;right&quot;</span><span class="o">:</span><span class="nx">c</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="k">break</span><span class="p">;</span><span class="k">default</span><span class="o">:</span><span class="nx">c</span><span class="o">=</span><span class="nx">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="nx">a</span><span class="p">.</span><span class="nx">width</span><span class="p">}</span><span class="k">return</span><span class="p">{</span><span class="nx">x</span><span class="o">:</span><span class="nx">c</span><span class="p">,</span><span class="nx">y</span><span class="o">:</span><span class="nx">b</span><span class="p">}},</span><span class="nx">createWrapper</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">parent</span><span class="p">().</span><span class="nx">is</span><span class="p">(</span><span class="s2">&quot;.ui-effects-wrapper&quot;</span><span class="p">))</span><span class="k">return</span> <span class="nx">c</span><span class="p">.</span><span class="nx">parent</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">a</span><span class="o">=</span><span class="p">{</span><span class="nx">width</span><span class="o">:</span><span class="nx">c</span><span class="p">.</span><span class="nx">outerWidth</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span><span class="nx">height</span><span class="o">:</span><span class="nx">c</span><span class="p">.</span><span class="nx">outerHeight</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span><span class="s2">&quot;float&quot;</span><span class="o">:</span><span class="nx">c</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)},</span><span class="nx">b</span><span class="o">=</span><span class="nx">f</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;&lt;/div&gt;&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;ui-effects-wrapper&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span><span class="nx">fontSize</span><span class="o">:</span><span class="s2">&quot;100%&quot;</span><span class="p">,</span><span class="nx">background</span><span class="o">:</span><span class="s2">&quot;transparent&quot;</span><span class="p">,</span><span class="nx">border</span><span class="o">:</span><span class="s2">&quot;none&quot;</span><span class="p">,</span><span class="nx">margin</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="nx">padding</span><span class="o">:</span><span class="mi">0</span><span class="p">});</span><span class="nx">c</span><span class="p">.</span><span class="nx">wrap</span><span class="p">(</span><span class="nx">b</span><span class="p">);</span><span class="nx">b</span><span class="o">=</span><span class="nx">c</span><span class="p">.</span><span class="nx">parent</span><span class="p">();</span><span class="k">if</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">)</span><span class="o">==</span><span class="s2">&quot;static&quot;</span><span class="p">){</span><span class="nx">b</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span><span class="nx">position</span><span class="o">:</span><span class="s2">&quot;relative&quot;</span><span class="p">});</span><span class="nx">c</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span><span class="nx">position</span><span class="o">:</span><span class="s2">&quot;relative&quot;</span><span class="p">})}</span><span class="k">else</span><span class="p">{</span><span class="nx">f</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">a</span><span class="p">,{</span><span class="nx">position</span><span class="o">:</span><span class="nx">c</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;position&quot;</span><span class="p">),</span><span class="nx">zIndex</span><span class="o">:</span><span class="nx">c</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s2">&quot;z-index&quot;</span><span class="p">)});</span><span class="nx">f</span><span class="p">.</span><span class="nx">each</span><span class="p">([</span><span class="s2">&quot;top&quot;</span><span class="p">,</span><span class="s2">&quot;left&quot;</span><span class="p">,</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span><span class="s2">&quot;right&quot;</span><span class="p">],</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="nx">a</span><span class="p">[</span><span class="nx">e</span><span class="p">]</span><span class="o">=</span><span class="nx">c</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nb">isNaN</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">e</span><span class="p">],</span><span class="mi">10</span><span class="p">)))</span><span class="nx">a</span><span class="p">[</span><span class="nx">e</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">});</span>
<span class="nx">c</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span><span class="nx">position</span><span class="o">:</span><span class="s2">&quot;relative&quot;</span><span class="p">,</span><span class="nx">top</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="nx">left</span><span class="o">:</span><span class="mi">0</span><span class="p">})}</span><span class="k">return</span> <span class="nx">b</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="nx">a</span><span class="p">).</span><span class="nx">show</span><span class="p">()},</span><span class="nx">removeWrapper</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">parent</span><span class="p">().</span><span class="nx">is</span><span class="p">(</span><span class="s2">&quot;.ui-effects-wrapper&quot;</span><span class="p">))</span><span class="k">return</span> <span class="nx">c</span><span class="p">.</span><span class="nx">parent</span><span class="p">().</span><span class="nx">replaceWith</span><span class="p">(</span><span class="nx">c</span><span class="p">);</span><span class="k">return</span> <span class="nx">c</span><span class="p">},</span><span class="nx">setTransition</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">){</span><span class="nx">d</span><span class="o">=</span><span class="nx">d</span><span class="o">||</span><span class="p">{};</span><span class="nx">f</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span><span class="nx">g</span><span class="p">){</span><span class="nx">unit</span><span class="o">=</span><span class="nx">c</span><span class="p">.</span><span class="nx">cssUnit</span><span class="p">(</span><span class="nx">g</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">unit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="nx">d</span><span class="p">[</span><span class="nx">g</span><span class="p">]</span><span class="o">=</span><span class="nx">unit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nx">b</span><span class="o">+</span><span class="nx">unit</span><span class="p">[</span><span class="mi">1</span><span class="p">]});</span><span class="k">return</span> <span class="nx">d</span><span class="p">}});</span><span class="nx">f</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span><span class="nx">effect</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">){</span><span class="kd">var</span> <span class="nx">a</span><span class="o">=</span><span class="nx">j</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">arguments</span><span class="p">);</span><span class="nx">a</span><span class="o">=</span><span class="p">{</span><span class="nx">options</span><span class="o">:</span><span class="nx">a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nx">duration</span><span class="o">:</span><span class="nx">a</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="nx">callback</span><span class="o">:</span><span class="nx">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]};</span><span class="kd">var</span> <span class="nx">b</span><span class="o">=</span><span class="nx">f</span><span class="p">.</span><span class="nx">effects</span><span class="p">[</span><span class="nx">c</span><span class="p">];</span><span class="k">return</span> <span class="nx">b</span><span class="o">&amp;&amp;!</span><span class="nx">f</span><span class="p">.</span><span class="nx">fx</span><span class="p">.</span><span class="nx">off</span><span class="o">?</span><span class="nx">b</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">a</span><span class="p">)</span><span class="o">:</span><span class="k">this</span><span class="p">},</span><span class="nx">_show</span><span class="o">:</span><span class="nx">f</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">show</span><span class="p">,</span><span class="nx">show</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">c</span><span class="o">||</span>
<span class="k">typeof</span> <span class="nx">c</span><span class="o">==</span><span class="s2">&quot;number&quot;</span><span class="o">||</span><span class="nx">f</span><span class="p">.</span><span class="nx">fx</span><span class="p">.</span><span class="nx">speeds</span><span class="p">[</span><span class="nx">c</span><span class="p">])</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_show</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">arguments</span><span class="p">);</span><span class="k">else</span><span class="p">{</span><span class="kd">var</span> <span class="nx">a</span><span class="o">=</span><span class="nx">j</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">arguments</span><span class="p">);</span><span class="nx">a</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">mode</span><span class="o">=</span><span class="s2">&quot;show&quot;</span><span class="p">;</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">effect</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">a</span><span class="p">)}},</span><span class="nx">_hide</span><span class="o">:</span><span class="nx">f</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">hide</span><span class="p">,</span><span class="nx">hide</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">c</span><span class="o">||</span><span class="k">typeof</span> <span class="nx">c</span><span class="o">==</span><span class="s2">&quot;number&quot;</span><span class="o">||</span><span class="nx">f</span><span class="p">.</span><span class="nx">fx</span><span class="p">.</span><span class="nx">speeds</span><span class="p">[</span><span class="nx">c</span><span class="p">])</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_hide</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">arguments</span><span class="p">);</span><span class="k">else</span><span class="p">{</span><span class="kd">var</span> <span class="nx">a</span><span class="o">=</span><span class="nx">j</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">arguments</span><span class="p">);</span><span class="nx">a</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">mode</span><span class="o">=</span><span class="s2">&quot;hide&quot;</span><span class="p">;</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">effect</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">a</span><span class="p">)}},</span><span class="nx">__toggle</span><span class="o">:</span><span class="nx">f</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">toggle</span><span class="p">,</span><span class="nx">toggle</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">c</span><span class="o">||</span><span class="k">typeof</span> <span class="nx">c</span><span class="o">==</span><span class="s2">&quot;number&quot;</span><span class="o">||</span><span class="nx">f</span><span class="p">.</span><span class="nx">fx</span><span class="p">.</span><span class="nx">speeds</span><span class="p">[</span><span class="nx">c</span><span class="p">]</span><span class="o">||</span><span class="k">typeof</span> <span class="nx">c</span><span class="o">==</span><span class="s2">&quot;boolean&quot;</span><span class="o">||</span><span class="nx">f</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">c</span><span class="p">))</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">__toggle</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span>
<span class="nx">arguments</span><span class="p">);</span><span class="k">else</span><span class="p">{</span><span class="kd">var</span> <span class="nx">a</span><span class="o">=</span><span class="nx">j</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">arguments</span><span class="p">);</span><span class="nx">a</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">mode</span><span class="o">=</span><span class="s2">&quot;toggle&quot;</span><span class="p">;</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">effect</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">a</span><span class="p">)}},</span><span class="nx">cssUnit</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">){</span><span class="kd">var</span> <span class="nx">a</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="nx">c</span><span class="p">),</span><span class="nx">b</span><span class="o">=</span><span class="p">[];</span><span class="nx">f</span><span class="p">.</span><span class="nx">each</span><span class="p">([</span><span class="s2">&quot;em&quot;</span><span class="p">,</span><span class="s2">&quot;px&quot;</span><span class="p">,</span><span class="s2">&quot;%&quot;</span><span class="p">,</span><span class="s2">&quot;pt&quot;</span><span class="p">],</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="nx">b</span><span class="o">=</span><span class="p">[</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">a</span><span class="p">),</span><span class="nx">e</span><span class="p">]});</span><span class="k">return</span> <span class="nx">b</span><span class="p">}});</span><span class="nx">f</span><span class="p">.</span><span class="nx">easing</span><span class="p">.</span><span class="nx">jswing</span><span class="o">=</span><span class="nx">f</span><span class="p">.</span><span class="nx">easing</span><span class="p">.</span><span class="nx">swing</span><span class="p">;</span><span class="nx">f</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">easing</span><span class="p">,{</span><span class="nx">def</span><span class="o">:</span><span class="s2">&quot;easeOutQuad&quot;</span><span class="p">,</span><span class="nx">swing</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span> <span class="nx">f</span><span class="p">.</span><span class="nx">easing</span><span class="p">[</span><span class="nx">f</span><span class="p">.</span><span class="nx">easing</span><span class="p">.</span><span class="nx">def</span><span class="p">](</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">)},</span><span class="nx">easeInQuad</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span> <span class="nx">d</span><span class="o">*</span><span class="p">(</span><span class="nx">a</span><span class="o">/=</span><span class="nx">e</span><span class="p">)</span><span class="o">*</span><span class="nx">a</span><span class="o">+</span><span class="nx">b</span><span class="p">},</span><span class="nx">easeOutQuad</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span><span class="o">-</span><span class="nx">d</span><span class="o">*</span><span class="p">(</span><span class="nx">a</span><span class="o">/=</span><span class="nx">e</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="nx">a</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="nx">b</span><span class="p">},</span><span class="nx">easeInOutQuad</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span>
<span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">if</span><span class="p">((</span><span class="nx">a</span><span class="o">/=</span><span class="nx">e</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">)</span><span class="k">return</span> <span class="nx">d</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="nx">a</span><span class="o">*</span><span class="nx">a</span><span class="o">+</span><span class="nx">b</span><span class="p">;</span><span class="k">return</span><span class="o">-</span><span class="nx">d</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="o">--</span><span class="nx">a</span><span class="o">*</span><span class="p">(</span><span class="nx">a</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="nx">b</span><span class="p">},</span><span class="nx">easeInCubic</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span> <span class="nx">d</span><span class="o">*</span><span class="p">(</span><span class="nx">a</span><span class="o">/=</span><span class="nx">e</span><span class="p">)</span><span class="o">*</span><span class="nx">a</span><span class="o">*</span><span class="nx">a</span><span class="o">+</span><span class="nx">b</span><span class="p">},</span><span class="nx">easeOutCubic</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span> <span class="nx">d</span><span class="o">*</span><span class="p">((</span><span class="nx">a</span><span class="o">=</span><span class="nx">a</span><span class="o">/</span><span class="nx">e</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nx">a</span><span class="o">*</span><span class="nx">a</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="nx">b</span><span class="p">},</span><span class="nx">easeInOutCubic</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">if</span><span class="p">((</span><span class="nx">a</span><span class="o">/=</span><span class="nx">e</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">)</span><span class="k">return</span> <span class="nx">d</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="nx">a</span><span class="o">*</span><span class="nx">a</span><span class="o">*</span><span class="nx">a</span><span class="o">+</span><span class="nx">b</span><span class="p">;</span><span class="k">return</span> <span class="nx">d</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="p">((</span><span class="nx">a</span><span class="o">-=</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="nx">a</span><span class="o">*</span><span class="nx">a</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="nx">b</span><span class="p">},</span><span class="nx">easeInQuart</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span> <span class="nx">d</span><span class="o">*</span><span class="p">(</span><span class="nx">a</span><span class="o">/=</span><span class="nx">e</span><span class="p">)</span><span class="o">*</span><span class="nx">a</span><span class="o">*</span><span class="nx">a</span><span class="o">*</span><span class="nx">a</span><span class="o">+</span><span class="nx">b</span><span class="p">},</span><span class="nx">easeOutQuart</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span><span class="o">-</span><span class="nx">d</span><span class="o">*</span><span class="p">((</span><span class="nx">a</span><span class="o">=</span><span class="nx">a</span><span class="o">/</span><span class="nx">e</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nx">a</span><span class="o">*</span><span class="nx">a</span><span class="o">*</span><span class="nx">a</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="nx">b</span><span class="p">},</span><span class="nx">easeInOutQuart</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">if</span><span class="p">((</span><span class="nx">a</span><span class="o">/=</span><span class="nx">e</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">)</span><span class="k">return</span> <span class="nx">d</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="nx">a</span><span class="o">*</span><span class="nx">a</span><span class="o">*</span><span class="nx">a</span><span class="o">*</span><span class="nx">a</span><span class="o">+</span><span class="nx">b</span><span class="p">;</span><span class="k">return</span><span class="o">-</span><span class="nx">d</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="p">((</span><span class="nx">a</span><span class="o">-=</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="nx">a</span><span class="o">*</span><span class="nx">a</span><span class="o">*</span><span class="nx">a</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span>
<span class="nx">b</span><span class="p">},</span><span class="nx">easeInQuint</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span> <span class="nx">d</span><span class="o">*</span><span class="p">(</span><span class="nx">a</span><span class="o">/=</span><span class="nx">e</span><span class="p">)</span><span class="o">*</span><span class="nx">a</span><span class="o">*</span><span class="nx">a</span><span class="o">*</span><span class="nx">a</span><span class="o">*</span><span class="nx">a</span><span class="o">+</span><span class="nx">b</span><span class="p">},</span><span class="nx">easeOutQuint</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span> <span class="nx">d</span><span class="o">*</span><span class="p">((</span><span class="nx">a</span><span class="o">=</span><span class="nx">a</span><span class="o">/</span><span class="nx">e</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nx">a</span><span class="o">*</span><span class="nx">a</span><span class="o">*</span><span class="nx">a</span><span class="o">*</span><span class="nx">a</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="nx">b</span><span class="p">},</span><span class="nx">easeInOutQuint</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">if</span><span class="p">((</span><span class="nx">a</span><span class="o">/=</span><span class="nx">e</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">)</span><span class="k">return</span> <span class="nx">d</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="nx">a</span><span class="o">*</span><span class="nx">a</span><span class="o">*</span><span class="nx">a</span><span class="o">*</span><span class="nx">a</span><span class="o">*</span><span class="nx">a</span><span class="o">+</span><span class="nx">b</span><span class="p">;</span><span class="k">return</span> <span class="nx">d</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="p">((</span><span class="nx">a</span><span class="o">-=</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="nx">a</span><span class="o">*</span><span class="nx">a</span><span class="o">*</span><span class="nx">a</span><span class="o">*</span><span class="nx">a</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="nx">b</span><span class="p">},</span><span class="nx">easeInSine</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span><span class="o">-</span><span class="nx">d</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">a</span><span class="o">/</span><span class="nx">e</span><span class="o">*</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">+</span><span class="nx">d</span><span class="o">+</span><span class="nx">b</span><span class="p">},</span><span class="nx">easeOutSine</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span> <span class="nx">d</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">a</span><span class="o">/</span><span class="nx">e</span><span class="o">*</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">+</span><span class="nx">b</span><span class="p">},</span><span class="nx">easeInOutSine</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span><span class="o">-</span><span class="nx">d</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">*</span><span class="nx">a</span><span class="o">/</span><span class="nx">e</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="nx">b</span><span class="p">},</span><span class="nx">easeInExpo</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span> <span class="nx">a</span><span class="o">==</span><span class="mi">0</span><span class="o">?</span><span class="nx">b</span><span class="o">:</span><span class="nx">d</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
<span class="mi">10</span><span class="o">*</span><span class="p">(</span><span class="nx">a</span><span class="o">/</span><span class="nx">e</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">+</span><span class="nx">b</span><span class="p">},</span><span class="nx">easeOutExpo</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span> <span class="nx">a</span><span class="o">==</span><span class="nx">e</span><span class="o">?</span><span class="nx">b</span><span class="o">+</span><span class="nx">d</span><span class="o">:</span><span class="nx">d</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="o">*</span><span class="nx">a</span><span class="o">/</span><span class="nx">e</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="nx">b</span><span class="p">},</span><span class="nx">easeInOutExpo</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="k">return</span> <span class="nx">b</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="o">==</span><span class="nx">e</span><span class="p">)</span><span class="k">return</span> <span class="nx">b</span><span class="o">+</span><span class="nx">d</span><span class="p">;</span><span class="k">if</span><span class="p">((</span><span class="nx">a</span><span class="o">/=</span><span class="nx">e</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">)</span><span class="k">return</span> <span class="nx">d</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="o">*</span><span class="p">(</span><span class="nx">a</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">+</span><span class="nx">b</span><span class="p">;</span><span class="k">return</span> <span class="nx">d</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="o">*--</span><span class="nx">a</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="nx">b</span><span class="p">},</span><span class="nx">easeInCirc</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span><span class="o">-</span><span class="nx">d</span><span class="o">*</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="nx">a</span><span class="o">/=</span><span class="nx">e</span><span class="p">)</span><span class="o">*</span><span class="nx">a</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="nx">b</span><span class="p">},</span><span class="nx">easeOutCirc</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span> <span class="nx">d</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="nx">a</span><span class="o">=</span><span class="nx">a</span><span class="o">/</span><span class="nx">e</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nx">a</span><span class="p">)</span><span class="o">+</span><span class="nx">b</span><span class="p">},</span><span class="nx">easeInOutCirc</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">if</span><span class="p">((</span><span class="nx">a</span><span class="o">/=</span><span class="nx">e</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">)</span><span class="k">return</span><span class="o">-</span><span class="nx">d</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nx">a</span><span class="o">*</span><span class="nx">a</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="nx">b</span><span class="p">;</span><span class="k">return</span> <span class="nx">d</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="nx">a</span><span class="o">-=</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span>
<span class="nx">a</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="nx">b</span><span class="p">},</span><span class="nx">easeInElastic</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="nx">c</span><span class="o">=</span><span class="mf">1.70158</span><span class="p">;</span><span class="kd">var</span> <span class="nx">g</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nx">h</span><span class="o">=</span><span class="nx">d</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="k">return</span> <span class="nx">b</span><span class="p">;</span><span class="k">if</span><span class="p">((</span><span class="nx">a</span><span class="o">/=</span><span class="nx">e</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="k">return</span> <span class="nx">b</span><span class="o">+</span><span class="nx">d</span><span class="p">;</span><span class="nx">g</span><span class="o">||</span><span class="p">(</span><span class="nx">g</span><span class="o">=</span><span class="nx">e</span><span class="o">*</span><span class="mf">0.3</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">h</span><span class="o">&lt;</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">d</span><span class="p">)){</span><span class="nx">h</span><span class="o">=</span><span class="nx">d</span><span class="p">;</span><span class="nx">c</span><span class="o">=</span><span class="nx">g</span><span class="o">/</span><span class="mi">4</span><span class="p">}</span><span class="k">else</span> <span class="nx">c</span><span class="o">=</span><span class="nx">g</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">)</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">asin</span><span class="p">(</span><span class="nx">d</span><span class="o">/</span><span class="nx">h</span><span class="p">);</span><span class="k">return</span><span class="o">-</span><span class="p">(</span><span class="nx">h</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="o">*</span><span class="p">(</span><span class="nx">a</span><span class="o">-=</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">((</span><span class="nx">a</span><span class="o">*</span><span class="nx">e</span><span class="o">-</span><span class="nx">c</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">/</span><span class="nx">g</span><span class="p">))</span><span class="o">+</span><span class="nx">b</span><span class="p">},</span><span class="nx">easeOutElastic</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="nx">c</span><span class="o">=</span><span class="mf">1.70158</span><span class="p">;</span><span class="kd">var</span> <span class="nx">g</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nx">h</span><span class="o">=</span><span class="nx">d</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="k">return</span> <span class="nx">b</span><span class="p">;</span><span class="k">if</span><span class="p">((</span><span class="nx">a</span><span class="o">/=</span><span class="nx">e</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="k">return</span> <span class="nx">b</span><span class="o">+</span><span class="nx">d</span><span class="p">;</span><span class="nx">g</span><span class="o">||</span><span class="p">(</span><span class="nx">g</span><span class="o">=</span><span class="nx">e</span><span class="o">*</span><span class="mf">0.3</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">h</span><span class="o">&lt;</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">d</span><span class="p">)){</span><span class="nx">h</span><span class="o">=</span><span class="nx">d</span><span class="p">;</span><span class="nx">c</span><span class="o">=</span><span class="nx">g</span><span class="o">/</span><span class="mi">4</span><span class="p">}</span><span class="k">else</span> <span class="nx">c</span><span class="o">=</span><span class="nx">g</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">)</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">asin</span><span class="p">(</span><span class="nx">d</span><span class="o">/</span><span class="nx">h</span><span class="p">);</span><span class="k">return</span> <span class="nx">h</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="o">*</span><span class="nx">a</span><span class="p">)</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">((</span><span class="nx">a</span><span class="o">*</span><span class="nx">e</span><span class="o">-</span><span class="nx">c</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">/</span><span class="nx">g</span><span class="p">)</span><span class="o">+</span><span class="nx">d</span><span class="o">+</span><span class="nx">b</span><span class="p">},</span><span class="nx">easeInOutElastic</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span>
<span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="nx">c</span><span class="o">=</span><span class="mf">1.70158</span><span class="p">;</span><span class="kd">var</span> <span class="nx">g</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nx">h</span><span class="o">=</span><span class="nx">d</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="k">return</span> <span class="nx">b</span><span class="p">;</span><span class="k">if</span><span class="p">((</span><span class="nx">a</span><span class="o">/=</span><span class="nx">e</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span><span class="k">return</span> <span class="nx">b</span><span class="o">+</span><span class="nx">d</span><span class="p">;</span><span class="nx">g</span><span class="o">||</span><span class="p">(</span><span class="nx">g</span><span class="o">=</span><span class="nx">e</span><span class="o">*</span><span class="mf">0.3</span><span class="o">*</span><span class="mf">1.5</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">h</span><span class="o">&lt;</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">d</span><span class="p">)){</span><span class="nx">h</span><span class="o">=</span><span class="nx">d</span><span class="p">;</span><span class="nx">c</span><span class="o">=</span><span class="nx">g</span><span class="o">/</span><span class="mi">4</span><span class="p">}</span><span class="k">else</span> <span class="nx">c</span><span class="o">=</span><span class="nx">g</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">)</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">asin</span><span class="p">(</span><span class="nx">d</span><span class="o">/</span><span class="nx">h</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">)</span><span class="k">return</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="nx">h</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="o">*</span><span class="p">(</span><span class="nx">a</span><span class="o">-=</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">((</span><span class="nx">a</span><span class="o">*</span><span class="nx">e</span><span class="o">-</span><span class="nx">c</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">/</span><span class="nx">g</span><span class="p">)</span><span class="o">+</span><span class="nx">b</span><span class="p">;</span><span class="k">return</span> <span class="nx">h</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="o">*</span><span class="p">(</span><span class="nx">a</span><span class="o">-=</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">((</span><span class="nx">a</span><span class="o">*</span><span class="nx">e</span><span class="o">-</span><span class="nx">c</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">/</span><span class="nx">g</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="o">+</span><span class="nx">d</span><span class="o">+</span><span class="nx">b</span><span class="p">},</span><span class="nx">easeInBack</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">g</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">g</span><span class="o">==</span><span class="kc">undefined</span><span class="p">)</span><span class="nx">g</span><span class="o">=</span><span class="mf">1.70158</span><span class="p">;</span><span class="k">return</span> <span class="nx">d</span><span class="o">*</span><span class="p">(</span><span class="nx">a</span><span class="o">/=</span><span class="nx">e</span><span class="p">)</span><span class="o">*</span><span class="nx">a</span><span class="o">*</span><span class="p">((</span><span class="nx">g</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nx">a</span><span class="o">-</span><span class="nx">g</span><span class="p">)</span><span class="o">+</span><span class="nx">b</span><span class="p">},</span><span class="nx">easeOutBack</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">g</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">g</span><span class="o">==</span><span class="kc">undefined</span><span class="p">)</span><span class="nx">g</span><span class="o">=</span><span class="mf">1.70158</span><span class="p">;</span><span class="k">return</span> <span class="nx">d</span><span class="o">*</span><span class="p">((</span><span class="nx">a</span><span class="o">=</span><span class="nx">a</span><span class="o">/</span><span class="nx">e</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nx">a</span><span class="o">*</span><span class="p">((</span><span class="nx">g</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nx">a</span><span class="o">+</span><span class="nx">g</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="nx">b</span><span class="p">},</span><span class="nx">easeInOutBack</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span>
<span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">,</span><span class="nx">g</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">g</span><span class="o">==</span><span class="kc">undefined</span><span class="p">)</span><span class="nx">g</span><span class="o">=</span><span class="mf">1.70158</span><span class="p">;</span><span class="k">if</span><span class="p">((</span><span class="nx">a</span><span class="o">/=</span><span class="nx">e</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">)</span><span class="k">return</span> <span class="nx">d</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="nx">a</span><span class="o">*</span><span class="nx">a</span><span class="o">*</span><span class="p">(((</span><span class="nx">g</span><span class="o">*=</span><span class="mf">1.525</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nx">a</span><span class="o">-</span><span class="nx">g</span><span class="p">)</span><span class="o">+</span><span class="nx">b</span><span class="p">;</span><span class="k">return</span> <span class="nx">d</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="p">((</span><span class="nx">a</span><span class="o">-=</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="nx">a</span><span class="o">*</span><span class="p">(((</span><span class="nx">g</span><span class="o">*=</span><span class="mf">1.525</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nx">a</span><span class="o">+</span><span class="nx">g</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="nx">b</span><span class="p">},</span><span class="nx">easeInBounce</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span> <span class="nx">d</span><span class="o">-</span><span class="nx">f</span><span class="p">.</span><span class="nx">easing</span><span class="p">.</span><span class="nx">easeOutBounce</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">e</span><span class="o">-</span><span class="nx">a</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">)</span><span class="o">+</span><span class="nx">b</span><span class="p">},</span><span class="nx">easeOutBounce</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">return</span><span class="p">(</span><span class="nx">a</span><span class="o">/=</span><span class="nx">e</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">/</span><span class="mf">2.75</span><span class="o">?</span><span class="nx">d</span><span class="o">*</span><span class="mf">7.5625</span><span class="o">*</span><span class="nx">a</span><span class="o">*</span><span class="nx">a</span><span class="o">+</span><span class="nx">b</span><span class="o">:</span><span class="nx">a</span><span class="o">&lt;</span><span class="mi">2</span><span class="o">/</span><span class="mf">2.75</span><span class="o">?</span><span class="nx">d</span><span class="o">*</span><span class="p">(</span><span class="mf">7.5625</span><span class="o">*</span><span class="p">(</span><span class="nx">a</span><span class="o">-=</span><span class="mf">1.5</span><span class="o">/</span><span class="mf">2.75</span><span class="p">)</span><span class="o">*</span><span class="nx">a</span><span class="o">+</span><span class="mf">0.75</span><span class="p">)</span><span class="o">+</span><span class="nx">b</span><span class="o">:</span><span class="nx">a</span><span class="o">&lt;</span><span class="mf">2.5</span><span class="o">/</span><span class="mf">2.75</span><span class="o">?</span><span class="nx">d</span><span class="o">*</span><span class="p">(</span><span class="mf">7.5625</span><span class="o">*</span><span class="p">(</span><span class="nx">a</span><span class="o">-=</span><span class="mf">2.25</span><span class="o">/</span><span class="mf">2.75</span><span class="p">)</span><span class="o">*</span><span class="nx">a</span><span class="o">+</span><span class="mf">0.9375</span><span class="p">)</span><span class="o">+</span><span class="nx">b</span><span class="o">:</span><span class="nx">d</span><span class="o">*</span><span class="p">(</span><span class="mf">7.5625</span><span class="o">*</span><span class="p">(</span><span class="nx">a</span><span class="o">-=</span><span class="mf">2.625</span><span class="o">/</span><span class="mf">2.75</span><span class="p">)</span><span class="o">*</span><span class="nx">a</span><span class="o">+</span><span class="mf">0.984375</span><span class="p">)</span><span class="o">+</span><span class="nx">b</span><span class="p">},</span><span class="nx">easeInOutBounce</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">){</span><span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="o">&lt;</span><span class="nx">e</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="k">return</span> <span class="nx">f</span><span class="p">.</span><span class="nx">easing</span><span class="p">.</span><span class="nx">easeInBounce</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
<span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="o">+</span><span class="nx">b</span><span class="p">;</span><span class="k">return</span> <span class="nx">f</span><span class="p">.</span><span class="nx">easing</span><span class="p">.</span><span class="nx">easeOutBounce</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="nx">a</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="nx">e</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nx">d</span><span class="p">,</span><span class="nx">e</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="o">+</span><span class="nx">d</span><span class="o">*</span><span class="mf">0.5</span><span class="o">+</span><span class="nx">b</span><span class="p">}})}(</span><span class="nx">jQuery</span><span class="p">);</span>
<span class="p">;</span><span class="cm">/*</span>
<span class="cm"> * jQuery UI Effects Blind 1.8.1</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2010 AUTHORS.txt (http://jqueryui.com/about)</span>
<span class="cm"> * Dual licensed under the MIT (MIT-LICENSE.txt)</span>
<span class="cm"> * and GPL (GPL-LICENSE.txt) licenses.</span>
<span class="cm"> *</span>
<span class="cm"> * http://docs.jquery.com/UI/Effects/Blind</span>
<span class="cm"> *</span>
<span class="cm"> * Depends:</span>
<span class="cm"> *	jquery.effects.core.js</span>
<span class="cm"> */</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">b</span><span class="p">){</span><span class="nx">b</span><span class="p">.</span><span class="nx">effects</span><span class="p">.</span><span class="nx">blind</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">){</span><span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">queue</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">a</span><span class="o">=</span><span class="nx">b</span><span class="p">(</span><span class="k">this</span><span class="p">),</span><span class="nx">g</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">,</span><span class="s2">&quot;top&quot;</span><span class="p">,</span><span class="s2">&quot;left&quot;</span><span class="p">],</span><span class="nx">f</span><span class="o">=</span><span class="nx">b</span><span class="p">.</span><span class="nx">effects</span><span class="p">.</span><span class="nx">setMode</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">c</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">mode</span><span class="o">||</span><span class="s2">&quot;hide&quot;</span><span class="p">),</span><span class="nx">d</span><span class="o">=</span><span class="nx">c</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">direction</span><span class="o">||</span><span class="s2">&quot;vertical&quot;</span><span class="p">;</span><span class="nx">b</span><span class="p">.</span><span class="nx">effects</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">g</span><span class="p">);</span><span class="nx">a</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="nx">b</span><span class="p">.</span><span class="nx">effects</span><span class="p">.</span><span class="nx">createWrapper</span><span class="p">(</span><span class="nx">a</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span><span class="nx">overflow</span><span class="o">:</span><span class="s2">&quot;hidden&quot;</span><span class="p">}),</span><span class="nx">h</span><span class="o">=</span><span class="nx">d</span><span class="o">==</span><span class="s2">&quot;vertical&quot;</span><span class="o">?</span><span class="s2">&quot;height&quot;</span><span class="o">:</span><span class="s2">&quot;width&quot;</span><span class="p">;</span><span class="nx">d</span><span class="o">=</span><span class="nx">d</span><span class="o">==</span><span class="s2">&quot;vertical&quot;</span><span class="o">?</span><span class="nx">e</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span><span class="o">:</span><span class="nx">e</span><span class="p">.</span><span class="nx">width</span><span class="p">();</span><span class="nx">f</span><span class="o">==</span><span class="s2">&quot;show&quot;</span><span class="o">&amp;&amp;</span><span class="nx">e</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="nx">h</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="p">{};</span><span class="nx">i</span><span class="p">[</span><span class="nx">h</span><span class="p">]</span><span class="o">=</span><span class="nx">f</span><span class="o">==</span><span class="s2">&quot;show&quot;</span><span class="o">?</span><span class="nx">d</span><span class="o">:</span><span class="mi">0</span><span class="p">;</span><span class="nx">e</span><span class="p">.</span><span class="nx">animate</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">c</span><span class="p">.</span><span class="nx">duration</span><span class="p">,</span><span class="nx">c</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">easing</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span><span class="nx">f</span><span class="o">==</span><span class="s2">&quot;hide&quot;</span><span class="o">&amp;&amp;</span><span class="nx">a</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span><span class="nx">b</span><span class="p">.</span><span class="nx">effects</span><span class="p">.</span><span class="nx">restore</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">g</span><span class="p">);</span><span class="nx">b</span><span class="p">.</span><span class="nx">effects</span><span class="p">.</span><span class="nx">removeWrapper</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
<span class="nx">c</span><span class="p">.</span><span class="nx">callback</span><span class="o">&amp;&amp;</span><span class="nx">c</span><span class="p">.</span><span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nx">arguments</span><span class="p">);</span><span class="nx">a</span><span class="p">.</span><span class="nx">dequeue</span><span class="p">()})})}})(</span><span class="nx">jQuery</span><span class="p">);</span>
<span class="p">;</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(){</span></pre></div>
      </td>
    </tr>
    <tr id='section-2'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-2">&#182;</a>
        </div>
        <p>When the next click or keypress happens, anywhere on the screen, hide the
element. &lsquo;clickable&rsquo; makes the element and its contents clickable without
hiding. The &lsquo;onHide&rsquo; callback runs when the hide fires, and has a chance
to cancel it.  </p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">jQuery</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">autohide</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">me</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">options</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span><span class="nx">clickable</span> <span class="o">:</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">onHide</span> <span class="o">:</span> <span class="kc">null</span><span class="p">},</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{});</span>
    <span class="nx">me</span><span class="p">.</span><span class="nx">_autoignore</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span> <span class="k">delete</span> <span class="nx">me</span><span class="p">.</span><span class="nx">_autoignore</span><span class="p">;</span> <span class="p">},</span> <span class="mi">0</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">me</span><span class="p">.</span><span class="nx">_autohider</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">me</span><span class="p">.</span><span class="nx">forceHide</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">e</span> <span class="o">&amp;&amp;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">onHide</span><span class="p">)</span> <span class="nx">options</span><span class="p">.</span><span class="nx">onHide</span><span class="p">();</span>
        <span class="nx">me</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>

        <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">unbind</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">me</span><span class="p">.</span><span class="nx">_autohider</span><span class="p">);</span>
        <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">unbind</span><span class="p">(</span><span class="s1">&#39;keypress&#39;</span><span class="p">,</span> <span class="nx">me</span><span class="p">.</span><span class="nx">_autohider</span><span class="p">);</span>
        <span class="nx">me</span><span class="p">.</span><span class="nx">_autohider</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="nx">me</span><span class="p">.</span><span class="nx">forceHide</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">};</span>
      <span class="nx">me</span><span class="p">.</span><span class="nx">_autohider</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>        
        <span class="k">if</span> <span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">_autoignore</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">clickable</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">me</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span> <span class="o">||</span> <span class="nx">_</span><span class="p">.</span><span class="nx">include</span><span class="p">(</span><span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">parents</span><span class="p">(),</span> <span class="nx">me</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span> <span class="k">return</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">onHide</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">onHide</span><span class="p">(</span><span class="nx">e</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
        <span class="nx">me</span><span class="p">.</span><span class="nx">forceHide</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
      <span class="p">};</span>
      <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_autohider</span><span class="p">);</span>
      <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;keypress&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_autohider</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>
 
  <span class="nx">jQuery</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">acceptInput</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span> 
      <span class="nx">delay</span><span class="o">:</span>                  <span class="mi">1000</span><span class="p">,</span>
      <span class="nx">callback</span><span class="o">:</span>               <span class="kc">null</span><span class="p">,</span>
      <span class="nx">className</span><span class="o">:</span>              <span class="s1">&#39;acceptInput&#39;</span><span class="p">,</span>
      <span class="nx">initialStateClassName</span><span class="o">:</span>  <span class="s1">&#39;acceptInput-awaitingActivity&#39;</span><span class="p">,</span>
      <span class="nx">typingStateClassName</span><span class="o">:</span>   <span class="s1">&#39;acceptInput-acceptingInput&#39;</span><span class="p">,</span>
      <span class="nx">inputClassName</span><span class="o">:</span>         <span class="s1">&#39;acceptInput-textField&#39;</span>
    <span class="p">};</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">){</span>
      <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">config</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">editTimer</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      
    <span class="k">this</span><span class="p">.</span><span class="nx">deny</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">parent</span><span class="p">().</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;stopAcceptingInput&#39;</span><span class="p">);</span>
    <span class="p">};</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">allow</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">parent</span><span class="p">().</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;stopAcceptingInput&#39;</span><span class="p">);</span>
    <span class="p">};</span>      

    
    <span class="k">this</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">el</span><span class="p">){</span></pre></div>
      </td>
    </tr>
    <tr id='section-3'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-3">&#182;</a>
        </div>
        <p>element-specific code here</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="k">if</span><span class="p">(</span><span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nx">parent</span><span class="p">().</span><span class="nx">hasClass</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">initialStateClassName</span><span class="p">)){</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">el</span> <span class="o">=</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
      
      <span class="kd">var</span> <span class="nx">elWrapped</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">wrap</span><span class="p">(</span><span class="s1">&#39;&lt;span class=&quot;&#39;</span><span class="o">+</span><span class="nx">config</span><span class="p">.</span><span class="nx">initialStateClassName</span><span class="o">+</span><span class="s1">&#39;&quot;&gt;&lt;/span&gt;&#39;</span><span class="p">);</span>
      <span class="nx">elWrapped</span>     <span class="o">=</span> <span class="nx">elWrapped</span><span class="p">.</span><span class="nx">parent</span><span class="p">();</span>
      
      <span class="kd">var</span> <span class="nx">inputElement</span> <span class="o">=</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;&lt;input type=&quot;text&quot; class=&quot;&#39;</span><span class="o">+</span><span class="nx">config</span><span class="p">.</span><span class="nx">inputClassName</span><span class="o">+</span><span class="s1">&#39;&quot; style=&quot;display:none;&quot; /&gt;&#39;</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">elWrapped</span><span class="p">);</span>
      
      <span class="nx">inputElement</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;blur&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span>
      
        <span class="nx">elWrapped</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">initialStateClassName</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">typingStateClassName</span><span class="p">);</span>
        <span class="nx">inputElement</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">el</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
               
      <span class="p">});</span>


      <span class="nx">inputElement</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;keyup&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">val</span> <span class="o">=</span> <span class="nx">inputElement</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">);</span>
        <span class="nx">el</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">changeCallBack</span><span class="p">){</span>
          <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">acceptInput</span><span class="p">.</span><span class="nx">editTimer</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">changeCallBack</span><span class="p">,</span><span class="mi">500</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">});</span>
      
      <span class="nx">inputElement</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;keydown&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">acceptInput</span><span class="p">.</span><span class="nx">editTimer</span><span class="p">){</span>
          <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">acceptInput</span><span class="p">.</span><span class="nx">editTimer</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">});</span>

      <span class="nx">elWrapped</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">elWrapped</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span><span class="s1">&#39;stopAcceptingInput&#39;</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">elWrapped</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">initialStateClassName</span><span class="p">)){</span>
          
          <span class="kd">var</span> <span class="nx">autoHider</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="nx">elWrapped</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">initialStateClassName</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">typingStateClassName</span><span class="p">);</span>
          <span class="p">};</span>

          <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">(</span><span class="nx">inputElement</span><span class="p">).</span><span class="nx">autohide</span><span class="p">({</span> <span class="nx">clickable</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">onHide</span><span class="o">:</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="nx">autoHider</span><span class="p">,</span><span class="k">this</span><span class="p">)</span> <span class="p">});</span>
          
          <span class="nx">el</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
          <span class="nx">inputElement</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="nx">el</span><span class="p">.</span><span class="nx">text</span><span class="p">()).</span><span class="nx">show</span><span class="p">()[</span><span class="mi">0</span><span class="p">].</span><span class="nx">focus</span><span class="p">();</span>
          <span class="nx">inputElement</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">select</span><span class="p">();</span>
          <span class="nx">elWrapped</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">typingStateClassName</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">initialStateClassName</span><span class="p">);</span>
                    
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">});</span>
       
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>

  <span class="p">};</span>

<span class="p">}).</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

<span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">placeholder</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">defaults</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;...&#39;</span><span class="p">,</span>
      <span class="nx">className</span><span class="o">:</span> <span class="s1">&#39;placeholder&#39;</span><span class="p">,</span>
      <span class="nx">clearClassName</span><span class="o">:</span> <span class="s1">&#39;show_cancel_search&#39;</span>
    <span class="p">};</span>
    <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">defaults</span><span class="p">,</span> <span class="nx">opts</span><span class="p">);</span>
    
    <span class="kd">var</span> <span class="nx">setPlaceholder</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$input</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">$input</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="nx">$input</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;placeholder&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">options</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
      <span class="nx">$input</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">className</span><span class="p">);</span>
    <span class="p">};</span>
    
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">$this</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">$this</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;search&#39;</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
      
      <span class="nx">$this</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;blur&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">$this</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">setPlaceholder</span><span class="p">(</span><span class="nx">$this</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;focus&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">$this</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span> <span class="o">==</span> <span class="p">(</span><span class="nx">$this</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;placeholder&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">options</span><span class="p">.</span><span class="nx">message</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">$this</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">$this</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">className</span><span class="p">);</span>
      <span class="p">}).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;keyup&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">searchVal</span> <span class="o">=</span> <span class="nx">$this</span><span class="p">.</span><span class="nx">val</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">searchVal</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">searchVal</span> <span class="o">!=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">$this</span><span class="p">.</span><span class="nx">parent</span><span class="p">().</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">clearClassName</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">$this</span><span class="p">.</span><span class="nx">parent</span><span class="p">().</span><span class="nx">removeClass</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">clearClassName</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">});</span>
      <span class="nx">_</span><span class="p">.</span><span class="nx">defer</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="nx">$this</span><span class="p">.</span><span class="nx">keyup</span><span class="p">().</span><span class="nx">blur</span><span class="p">();</span>
      <span class="p">});</span>
    <span class="p">});</span>
    
  <span class="p">};</span>
  
<span class="p">})(</span><span class="nx">jQuery</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-4'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-4">&#182;</a>
        </div>
        <p>Fake out console.log for safety, if it doesn&rsquo;t exist.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nb">window</span><span class="p">.</span><span class="nx">console</span> <span class="o">||</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">console</span> <span class="o">=</span> <span class="p">{});</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span>    <span class="o">||</span> <span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">identity</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-5'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-5">&#182;</a>
        </div>
        <p>Create the DV namespaces.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nb">window</span><span class="p">.</span><span class="nx">DV</span>   <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">DV</span>   <span class="o">||</span> <span class="p">{};</span>
<span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span>   <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">noConflict</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="nx">DV</span><span class="p">.</span><span class="nx">viewers</span>  <span class="o">=</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">viewers</span>  <span class="o">||</span> <span class="p">{};</span>
<span class="nx">DV</span><span class="p">.</span><span class="nx">model</span>    <span class="o">=</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">model</span>    <span class="o">||</span> <span class="p">{};</span>


<span class="nx">DV</span><span class="p">.</span><span class="nx">Annotation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">argHash</span><span class="p">){</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">position</span>     <span class="o">=</span> <span class="p">{</span> <span class="nx">top</span><span class="o">:</span> <span class="nx">argHash</span><span class="p">.</span><span class="nx">top</span><span class="p">,</span> <span class="nx">left</span><span class="o">:</span> <span class="nx">argHash</span><span class="p">.</span><span class="nx">left</span> <span class="p">};</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">dimensions</span>   <span class="o">=</span> <span class="p">{</span> <span class="nx">width</span><span class="o">:</span> <span class="nx">argHash</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="o">:</span> <span class="nx">argHash</span><span class="p">.</span><span class="nx">height</span> <span class="p">};</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">page</span>         <span class="o">=</span> <span class="nx">argHash</span><span class="p">.</span><span class="nx">page</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">pageEl</span>       <span class="o">=</span> <span class="nx">argHash</span><span class="p">.</span><span class="nx">pageEl</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">annotationContainerEl</span> <span class="o">=</span> <span class="nx">argHash</span><span class="p">.</span><span class="nx">annotationContainerEl</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span>       <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">set</span><span class="p">.</span><span class="nx">viewer</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">annotationEl</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">renderedHTML</span> <span class="o">=</span> <span class="nx">argHash</span><span class="p">.</span><span class="nx">renderedHTML</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">type</span>         <span class="o">=</span> <span class="nx">argHash</span><span class="p">.</span><span class="nx">type</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">id</span>           <span class="o">=</span> <span class="nx">argHash</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">model</span>        <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">getAnnotation</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">state</span>        <span class="o">=</span> <span class="s1">&#39;collapsed&#39;</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">active</span>       <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">();</span>

  <span class="k">if</span><span class="p">(</span><span class="nx">argHash</span><span class="p">.</span><span class="nx">active</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">setActiveAnnotationLimits</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">resetTracker</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">active</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-6'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-6">&#182;</a>
        </div>
        <p>this.viewer.elements.window[0].scrollTop += this.annotationEl.offset().top;</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">argHash</span><span class="p">.</span><span class="nx">showEdit</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">showEdit</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-7'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-7">&#182;</a>
        </div>
        <p>Add annotation to page</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">Annotation</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">add</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;page&#39;</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">annotationEl</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">renderedHTML</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">annotationContainerEl</span><span class="p">);</span>
  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">){</span>
      <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="nx">len</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">len</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">annotations</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">id</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">){</span>

          <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>

          <span class="k">this</span><span class="p">.</span><span class="nx">annotationEl</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">renderedHTML</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">annotationContainerEl</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">annotationEl</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">renderedHTML</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">annotationContainerEl</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-8'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-8">&#182;</a>
        </div>
        <p>Jump to next annotation</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">Annotation</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">next</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">hide</span><span class="p">.</span><span class="nx">preventRemovalOfCoverClass</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">annotation</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">getNextAnnotation</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">annotation</span><span class="p">){</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">set</span><span class="p">.</span><span class="nx">showAnnotation</span><span class="p">({</span> <span class="nx">index</span><span class="o">:</span> <span class="nx">annotation</span><span class="p">.</span><span class="nx">index</span><span class="p">,</span> <span class="nx">id</span><span class="o">:</span> <span class="nx">annotation</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">top</span><span class="o">:</span> <span class="nx">annotation</span><span class="p">.</span><span class="nx">top</span> <span class="p">});</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-9'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-9">&#182;</a>
        </div>
        <p>Jump to previous annotation</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">Annotation</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">previous</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">hide</span><span class="p">.</span><span class="nx">preventRemovalOfCoverClass</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">annotation</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">getPreviousAnnotation</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">annotation</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">set</span><span class="p">.</span><span class="nx">showAnnotation</span><span class="p">({</span> <span class="nx">index</span><span class="o">:</span> <span class="nx">annotation</span><span class="p">.</span><span class="nx">index</span><span class="p">,</span> <span class="nx">id</span><span class="o">:</span> <span class="nx">annotation</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">top</span><span class="o">:</span> <span class="nx">annotation</span><span class="p">.</span><span class="nx">top</span> <span class="p">});</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-10'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-10">&#182;</a>
        </div>
        <p>Show annotation</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">Annotation</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">show</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">argHash</span><span class="p">)</span> <span class="p">{</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotation</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotation</span><span class="p">.</span><span class="nx">id</span> <span class="o">!=</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotation</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">annotationToLoadId</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;DV-coverVisible&#39;</span><span class="p">);</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">annotationEl</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;div.DV-annotationBG&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span> <span class="nx">display</span><span class="o">:</span> <span class="s1">&#39;block&#39;</span><span class="p">,</span> <span class="nx">opacity</span><span class="o">:</span> <span class="mi">1</span> <span class="p">});</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">annotationEl</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;DV-activeAnnotation&#39;</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotation</span>   <span class="o">=</span> <span class="k">this</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-11'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-11">&#182;</a>
        </div>
        <p>Enable annotation tracking to ensure the active state hides on scroll</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">addObserver</span><span class="p">(</span><span class="s1">&#39;trackAnnotation&#39;</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">setActiveAnnotationInNav</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">active</span>                         <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">pageEl</span><span class="p">.</span><span class="nx">parent</span><span class="p">(</span><span class="s1">&#39;.DV-set&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;DV-activePage&#39;</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-12'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-12">&#182;</a>
        </div>
        <p>this.viewer.history.save(&lsquo;document/p&rsquo;+(parseInt(this.page.index,10)+1)+&lsquo;/a&rsquo;+this.id);</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">argHash</span> <span class="o">&amp;&amp;</span> <span class="nx">argHash</span><span class="p">.</span><span class="nx">edit</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">showEdit</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-13'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-13">&#182;</a>
        </div>
        <p>Hide annotation</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">Annotation</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hide</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">forceOverlayHide</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">pageNumber</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">currentPage</span><span class="p">.</span><span class="nx">text</span><span class="p">(),</span><span class="mi">10</span><span class="p">);</span>

  <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">!==</span> <span class="s1">&#39;page&#39;</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">annotationEl</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;div.DV-annotationBG&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span> <span class="nx">opacity</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">display</span><span class="o">:</span> <span class="s1">&#39;none&#39;</span> <span class="p">});</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">isEditing</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">annotationEl</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span><span class="s1">&#39;DV-editing&#39;</span><span class="p">);</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">annotationEl</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;DV-editing DV-activeAnnotation&#39;</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">forceOverlayHide</span> <span class="o">===</span> <span class="kc">true</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;DV-coverVisible&#39;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">hide</span><span class="p">.</span><span class="nx">preventRemovalOfCoverClass</span> <span class="o">===</span> <span class="kc">false</span> <span class="o">||</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">hide</span><span class="p">.</span><span class="nx">preventRemovalOfCoverClass</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;DV-coverVisible&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">hide</span><span class="p">.</span><span class="nx">preventRemovalOfCoverClass</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-14'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-14">&#182;</a>
        </div>
        <p>stop tracking this annotation</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotation</span>                <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">trackAnnotation</span><span class="p">.</span><span class="nx">h</span>        <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">trackAnnotation</span><span class="p">.</span><span class="nx">id</span>       <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">trackAnnotation</span><span class="p">.</span><span class="nx">combined</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">active</span>                                 <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">pageSet</span><span class="p">.</span><span class="nx">setActiveAnnotation</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">removeObserver</span><span class="p">(</span><span class="s1">&#39;trackAnnotation&#39;</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">setActiveAnnotationInNav</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">pageEl</span><span class="p">.</span><span class="nx">parent</span><span class="p">(</span><span class="s1">&#39;.DV-set&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;DV-activePage&#39;</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">removeConnector</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">isEditing</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">saveAnnotation</span><span class="p">({</span><span class="nx">target</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">annotationEl</span><span class="p">},</span> <span class="s1">&#39;onlyIfText&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-15'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-15">&#182;</a>
        </div>
        <p>Toggle annotation</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">Annotation</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toggle</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">argHash</span><span class="p">){</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotation</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotation</span> <span class="o">!=</span> <span class="k">this</span><span class="p">)){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotation</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;page&#39;</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">annotationEl</span><span class="p">.</span><span class="nx">toggleClass</span><span class="p">(</span><span class="s1">&#39;DV-activeAnnotation&#39;</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">active</span> <span class="o">==</span> <span class="kc">true</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">hide</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-16'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-16">&#182;</a>
        </div>
        <p>Show hover annotation state</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">Annotation</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">drawConnector</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">active</span> <span class="o">!=</span> <span class="kc">true</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;DV-annotationActivated&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">annotationEl</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;DV-annotationHover&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-17'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-17">&#182;</a>
        </div>
        <p>Remove hover annotation state</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">Annotation</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">removeConnector</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">force</span><span class="p">){</span>
  <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">active</span> <span class="o">!=</span> <span class="kc">true</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;DV-annotationActivated&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">annotationEl</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;DV-annotationHover&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-18'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-18">&#182;</a>
        </div>
        <p>Show edit controls</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">Annotation</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">showEdit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">annotationEl</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;DV-editing&#39;</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-annotationTitleInput&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">annotationEl</span><span class="p">).</span><span class="nx">focus</span><span class="p">();</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-19'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-19">&#182;</a>
        </div>
        <p>Remove the annotation from the page</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">Annotation</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">remove</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#DV-annotation-&#39;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>
<span class="p">};</span>

<span class="nx">DV</span><span class="p">.</span><span class="nx">DragReporter</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">viewer</span><span class="p">,</span> <span class="nx">toWatch</span><span class="p">,</span> <span class="nx">dispatcher</span><span class="p">,</span> <span class="nx">argHash</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span>         <span class="o">=</span> <span class="nx">viewer</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">dragClassName</span>  <span class="o">=</span> <span class="s1">&#39;DV-dragging&#39;</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">sensitivityY</span>   <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">sensitivityX</span>   <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">oldPageY</span>       <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">argHash</span><span class="p">);</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">dispatcher</span>             <span class="o">=</span> <span class="nx">dispatcher</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">toWatch</span>                <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="nx">toWatch</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">boundReporter</span>          <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">mouseMoveReporter</span><span class="p">,</span><span class="k">this</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">boundMouseUpReporter</span>   <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">mouseUpReporter</span><span class="p">,</span><span class="k">this</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">boundMouseDownReporter</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">mouseDownReporter</span><span class="p">,</span><span class="k">this</span><span class="p">);</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">setBinding</span><span class="p">();</span>
<span class="p">};</span>

<span class="nx">DV</span><span class="p">.</span><span class="nx">DragReporter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">shouldIgnore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">ignoreSelector</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">el</span><span class="p">.</span><span class="nx">parents</span><span class="p">().</span><span class="nx">is</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ignoreSelector</span><span class="p">)</span> <span class="o">||</span> <span class="nx">el</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ignoreSelector</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">DV</span><span class="p">.</span><span class="nx">DragReporter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">mouseUpReporter</span>     <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">shouldIgnore</span><span class="p">(</span><span class="nx">e</span><span class="p">))</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
  <span class="nx">clearInterval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">updateTimer</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span>
<span class="p">};</span>

<span class="nx">DV</span><span class="p">.</span><span class="nx">DragReporter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">oldPositionUpdater</span>   <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">oldPageY</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">pageY</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">DV</span><span class="p">.</span><span class="nx">DragReporter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">stop</span>         <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">toWatch</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">dragClassName</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">toWatch</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s1">&#39;mousemove&#39;</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">DV</span><span class="p">.</span><span class="nx">DragReporter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setBinding</span>         <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">toWatch</span><span class="p">.</span><span class="nx">mouseup</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">boundMouseUpReporter</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">toWatch</span><span class="p">.</span><span class="nx">mousedown</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">boundMouseDownReporter</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">DV</span><span class="p">.</span><span class="nx">DragReporter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">unBind</span>           <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">toWatch</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s1">&#39;mouseup&#39;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">boundMouseUpReporter</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">toWatch</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s1">&#39;mousedown&#39;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">boundMouseDownReporter</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">DV</span><span class="p">.</span><span class="nx">DragReporter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">destroy</span>           <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">unBind</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">toWatch</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">DV</span><span class="p">.</span><span class="nx">DragReporter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">mouseDownReporter</span>   <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
   <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">shouldIgnore</span><span class="p">(</span><span class="nx">e</span><span class="p">))</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">pageY</span>    <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pageY</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">pageX</span>    <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pageX</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">oldPageY</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pageY</span><span class="p">;</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">updateTimer</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">oldPositionUpdater</span><span class="p">,</span><span class="k">this</span><span class="p">),</span><span class="mi">1200</span><span class="p">);</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">toWatch</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">dragClassName</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">toWatch</span><span class="p">.</span><span class="nx">mousemove</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">boundReporter</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">DV</span><span class="p">.</span><span class="nx">DragReporter</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">mouseMoveReporter</span>     <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">shouldIgnore</span><span class="p">(</span><span class="nx">e</span><span class="p">))</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">deltaX</span>      <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sensitivityX</span> <span class="o">*</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pageX</span> <span class="o">-</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pageX</span><span class="p">));</span>
  <span class="kd">var</span> <span class="nx">deltaY</span>      <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sensitivityY</span> <span class="o">*</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pageY</span> <span class="o">-</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pageY</span><span class="p">));</span>
  <span class="kd">var</span> <span class="nx">directionX</span>  <span class="o">=</span> <span class="p">(</span><span class="nx">deltaX</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;right&#39;</span> <span class="o">:</span> <span class="s1">&#39;left&#39;</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">directionY</span>  <span class="o">=</span> <span class="p">(</span><span class="nx">deltaY</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;down&#39;</span> <span class="o">:</span> <span class="s1">&#39;up&#39;</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">pageY</span>      <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pageY</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">pageX</span>      <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pageX</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">deltaY</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">deltaX</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">dispatcher</span><span class="p">({</span> <span class="nx">event</span><span class="o">:</span> <span class="nx">e</span><span class="p">,</span> <span class="nx">deltaX</span><span class="o">:</span> <span class="nx">deltaX</span><span class="p">,</span> <span class="nx">deltaY</span><span class="o">:</span> <span class="nx">deltaY</span><span class="p">,</span> <span class="nx">directionX</span><span class="o">:</span> <span class="nx">directionX</span><span class="p">,</span> <span class="nx">directionY</span><span class="o">:</span> <span class="nx">directionY</span> <span class="p">});</span>
<span class="p">};</span>

<span class="nx">DV</span><span class="p">.</span><span class="nx">Elements</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">viewer</span><span class="p">){</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_viewer</span> <span class="o">=</span> <span class="nx">viewer</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">elements</span> <span class="o">=</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">Schema</span><span class="p">.</span><span class="nx">elements</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">elemCount</span><span class="o">=</span><span class="nx">elements</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">elemCount</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">getElement</span><span class="p">(</span><span class="nx">elements</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
  <span class="p">}</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-20'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-20">&#182;</a>
        </div>
        <p>Get and store an element reference</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">Elements</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getElement</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">elementQuery</span><span class="p">,</span><span class="nx">force</span><span class="p">){</span>
  <span class="k">this</span><span class="p">[</span><span class="nx">elementQuery</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="nx">elementQuery</span><span class="p">.</span><span class="nx">query</span><span class="p">);</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-21'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-21">&#182;</a>
        </div>
        <p>Handles JavaScript history management and callbacks. To use, register a
regexp that matches the history hash with its corresponding callback:</p>

<pre><code>dc.history.register(/^#search/, controller.runSearch);
</code></pre>

<p>And then you can save arbitrary history fragments.</p>

<pre><code>dc.history.save(&lsquo;search/freedom/p3&rsquo;);
</code></pre>

<p>Initialize history with an empty set of handlers.
Bind to the HTML5 &lsquo;onhashchange&rsquo; callback, if it exists. Otherwise,
start polling the window location.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">History</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">viewer</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span> <span class="o">=</span> <span class="nx">viewer</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-22'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-22">&#182;</a>
        </div>
        <p>Ensure we don&rsquo;t accidentally bind to history twice.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">DV</span><span class="p">.</span><span class="nx">History</span><span class="p">.</span><span class="nx">count</span><span class="o">++</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-23'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-23">&#182;</a>
        </div>
        <p>The interval at which the window location is polled.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">URL_CHECK_INTERVAL</span> <span class="o">=</span> <span class="mi">500</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-24'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-24">&#182;</a>
        </div>
        <p>We need to use an iFrame to save history if we&rsquo;re in an old version of IE.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">USE_IFRAME</span> <span class="o">=</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">browser</span><span class="p">.</span><span class="nx">msie</span> <span class="o">&amp;&amp;</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">browser</span><span class="p">.</span><span class="nx">version</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-25'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-25">&#182;</a>
        </div>
        <p>The ordered list of history handlers matchers and callbacks.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">handlers</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">defaultCallback</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-26'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-26">&#182;</a>
        </div>
        <p>The current recorded window.location.hash.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">hash</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="p">;</span>

  <span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;checkURL&#39;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">DV</span><span class="p">.</span><span class="nx">History</span><span class="p">.</span><span class="nx">count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-27'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-27">&#182;</a>
        </div>
        <p>Wait until the window loads.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">USE_IFRAME</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">iframe</span> <span class="o">=</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;&lt;iframe src=&quot;javascript:0&quot;/&gt;&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">().</span><span class="nx">appendTo</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">contentWindow</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;onhashchange&#39;</span> <span class="k">in</span> <span class="nb">window</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">onhashchange</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">checkURL</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">setInterval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">checkURL</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">URL_CHECK_INTERVAL</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
<span class="p">};</span>

<span class="nx">DV</span><span class="p">.</span><span class="nx">History</span><span class="p">.</span><span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="nx">DV</span><span class="p">.</span><span class="nx">History</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-28'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-28">&#182;</a>
        </div>
        <p>Register a history handler. Pass a regular expression that can be used to
match your URLs, and the callback to be invoked with the remainder of the
hash, when matched.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">register</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">matcher</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">handlers</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">matcher</span> <span class="o">:</span> <span class="nx">matcher</span><span class="p">,</span> <span class="nx">callback</span> <span class="o">:</span> <span class="nx">callback</span><span class="p">});</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-29'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-29">&#182;</a>
        </div>
        <p>Save a moment into browser history. Make sure you&rsquo;ve registered a handler
for it. You&rsquo;re responsible for pre-escaping the URL fragment.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">save</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">hash</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">DV</span><span class="p">.</span><span class="nx">History</span><span class="p">.</span><span class="nx">count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">hash</span> <span class="o">=</span> <span class="p">(</span><span class="nx">hash</span> <span class="o">?</span> <span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="nx">hash</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">USE_IFRAME</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">iframe</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">hash</span> <span class="o">!=</span> <span class="k">this</span><span class="p">.</span><span class="nx">iframe</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="p">)))</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">iframe</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">open</span><span class="p">().</span><span class="nx">close</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">iframe</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">hash</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-30'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-30">&#182;</a>
        </div>
        <p>Check the current URL hash against the recorded one, firing callbacks.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">checkURL</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">DV</span><span class="p">.</span><span class="nx">History</span><span class="p">.</span><span class="nx">count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">current</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">USE_IFRAME</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">iframe</span> <span class="o">:</span> <span class="nb">window</span><span class="p">).</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-31'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-31">&#182;</a>
        </div>
        <p>IE iframe madness.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">current</span> <span class="o">||</span>
      <span class="nx">current</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">hash</span> <span class="o">||</span>
      <span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="nx">current</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">hash</span> <span class="o">||</span>
      <span class="nx">current</span> <span class="o">==</span> <span class="nb">decodeURIComponent</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">hash</span><span class="p">))</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">USE_IFRAME</span><span class="p">)</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">=</span> <span class="nx">current</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">loadURL</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-32'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-32">&#182;</a>
        </div>
        <p>Load the history callback associated with the current page fragment. On
pages that support history, this method should be called at page load,
after all the history callbacks have been registered.
executeCallbacks must be passed as true, otherwise true/false will returned based on positive route matches.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">loadURL</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">executeCallbacks</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">hash</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">hash</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-33'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-33">&#182;</a>
        </div>
        <p>go through matches in reverse order so that oldest rules are executed last</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">handlers</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">match</span> <span class="o">=</span> <span class="nx">hash</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">handlers</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">matcher</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">executeCallbacks</span> <span class="o">===</span> <span class="kc">true</span><span class="p">){</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">handlers</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">handlers</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">callback</span><span class="p">,</span><span class="nx">match</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nx">match</span><span class="p">.</span><span class="nx">length</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">defaultCallback</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nx">executeCallbacks</span> <span class="o">===</span> <span class="kc">true</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">defaultCallback</span><span class="p">();</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-34'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-34">&#182;</a>
        </div>
        <p>// page</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">Page</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">viewer</span><span class="p">,</span> <span class="nx">argHash</span><span class="p">){</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span>           <span class="o">=</span> <span class="nx">viewer</span><span class="p">;</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">index</span>            <span class="o">=</span> <span class="nx">argHash</span><span class="p">.</span><span class="nx">index</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">argHash</span><span class="p">)</span> <span class="k">this</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">argHash</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">el</span>               <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">parent</span>           <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">parent</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">pageNumberEl</span>     <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;span.DV-pageNumber&#39;</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">pageInsertEl</span>     <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.DV-pageNoteInsert&#39;</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">removedOverlayEl</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.DV-overlay&#39;</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">pageImageEl</span>      <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getPageImage</span><span class="p">();</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">pageEl</span>           <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;div.DV-page&#39;</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">annotationContainerEl</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;div.DV-annotations&#39;</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">coverEl</span>          <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;div.DV-cover&#39;</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">loadTimer</span>        <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">hasLayerPage</span>     <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">hasLayerRegional</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">imgSource</span>        <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>


  <span class="k">this</span><span class="p">.</span><span class="nx">offset</span>           <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">pageNumber</span>       <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">zoom</span>             <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">annotations</span>      <span class="o">=</span> <span class="p">[];</span></pre></div>
      </td>
    </tr>
    <tr id='section-35'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-35">&#182;</a>
        </div>
        <p>optimizations</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="kd">var</span> <span class="nx">m</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">model_document</span>     <span class="o">=</span> <span class="nx">m</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">model_pages</span>        <span class="o">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">pages</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">model_annotations</span>  <span class="o">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">annotations</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">model_chapters</span>     <span class="o">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">chapters</span><span class="p">;</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-36'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-36">&#182;</a>
        </div>
        <p>Set the image reference for the page for future updates</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">Page</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setPageImage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">pageImageEl</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getPageImage</span><span class="p">();</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-37'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-37">&#182;</a>
        </div>
        <p>get page image to update</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">Page</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getPageImage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;img.DV-pageImage&#39;</span><span class="p">);</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-38'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-38">&#182;</a>
        </div>
        <p>Get the offset for the page at its current index</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">Page</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getOffset</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">model_document</span><span class="p">.</span><span class="nx">offsets</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">index</span><span class="p">];</span>
<span class="p">};</span>

<span class="nx">DV</span><span class="p">.</span><span class="nx">Page</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getPageNoteHeight</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">model_pages</span><span class="p">.</span><span class="nx">pageNoteHeights</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">index</span><span class="p">];</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-39'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-39">&#182;</a>
        </div>
        <p>Draw the current page and its associated layers/annotations
Will stop if page index appears the same or force boolean is passed</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">Page</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">draw</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">argHash</span><span class="p">)</span> <span class="p">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-40'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-40">&#182;</a>
        </div>
        <p>Return immeditately if we don&rsquo;t need to redraw the page.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">index</span> <span class="o">===</span> <span class="nx">argHash</span><span class="p">.</span><span class="nx">index</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">argHash</span><span class="p">.</span><span class="nx">force</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">imgSource</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">model_pages</span><span class="p">.</span><span class="nx">imageURL</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">index</span><span class="p">)){</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">index</span> <span class="o">=</span> <span class="p">(</span><span class="nx">argHash</span><span class="p">.</span><span class="nx">force</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">index</span> <span class="o">:</span> <span class="nx">argHash</span><span class="p">.</span><span class="nx">index</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">_types</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="kd">var</span> <span class="nx">source</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">model_pages</span><span class="p">.</span><span class="nx">imageURL</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">index</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-41'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-41">&#182;</a>
        </div>
        <p>Set the page number as a class, for page-dependent elements.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">className</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">className</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\s*DV-page-\d+/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; DV-page-&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">imgSource</span> <span class="o">!=</span> <span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">imgSource</span> <span class="o">=</span> <span class="nx">source</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">loadImage</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">sizeImage</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">position</span><span class="p">();</span></pre></div>
      </td>
    </tr>
    <tr id='section-42'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-42">&#182;</a>
        </div>
        <p>Only draw annotations if page number has changed or the
forceAnnotationRedraw flag is true.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pageNumber</span> <span class="o">!=</span> <span class="k">this</span><span class="p">.</span><span class="nx">index</span><span class="o">+</span><span class="mi">1</span> <span class="o">||</span> <span class="nx">argHash</span><span class="p">.</span><span class="nx">forceAnnotationRedraw</span> <span class="o">===</span> <span class="kc">true</span><span class="p">){</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">annotations</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">remove</span><span class="p">();</span>
      <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">annotations</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">hasLayerRegional</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">hasLayerPage</span>     <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">annotations</span> <span class="o">=</span> <span class="p">[];</span></pre></div>
      </td>
    </tr>
    <tr id='section-43'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-43">&#182;</a>
        </div>
        <p>if there are annotations for this page, it will proceed and attempt to draw</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="kd">var</span> <span class="nx">byPage</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">model_annotations</span><span class="p">.</span><span class="nx">byPage</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">index</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">byPage</span><span class="p">)</span> <span class="p">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-44'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-44">&#182;</a>
        </div>
        <p>Loop through all annotations and add to page</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">byPage</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">anno</span> <span class="o">=</span> <span class="nx">byPage</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

        <span class="k">if</span><span class="p">(</span><span class="nx">anno</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">annotationToLoadId</span><span class="p">){</span>
          <span class="kd">var</span> <span class="nx">active</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">anno</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">annotationToLoadEdit</span><span class="p">)</span> <span class="nx">argHash</span><span class="p">.</span><span class="nx">edit</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">openingAnnotationFromHash</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">jump</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">index</span><span class="p">,</span> <span class="p">(</span><span class="nx">anno</span><span class="p">.</span><span class="nx">top</span> <span class="o">||</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="mi">37</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">openingAnnotationFromHash</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
          <span class="kd">var</span> <span class="nx">active</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span><span class="p">(</span><span class="nx">anno</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s1">&#39;page&#39;</span><span class="p">){</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">hasLayerPage</span>     <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">anno</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s1">&#39;regional&#39;</span><span class="p">){</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">hasLayerRegional</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-allAnnotations .DV-annotation[rel=aid-&#39;</span><span class="o">+</span><span class="nx">anno</span><span class="p">.</span><span class="nx">id</span><span class="o">+</span><span class="s1">&#39;]&#39;</span><span class="p">).</span><span class="nx">clone</span><span class="p">();</span>
        <span class="nx">html</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;DV-annotation-&#39;</span> <span class="o">+</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
        <span class="nx">html</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.DV-img&#39;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
          <span class="nx">el</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">,</span> <span class="nx">el</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-src&#39;</span><span class="p">));</span>
        <span class="p">});</span>

        <span class="kd">var</span> <span class="nx">newAnno</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">Annotation</span><span class="p">({</span>
          <span class="nx">renderedHTML</span><span class="o">:</span> <span class="nx">html</span><span class="p">,</span>
          <span class="nx">id</span><span class="o">:</span>           <span class="nx">anno</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
          <span class="nx">page</span><span class="o">:</span>         <span class="k">this</span><span class="p">,</span>
          <span class="nx">pageEl</span><span class="o">:</span>       <span class="k">this</span><span class="p">.</span><span class="nx">pageEl</span><span class="p">,</span>
          <span class="nx">annotationContainerEl</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">annotationContainerEl</span><span class="p">,</span>
          <span class="nx">pageNumber</span><span class="o">:</span>   <span class="k">this</span><span class="p">.</span><span class="nx">pageNumber</span><span class="p">,</span>
          <span class="nx">state</span><span class="o">:</span>        <span class="s1">&#39;collapsed&#39;</span><span class="p">,</span>
          <span class="nx">top</span><span class="o">:</span>          <span class="nx">anno</span><span class="p">.</span><span class="nx">y1</span><span class="p">,</span>
          <span class="nx">left</span><span class="o">:</span>         <span class="nx">anno</span><span class="p">.</span><span class="nx">x1</span><span class="p">,</span>
          <span class="nx">width</span><span class="o">:</span>        <span class="nx">anno</span><span class="p">.</span><span class="nx">x1</span> <span class="o">+</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">x2</span><span class="p">,</span>
          <span class="nx">height</span><span class="o">:</span>       <span class="nx">anno</span><span class="p">.</span><span class="nx">y1</span> <span class="o">+</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">y2</span><span class="p">,</span>
          <span class="nx">active</span><span class="o">:</span>       <span class="nx">active</span><span class="p">,</span>
          <span class="nx">showEdit</span><span class="o">:</span>     <span class="nx">argHash</span><span class="p">.</span><span class="nx">edit</span><span class="p">,</span>
          <span class="nx">type</span><span class="o">:</span>         <span class="nx">anno</span><span class="p">.</span><span class="nx">type</span>
          <span class="p">}</span>
        <span class="p">);</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">newAnno</span><span class="p">);</span>

      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">pageInsertEl</span><span class="p">.</span><span class="nx">toggleClass</span><span class="p">(</span><span class="s1">&#39;visible&#39;</span><span class="p">,</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">hasLayerPage</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">renderMeta</span><span class="p">({</span> <span class="nx">pageNumber</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">index</span><span class="o">+</span><span class="mi">1</span> <span class="p">});</span></pre></div>
      </td>
    </tr>
    <tr id='section-45'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-45">&#182;</a>
        </div>
        <p>Draw remove overlay if page is removed.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">drawRemoveOverlay</span><span class="p">();</span>
  <span class="p">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-46'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-46">&#182;</a>
        </div>
        <p>Update the page type</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">setPageType</span><span class="p">();</span>

<span class="p">};</span>

<span class="nx">DV</span><span class="p">.</span><span class="nx">Page</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">drawRemoveOverlay</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">removedOverlayEl</span><span class="p">.</span><span class="nx">toggleClass</span><span class="p">(</span><span class="s1">&#39;visible&#39;</span><span class="p">,</span> <span class="o">!!</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">removedPages</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]);</span>
<span class="p">};</span>

<span class="nx">DV</span><span class="p">.</span><span class="nx">Page</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setPageType</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">){</span>
   <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">hasLayerPage</span> <span class="o">===</span> <span class="kc">true</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;DV-layer-page&#39;</span><span class="p">);</span>
   <span class="p">}</span>
   <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">hasLayerRegional</span> <span class="o">===</span> <span class="kc">true</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;DV-layer-page&#39;</span><span class="p">);</span>
   <span class="p">}</span>
  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;DV-layer-page DV-layer-regional&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-47'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-47">&#182;</a>
        </div>
        <p>Position Y coordinate of this page in the view based on current offset in the Document model</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">Page</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">argHash</span><span class="p">){</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span> <span class="nx">top</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">model_document</span><span class="p">.</span><span class="nx">offsets</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">index</span><span class="p">]</span> <span class="p">});</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">offset</span>  <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getOffset</span><span class="p">();</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-48'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-48">&#182;</a>
        </div>
        <p>Render the page meta, currently only the page number</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">Page</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">renderMeta</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">argHash</span><span class="p">){</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">pageNumberEl</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;p. &#39;</span><span class="o">+</span><span class="nx">argHash</span><span class="p">.</span><span class="nx">pageNumber</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">pageNumber</span> <span class="o">=</span> <span class="nx">argHash</span><span class="p">.</span><span class="nx">pageNumber</span><span class="p">;</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-49'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-49">&#182;</a>
        </div>
        <p>Load the actual image</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">Page</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">loadImage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">argHash</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">loadTimer</span><span class="p">){</span>
    <span class="nx">clearTimeout</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">loadTimer</span><span class="p">);</span>
    <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">loadTimer</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;DV-loaded&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;DV-loading&#39;</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-50'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-50">&#182;</a>
        </div>
        <p>On image load, update the height for the page and initiate drawImage method to resize accordingly</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="kd">var</span> <span class="nx">pageModel</span>       <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">model_pages</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">preloader</span>       <span class="o">=</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">(</span><span class="k">new</span> <span class="nx">Image</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">me</span>              <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">lazyImageLoader</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">loadTimer</span><span class="p">){</span>
      <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">loadTimer</span><span class="p">);</span>
      <span class="k">delete</span> <span class="nx">me</span><span class="p">.</span><span class="nx">loadTimer</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">preloader</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;load readystatechange&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">complete</span> <span class="o">||</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">==</span> <span class="s1">&#39;complete&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s1">&#39;readystatechange&#39;</span><span class="p">)){</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">preloader</span> <span class="o">!=</span> <span class="nx">me</span><span class="p">.</span><span class="nx">_currentLoader</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="nx">pageModel</span><span class="p">.</span><span class="nx">updateHeight</span><span class="p">(</span><span class="nx">preloader</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">me</span><span class="p">.</span><span class="nx">index</span><span class="p">);</span>
        <span class="nx">me</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">preloader</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">src</span><span class="p">);</span>
        <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">loadTimer</span><span class="p">);</span>
        <span class="k">delete</span> <span class="nx">me</span><span class="p">.</span><span class="nx">loadTimer</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">});</span>

    <span class="kd">var</span> <span class="nx">src</span> <span class="o">=</span> <span class="nx">me</span><span class="p">.</span><span class="nx">model_pages</span><span class="p">.</span><span class="nx">imageURL</span><span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">index</span><span class="p">);</span>
    <span class="nx">me</span><span class="p">.</span><span class="nx">_currentLoader</span> <span class="o">=</span> <span class="nx">preloader</span><span class="p">;</span>
    <span class="nx">preloader</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">src</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">loadTimer</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">lazyImageLoader</span><span class="p">,</span> <span class="mi">150</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">pageSet</span><span class="p">.</span><span class="nx">redraw</span><span class="p">();</span>
<span class="p">};</span>

<span class="nx">DV</span><span class="p">.</span><span class="nx">Page</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">sizeImage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">width</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">model_pages</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">height</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">model_pages</span><span class="p">.</span><span class="nx">getPageHeight</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">index</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-51'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-51">&#182;</a>
        </div>
        <p>Resize the cover.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">coverEl</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span><span class="nx">width</span><span class="o">:</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="o">:</span> <span class="nx">height</span><span class="p">});</span></pre></div>
      </td>
    </tr>
    <tr id='section-52'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-52">&#182;</a>
        </div>
        <p>Resize the image.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">pageImageEl</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span><span class="nx">width</span><span class="o">:</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="o">:</span> <span class="nx">height</span><span class="p">});</span></pre></div>
      </td>
    </tr>
    <tr id='section-53'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-53">&#182;</a>
        </div>
        <p>Resize the page container.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span><span class="nx">height</span><span class="o">:</span> <span class="nx">height</span><span class="p">,</span> <span class="nx">width</span><span class="o">:</span> <span class="nx">width</span><span class="p">});</span></pre></div>
      </td>
    </tr>
    <tr id='section-54'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-54">&#182;</a>
        </div>
        <p>Resize the page.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">pageEl</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span><span class="nx">height</span><span class="o">:</span> <span class="nx">height</span><span class="p">,</span> <span class="nx">width</span><span class="o">:</span> <span class="nx">width</span><span class="p">});</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-55'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-55">&#182;</a>
        </div>
        <p>draw the image and update surrounding image containers with the right size</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">Page</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">drawImage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">imageURL</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">imageHeight</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">model_pages</span><span class="p">.</span><span class="nx">getPageHeight</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">index</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-56'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-56">&#182;</a>
        </div>
        <p>var imageUrl = this.model_pages.imageURL(this.index);</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">if</span><span class="p">(</span><span class="nx">imageURL</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">pageImageEl</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">imageHeight</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">pageImageEl</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">))</span> <span class="p">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-57'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-57">&#182;</a>
        </div>
        <p>already scaled and drawn</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;DV-loaded&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;DV-loading&#39;</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-58'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-58">&#182;</a>
        </div>
        <p>Replace the image completely because of some funky loading bugs we were having</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">pageImageEl</span><span class="p">.</span><span class="nx">replaceWith</span><span class="p">(</span><span class="s1">&#39;&lt;img width=&quot;&#39;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">model_pages</span><span class="p">.</span><span class="nx">width</span><span class="o">+</span><span class="s1">&#39;&quot; height=&quot;&#39;</span><span class="o">+</span><span class="nx">imageHeight</span><span class="o">+</span><span class="s1">&#39;&quot; class=&quot;DV-pageImage&quot; src=&quot;&#39;</span><span class="o">+</span><span class="nx">imageURL</span><span class="o">+</span><span class="s1">&#39;&quot; /&gt;&#39;</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-59'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-59">&#182;</a>
        </div>
        <p>Update element reference</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">setPageImage</span><span class="p">();</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">sizeImage</span><span class="p">();</span></pre></div>
      </td>
    </tr>
    <tr id='section-60'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-60">&#182;</a>
        </div>
        <p>Update the status of the image load</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;DV-loaded&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;DV-loading&#39;</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">DV</span><span class="p">.</span><span class="nx">PageSet</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">viewer</span><span class="p">){</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">currentPage</span>  <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">pages</span>        <span class="o">=</span> <span class="p">{};</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span>       <span class="o">=</span> <span class="nx">viewer</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">zoomText</span><span class="p">();</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-61'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-61">&#182;</a>
        </div>
        <p>used to call the same method with the same params against all page instances</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">PageSet</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">execute</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">action</span><span class="p">,</span><span class="nx">params</span><span class="p">){</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">pages</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">pageInstance</span><span class="p">){</span>
    <span class="nx">pageInstance</span><span class="p">[</span><span class="nx">action</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="nx">pageInstance</span><span class="p">,</span><span class="nx">params</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-62'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-62">&#182;</a>
        </div>
        <p>build the basic page presentation layer</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">PageSet</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">buildPages</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>
  <span class="kd">var</span> <span class="nx">pages</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getPages</span><span class="p">();</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">pages</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">page</span>  <span class="o">=</span> <span class="nx">pages</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
    <span class="nx">page</span><span class="p">.</span><span class="nx">set</span>  <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">page</span><span class="p">.</span><span class="nx">index</span> <span class="o">=</span> <span class="nx">i</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-63'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-63">&#182;</a>
        </div>
        <p>TODO: Make more explicit, this is sloppy</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">page</span><span class="p">.</span><span class="nx">label</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">Page</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">,</span> <span class="nx">page</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">page</span><span class="p">.</span><span class="nx">currentPage</span> <span class="o">==</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">currentPage</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">page</span><span class="p">.</span><span class="nx">label</span><span class="p">];</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">renderAnnotations</span><span class="p">();</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-64'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-64">&#182;</a>
        </div>
        <p>used to generate references for the build action</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">PageSet</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getPages</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="kd">var</span> <span class="nx">_pages</span> <span class="o">=</span> <span class="p">[];</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">sets</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">_index</span><span class="p">,</span><span class="nx">el</span><span class="p">){</span>

    <span class="kd">var</span> <span class="nx">currentPage</span> <span class="o">=</span> <span class="p">(</span><span class="nx">_index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">_pages</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span> <span class="nx">label</span><span class="o">:</span> <span class="s1">&#39;p&#39;</span><span class="o">+</span><span class="nx">_index</span><span class="p">,</span> <span class="nx">el</span><span class="o">:</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">index</span><span class="o">:</span> <span class="nx">_index</span><span class="p">,</span> <span class="nx">pageNumber</span><span class="o">:</span> <span class="nx">_index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">currentPage</span><span class="o">:</span> <span class="nx">currentPage</span> <span class="p">});</span>

  <span class="p">});</span>

  <span class="k">return</span> <span class="nx">_pages</span><span class="p">;</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-65'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-65">&#182;</a>
        </div>
        <p>basic reflow to ensure zoomlevel is right, pages are in the right place and annotation limits are correct</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">PageSet</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">reflowPages</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">pages</span><span class="p">.</span><span class="nx">resize</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">setActiveAnnotationLimits</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">redraw</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-66'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-66">&#182;</a>
        </div>
        <p>reflow the pages without causing the container to resize or annotations to redraw</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">PageSet</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">simpleReflowPages</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">setActiveAnnotationLimits</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">redraw</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-67'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-67">&#182;</a>
        </div>
        <p>hide any active annotations</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">PageSet</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">cleanUp</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotation</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotation</span><span class="p">.</span><span class="nx">hide</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">DV</span><span class="p">.</span><span class="nx">PageSet</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">zoom</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">argHash</span><span class="p">){</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">zoomLevel</span> <span class="o">===</span> <span class="nx">argHash</span><span class="p">.</span><span class="nx">zoomLevel</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">currentPage</span>  <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">currentIndex</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">oldOffset</span>    <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">offsets</span><span class="p">[</span><span class="nx">currentPage</span><span class="p">];</span>
  <span class="kd">var</span> <span class="nx">oldZoom</span>      <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">zoomLevel</span><span class="o">*</span><span class="mi">1</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">relativeZoom</span> <span class="o">=</span> <span class="nx">argHash</span><span class="p">.</span><span class="nx">zoomLevel</span> <span class="o">/</span> <span class="nx">oldZoom</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">scrollPos</span>    <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">();</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">zoom</span><span class="p">(</span><span class="nx">argHash</span><span class="p">.</span><span class="nx">zoomLevel</span><span class="p">);</span>

  <span class="kd">var</span> <span class="nx">diff</span>        <span class="o">=</span> <span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">scrollPos</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">&gt;</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">oldOffset</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span> <span class="o">?</span> <span class="nx">scrollPos</span> <span class="o">-</span> <span class="nx">oldOffset</span> <span class="o">:</span> <span class="nx">oldOffset</span> <span class="o">-</span> <span class="nx">scrollPos</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">diffPercentage</span>   <span class="o">=</span> <span class="nx">diff</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">pages</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">reflowPages</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">zoomText</span><span class="p">();</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">state</span> <span class="o">===</span> <span class="s1">&#39;ViewThumbnails&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">thumbnails</span><span class="p">.</span><span class="nx">setZoom</span><span class="p">(</span><span class="nx">argHash</span><span class="p">.</span><span class="nx">zoomLevel</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">thumbnails</span><span class="p">.</span><span class="nx">lazyloadThumbnails</span><span class="p">();</span>
  <span class="p">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-68'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-68">&#182;</a>
        </div>
        <p>Zoom any drawn redactions.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">state</span> <span class="o">===</span> <span class="s1">&#39;ViewDocument&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-annotationRegion.DV-accessRedact&#39;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="nx">el</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span>
        <span class="nx">top</span>    <span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">position</span><span class="p">().</span><span class="nx">top</span>  <span class="o">*</span> <span class="nx">relativeZoom</span><span class="p">),</span>
        <span class="nx">left</span>   <span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">position</span><span class="p">().</span><span class="nx">left</span> <span class="o">*</span> <span class="nx">relativeZoom</span><span class="p">),</span>
        <span class="nx">width</span>  <span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span>         <span class="o">*</span> <span class="nx">relativeZoom</span><span class="p">),</span>
        <span class="nx">height</span> <span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span>        <span class="o">*</span> <span class="nx">relativeZoom</span><span class="p">)</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotation</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">){</span></pre></div>
      </td>
    </tr>
    <tr id='section-69'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-69">&#182;</a>
        </div>
        <p>FIXME:</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">index</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">currentIndex</span><span class="p">(),</span>
      <span class="nx">top</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotation</span><span class="p">.</span><span class="nx">top</span><span class="p">,</span>
      <span class="nx">id</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotation</span><span class="p">.</span><span class="nx">id</span>
    <span class="p">};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotation</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">showAnnotation</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">setActiveAnnotationLimits</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotation</span><span class="p">);</span>
  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_offset</span>      <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">pages</span><span class="p">.</span><span class="nx">height</span> <span class="o">*</span> <span class="nx">diffPercentage</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">jump</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">currentIndex</span><span class="p">(),</span><span class="nx">_offset</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-70'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-70">&#182;</a>
        </div>
        <p>Zoom the text container.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">PageSet</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">zoomText</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">padding</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">pages</span><span class="p">.</span><span class="nx">DEFAULT_PADDING</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">width</span>   <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">pages</span><span class="p">.</span><span class="nx">zoomLevel</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-textContents&#39;</span><span class="p">).</span><span class="nx">width</span><span class="p">(</span><span class="nx">width</span> <span class="o">-</span> <span class="nx">padding</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-textPage&#39;</span><span class="p">).</span><span class="nx">width</span><span class="p">(</span><span class="nx">width</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">zoom</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">padding</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">pages</span><span class="p">.</span><span class="nx">REDUCED_PADDING</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span><span class="s1">&#39;width&#39;</span> <span class="o">:</span> <span class="nx">width</span> <span class="o">+</span> <span class="nx">padding</span><span class="p">});</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-71'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-71">&#182;</a>
        </div>
        <p>draw the pages</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">PageSet</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">draw</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pageCollection</span><span class="p">){</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">pageCollectionLength</span> <span class="o">=</span> <span class="nx">pageCollection</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">pageCollectionLength</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">page</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">pageCollection</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">label</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">page</span><span class="p">)</span> <span class="nx">page</span><span class="p">.</span><span class="nx">draw</span><span class="p">({</span> <span class="nx">index</span><span class="o">:</span> <span class="nx">pageCollection</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">index</span><span class="p">,</span> <span class="nx">pageNumber</span><span class="o">:</span> <span class="nx">pageCollection</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">index</span><span class="o">+</span><span class="mi">1</span><span class="p">});</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">DV</span><span class="p">.</span><span class="nx">PageSet</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">redraw</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stopResetOfPosition</span><span class="p">,</span> <span class="nx">redrawAnnotations</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="s1">&#39;p0&#39;</span><span class="p">])</span> <span class="k">this</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="s1">&#39;p0&#39;</span><span class="p">].</span><span class="nx">draw</span><span class="p">({</span> <span class="nx">force</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">forceAnnotationRedraw</span> <span class="o">:</span> <span class="nx">redrawAnnotations</span> <span class="p">});</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="s1">&#39;p1&#39;</span><span class="p">])</span> <span class="k">this</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="s1">&#39;p1&#39;</span><span class="p">].</span><span class="nx">draw</span><span class="p">({</span> <span class="nx">force</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">forceAnnotationRedraw</span> <span class="o">:</span> <span class="nx">redrawAnnotations</span> <span class="p">});</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="s1">&#39;p2&#39;</span><span class="p">])</span> <span class="k">this</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="s1">&#39;p2&#39;</span><span class="p">].</span><span class="nx">draw</span><span class="p">({</span> <span class="nx">force</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">forceAnnotationRedraw</span> <span class="o">:</span> <span class="nx">redrawAnnotations</span> <span class="p">});</span>

  <span class="k">if</span><span class="p">(</span><span class="nx">redrawAnnotations</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotation</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">jump</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotation</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">index</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotation</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">top</span> <span class="o">-</span> <span class="mi">37</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-72'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-72">&#182;</a>
        </div>
        <p>set the annotation to load ahead of time</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">PageSet</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setActiveAnnotation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">annotationId</span><span class="p">,</span> <span class="nx">edit</span><span class="p">){</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">annotationToLoadId</span>   <span class="o">=</span> <span class="nx">annotationId</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">annotationToLoadEdit</span> <span class="o">=</span> <span class="nx">edit</span> <span class="o">?</span> <span class="nx">annotationId</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-73'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-73">&#182;</a>
        </div>
        <p>a funky fucking mess to jump to the annotation that is active</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">PageSet</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">showAnnotation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">argHash</span><span class="p">,</span> <span class="nx">showHash</span><span class="p">){</span>
  <span class="nx">showHash</span> <span class="o">=</span> <span class="nx">showHash</span> <span class="o">||</span> <span class="p">{};</span></pre></div>
      </td>
    </tr>
    <tr id='section-74'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-74">&#182;</a>
        </div>
        <p>if state is ViewAnnotation, jump to the appropriate position in the view
else
hide active annotations and locate the position of the next annotation
NOTE: This needs work</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">state</span> <span class="o">===</span> <span class="s1">&#39;ViewAnnotation&#39;</span><span class="p">){</span>

    <span class="kd">var</span> <span class="nx">offset</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-allAnnotations div[rel=aid-&#39;</span><span class="o">+</span><span class="nx">argHash</span><span class="p">.</span><span class="nx">id</span><span class="o">+</span><span class="s1">&#39;]&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">offsetTop</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">(</span><span class="nx">offset</span><span class="o">+</span><span class="mi">10</span><span class="p">,</span><span class="s1">&#39;fast&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">setActiveAnnotationInNav</span><span class="p">(</span><span class="nx">argHash</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotationId</span> <span class="o">=</span> <span class="nx">argHash</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-75'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-75">&#182;</a>
        </div>
        <p>this.viewer.history.save(&lsquo;annotation/a&rsquo;+argHash.id);</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">removeObserver</span><span class="p">(</span><span class="s1">&#39;trackAnnotation&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotationId</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotation</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotation</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setActiveAnnotation</span><span class="p">(</span><span class="nx">argHash</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">showHash</span><span class="p">.</span><span class="nx">edit</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">isPage</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">byId</span><span class="p">[</span><span class="nx">argHash</span><span class="p">.</span><span class="nx">id</span><span class="p">].</span><span class="nx">type</span> <span class="o">==</span> <span class="s1">&#39;page&#39;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">nudge</span>  <span class="o">=</span> <span class="nx">isPage</span> <span class="o">?</span> <span class="o">-</span><span class="mi">7</span> <span class="o">:</span> <span class="mi">36</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">offset</span> <span class="o">=</span> <span class="nx">argHash</span><span class="p">.</span><span class="nx">top</span> <span class="o">-</span> <span class="nx">nudge</span><span class="p">;</span>

    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="s1">&#39;p&#39;</span> <span class="o">+</span> <span class="nx">i</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">n</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="o">+</span><span class="nx">i</span><span class="p">].</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">n</span><span class="o">++</span><span class="p">){</span>
          <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="o">+</span><span class="nx">i</span><span class="p">].</span><span class="nx">annotations</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">argHash</span><span class="p">.</span><span class="nx">id</span><span class="p">){</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">jump</span><span class="p">(</span><span class="nx">argHash</span><span class="p">.</span><span class="nx">index</span><span class="p">,</span> <span class="nx">offset</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="o">+</span><span class="nx">i</span><span class="p">].</span><span class="nx">annotations</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">show</span><span class="p">(</span><span class="nx">showHash</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">jump</span><span class="p">(</span><span class="nx">argHash</span><span class="p">.</span><span class="nx">index</span><span class="p">,</span><span class="nx">offset</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-76'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-76">&#182;</a>
        </div>
        <p>Create a thumbnails view for a given viewer, using a URL template, and
the number of pages in the document.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">Thumbnails</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">viewer</span><span class="p">){</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">currentIndex</span>    <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">zoomLevel</span>       <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">scrollTimer</span>     <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">imageUrl</span>        <span class="o">=</span> <span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">image</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\{size\}/</span><span class="p">,</span> <span class="s1">&#39;small&#39;</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">pageCount</span>       <span class="o">=</span> <span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">pages</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span>          <span class="o">=</span> <span class="nx">viewer</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">resizeId</span>        <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">sizes</span>           <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;0&quot;</span><span class="o">:</span> <span class="p">{</span><span class="nx">w</span><span class="o">:</span> <span class="mi">60</span><span class="p">,</span> <span class="nx">h</span><span class="o">:</span> <span class="mi">75</span><span class="p">},</span>
    <span class="s2">&quot;1&quot;</span><span class="o">:</span> <span class="p">{</span><span class="nx">w</span><span class="o">:</span> <span class="mi">90</span><span class="p">,</span> <span class="nx">h</span><span class="o">:</span> <span class="mi">112</span><span class="p">},</span>
    <span class="s2">&quot;2&quot;</span><span class="o">:</span> <span class="p">{</span><span class="nx">w</span><span class="o">:</span> <span class="mi">120</span><span class="p">,</span> <span class="nx">h</span><span class="o">:</span> <span class="mi">150</span><span class="p">},</span>
    <span class="s2">&quot;3&quot;</span><span class="o">:</span> <span class="p">{</span><span class="nx">w</span><span class="o">:</span> <span class="mi">150</span><span class="p">,</span> <span class="nx">h</span><span class="o">:</span> <span class="mi">188</span><span class="p">},</span>
    <span class="s2">&quot;4&quot;</span><span class="o">:</span> <span class="p">{</span><span class="nx">w</span><span class="o">:</span> <span class="mi">180</span><span class="p">,</span> <span class="nx">h</span><span class="o">:</span> <span class="mi">225</span><span class="p">}</span>
  <span class="p">};</span>
  <span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;lazyloadThumbnails&#39;</span><span class="p">,</span> <span class="s1">&#39;loadThumbnails&#39;</span><span class="p">);</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-77'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-77">&#182;</a>
        </div>
        <p>Render the Thumbnails from scratch.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">Thumbnails</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">render</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">el</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-thumbnails&#39;</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">getCurrentIndex</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">getZoom</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">buildThumbnails</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">pageCount</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">setZoom</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s1">&#39;scroll.thumbnails&#39;</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;scroll.thumbnails&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">lazyloadThumbnails</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">resizeEvent</span> <span class="o">=</span> <span class="s1">&#39;resize.thumbnails-&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">resizeId</span><span class="p">;</span>
  <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">unbind</span><span class="p">(</span><span class="nx">resizeEvent</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="nx">resizeEvent</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">lazyloadThumbnails</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">DV</span><span class="p">.</span><span class="nx">Thumbnails</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">buildThumbnails</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">startPage</span><span class="p">,</span> <span class="nx">endPage</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">startPage</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">empty</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">thumbnailsHTML</span> <span class="o">=</span> <span class="nx">JST</span><span class="p">.</span><span class="nx">thumbnails</span><span class="p">({</span>
    <span class="nx">page</span>      <span class="o">:</span> <span class="nx">startPage</span><span class="p">,</span>
    <span class="nx">endPage</span>   <span class="o">:</span> <span class="nx">endPage</span><span class="p">,</span>
    <span class="nx">zoom</span>      <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">zoomLevel</span><span class="p">,</span>
    <span class="nx">imageUrl</span>  <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">imageUrl</span>
  <span class="p">});</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">html</span><span class="p">()</span> <span class="o">+</span> <span class="nx">thumbnailsHTML</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">highlightCurrentPage</span><span class="p">();</span>
  <span class="nx">_</span><span class="p">.</span><span class="nx">defer</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">loadThumbnails</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">DV</span><span class="p">.</span><span class="nx">Thumbnails</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getCurrentIndex</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">currentIndex</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">currentIndex</span><span class="p">();</span>
<span class="p">};</span>

<span class="nx">DV</span><span class="p">.</span><span class="nx">Thumbnails</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">highlightCurrentPage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">currentIndex</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">currentIndex</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-thumbnail.DV-selected&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;DV-selected&#39;</span><span class="p">);</span>

  <span class="kd">var</span> <span class="nx">currentThumbnail</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-thumbnail:eq(&#39;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">currentIndex</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">currentThumbnail</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">currentThumbnail</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;DV-selected&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">pages</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-pages&#39;</span><span class="p">);</span>
    <span class="nx">pages</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">(</span><span class="nx">pages</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">()</span> <span class="o">+</span> <span class="nx">currentThumbnail</span><span class="p">.</span><span class="nx">position</span><span class="p">().</span><span class="nx">top</span> <span class="o">-</span> <span class="mi">12</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-78'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-78">&#182;</a>
        </div>
        <p>Set the appropriate zoomLevel class for the thumbnails, estimating
height change.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">Thumbnails</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setZoom</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">zoom</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">getZoom</span><span class="p">(</span><span class="nx">zoom</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">size</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sizes</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">zoomLevel</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-hasHeight&#39;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">ratio</span> <span class="o">=</span> <span class="nx">size</span><span class="p">.</span><span class="nx">w</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
    <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span><span class="nx">height</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">*</span> <span class="nx">ratio</span><span class="p">});</span>
  <span class="p">});</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-hasWidth&#39;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">ratio</span> <span class="o">=</span> <span class="nx">size</span><span class="p">.</span><span class="nx">h</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">thisEl</span> <span class="o">=</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="nx">thisEl</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">thisEl</span><span class="p">.</span><span class="nx">prev</span><span class="p">(</span><span class="s1">&#39;.DV-thumbnail-shadow&#39;</span><span class="p">)).</span><span class="nx">css</span><span class="p">({</span><span class="nx">width</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">*</span> <span class="nx">ratio</span><span class="p">});</span>
  <span class="p">});</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">className</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">className</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/DV-zoom-\d\s*/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;DV-zoom-&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">zoomLevel</span><span class="p">);</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-79'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-79">&#182;</a>
        </div>
        <p>The thumbnails (unfortunately) have their own notion of the current zoom
level &mdash; specified from 0 &ndash; 4.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">Thumbnails</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getZoom</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">zoom</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">zoom</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">zoomLevel</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">ZOOM_RANGES</span><span class="p">,</span> <span class="nx">zoom</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">zoomLevel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">slider</span><span class="p">.</span><span class="nx">slider</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-80'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-80">&#182;</a>
        </div>
        <p>After a thumbnail has been loaded, we know its height.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">Thumbnails</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setImageSize</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">image</span><span class="p">,</span> <span class="nx">imageEl</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">size</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sizes</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">zoomLevel</span><span class="p">];</span>
  <span class="kd">var</span> <span class="nx">ratio</span> <span class="o">=</span> <span class="nx">size</span><span class="p">.</span><span class="nx">w</span> <span class="o">/</span> <span class="nx">image</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">newHeight</span> <span class="o">=</span> <span class="nx">image</span><span class="p">.</span><span class="nx">height</span> <span class="o">*</span> <span class="nx">ratio</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">size</span><span class="p">.</span><span class="nx">h</span> <span class="o">-</span> <span class="nx">newHeight</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="o">||</span> <span class="p">(</span><span class="sr">/DV-has/</span><span class="p">).</span><span class="nx">test</span><span class="p">(</span><span class="nx">imageEl</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">className</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">newHeight</span> <span class="o">&lt;</span> <span class="nx">size</span><span class="p">.</span><span class="nx">h</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">imageEl</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;DV-hasHeight&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span><span class="nx">height</span><span class="o">:</span> <span class="nx">newHeight</span><span class="p">});</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">heightRatio</span> <span class="o">=</span> <span class="nx">newHeight</span> <span class="o">/</span> <span class="nx">size</span><span class="p">.</span><span class="nx">h</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">newWidth</span> <span class="o">=</span> <span class="nx">size</span><span class="p">.</span><span class="nx">w</span> <span class="o">/</span> <span class="nx">heightRatio</span><span class="p">;</span>
      <span class="nx">imageEl</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">imageEl</span><span class="p">.</span><span class="nx">prev</span><span class="p">(</span><span class="s1">&#39;.DV-thumbnail-shadow&#39;</span><span class="p">)).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;DV-hasWidth&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span><span class="nx">width</span><span class="o">:</span> <span class="nx">newWidth</span><span class="p">});</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nx">imageEl</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span><span class="nx">src</span><span class="o">:</span> <span class="nx">image</span><span class="p">.</span><span class="nx">src</span><span class="p">});</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-81'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-81">&#182;</a>
        </div>
        <p>Only attempt to load the current viewport&rsquo;s worth of thumbnails if we&rsquo;ve
been sitting still for at least 1/10th of a second.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">Thumbnails</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">lazyloadThumbnails</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">state</span> <span class="o">!=</span> <span class="s1">&#39;ViewThumbnails&#39;</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">scrollTimer</span><span class="p">)</span> <span class="nx">clearTimeout</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">scrollTimer</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">scrollTimer</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">loadThumbnails</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-82'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-82">&#182;</a>
        </div>
        <p>Load the currently visible thumbnails, as determined by the size and position
of the viewport.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">Thumbnails</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">loadThumbnails</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">viewer</span>           <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">width</span>            <span class="o">=</span> <span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-thumbnails&#39;</span><span class="p">).</span><span class="nx">width</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">height</span>           <span class="o">=</span> <span class="nx">viewer</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">height</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">scrollTop</span>        <span class="o">=</span> <span class="nx">viewer</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">scrollBottom</span>     <span class="o">=</span> <span class="nx">scrollTop</span> <span class="o">+</span> <span class="nx">height</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">first</span>            <span class="o">=</span> <span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-thumbnail:first-child&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">firstHeight</span>      <span class="o">=</span> <span class="nx">first</span><span class="p">.</span><span class="nx">outerHeight</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">firstWidth</span>       <span class="o">=</span> <span class="nx">first</span><span class="p">.</span><span class="nx">outerWidth</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-83'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-83">&#182;</a>
        </div>
        <p>Determine the top and bottom page.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="kd">var</span> <span class="nx">thumbnailsPerRow</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">width</span> <span class="o">/</span> <span class="nx">firstWidth</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">startPage</span>        <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">scrollTop</span> <span class="o">/</span> <span class="nx">firstHeight</span> <span class="o">*</span> <span class="nx">thumbnailsPerRow</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">endPage</span>          <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">scrollBottom</span> <span class="o">/</span> <span class="nx">firstHeight</span> <span class="o">*</span> <span class="nx">thumbnailsPerRow</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-84'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-84">&#182;</a>
        </div>
        <p>Round to the nearest whole row (startPage and endPage are indexes, not
page numbers).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">startPage</span>            <span class="o">-=</span> <span class="p">(</span><span class="nx">startPage</span> <span class="o">%</span> <span class="nx">thumbnailsPerRow</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="nx">endPage</span>              <span class="o">+=</span> <span class="nx">thumbnailsPerRow</span> <span class="o">-</span> <span class="p">(</span><span class="nx">endPage</span> <span class="o">%</span> <span class="nx">thumbnailsPerRow</span><span class="p">);</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">loadImages</span><span class="p">(</span><span class="nx">startPage</span><span class="p">,</span> <span class="nx">endPage</span><span class="p">);</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-85'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-85">&#182;</a>
        </div>
        <p>Load all of the images within a range of visible thumbnails.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">Thumbnails</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">loadImages</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">startPage</span><span class="p">,</span> <span class="nx">endPage</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">viewer</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">gt</span> <span class="o">=</span> <span class="nx">startPage</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="s1">&#39;:gt(&#39;</span> <span class="o">+</span> <span class="nx">startPage</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">lt</span> <span class="o">=</span> <span class="nx">endPage</span> <span class="o">&lt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">pageCount</span> <span class="o">?</span> <span class="s1">&#39;:lt(&#39;</span> <span class="o">+</span> <span class="nx">endPage</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-thumbnail&#39;</span> <span class="o">+</span> <span class="nx">lt</span> <span class="o">+</span> <span class="nx">gt</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">el</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">))</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">imageEl</span> <span class="o">=</span> <span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-thumbnail-image&#39;</span><span class="p">,</span> <span class="nx">el</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">image</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">();</span>
      <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">(</span><span class="nx">image</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">setImageSize</span><span class="p">,</span> <span class="nx">self</span><span class="p">,</span> <span class="nx">image</span><span class="p">,</span> <span class="nx">imageEl</span><span class="p">))</span>
                      <span class="p">.</span><span class="nx">attr</span><span class="p">({</span><span class="nx">src</span><span class="o">:</span> <span class="nx">imageEl</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-src&#39;</span><span class="p">)});</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">};</span>

<span class="nx">DV</span><span class="p">.</span><span class="nx">Schema</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">models</span>       <span class="o">=</span> <span class="p">{};</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">views</span>        <span class="o">=</span> <span class="p">{};</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">states</span>       <span class="o">=</span> <span class="p">{};</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span>      <span class="o">=</span> <span class="p">{};</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">events</span>       <span class="o">=</span> <span class="p">{};</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">elements</span>     <span class="o">=</span> <span class="p">{};</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">text</span>         <span class="o">=</span> <span class="p">{};</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">data</span>         <span class="o">=</span> <span class="p">{</span>
    <span class="nx">zoomLevel</span>               <span class="o">:</span> <span class="mi">700</span><span class="p">,</span>
    <span class="nx">pageWidthPadding</span>        <span class="o">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="nx">additionalPaddingOnPage</span> <span class="o">:</span> <span class="mi">30</span><span class="p">,</span>
    <span class="nx">state</span>                   <span class="o">:</span> <span class="p">{</span> <span class="nx">page</span><span class="o">:</span> <span class="p">{</span> <span class="nx">previous</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">current</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">next</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">}</span>
  <span class="p">};</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-86'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-86">&#182;</a>
        </div>
        <p>Imports the document&rsquo;s JSON representation into the DV.Schema form that
the models expect.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">Schema</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">importCanonicalDocument</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">json</span><span class="p">)</span> <span class="p">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-87'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-87">&#182;</a>
        </div>
        <p>Ensure that IDs start with 1 as the lowest id.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">();</span></pre></div>
      </td>
    </tr>
    <tr id='section-88'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-88">&#182;</a>
        </div>
        <p>Ensure at least empty arrays for sections.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">json</span><span class="p">.</span><span class="nx">sections</span>               <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">sortBy</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">sections</span> <span class="o">||</span> <span class="p">[],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">sec</span><span class="p">){</span> <span class="k">return</span> <span class="nx">sec</span><span class="p">.</span><span class="nx">page</span><span class="p">;</span> <span class="p">});</span>
  <span class="nx">json</span><span class="p">.</span><span class="nx">annotations</span>            <span class="o">=</span> <span class="nx">json</span><span class="p">.</span><span class="nx">annotations</span> <span class="o">||</span> <span class="p">[];</span>
  <span class="nx">json</span><span class="p">.</span><span class="nx">canonicalURL</span>           <span class="o">=</span> <span class="nx">json</span><span class="p">.</span><span class="nx">canonical_url</span><span class="p">;</span>

  <span class="k">this</span><span class="p">.</span><span class="nb">document</span>               <span class="o">=</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="p">{},</span> <span class="nx">json</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-89'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-89">&#182;</a>
        </div>
        <p>Everything after this line is for back-compatibility.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">title</span>             <span class="o">=</span> <span class="nx">json</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">totalPages</span>        <span class="o">=</span> <span class="nx">json</span><span class="p">.</span><span class="nx">pages</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">totalAnnotations</span>  <span class="o">=</span> <span class="nx">json</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">sections</span>          <span class="o">=</span> <span class="nx">json</span><span class="p">.</span><span class="nx">sections</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">chapters</span>          <span class="o">=</span> <span class="p">[];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">annotationsById</span>   <span class="o">=</span> <span class="p">{};</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">annotationsByPage</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">annotations</span><span class="p">,</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">loadAnnotation</span><span class="p">,</span> <span class="k">this</span><span class="p">));</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-90'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-90">&#182;</a>
        </div>
        <p>Load an annotation into the Schema, starting from the canonical format.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">Schema</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">loadAnnotation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">anno</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">anno</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">server_id</span> <span class="o">=</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">idx</span>     <span class="o">=</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">page</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
  <span class="nx">anno</span><span class="p">.</span><span class="nx">id</span>     <span class="o">=</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">id</span> <span class="o">||</span> <span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">();</span>
  <span class="nx">anno</span><span class="p">.</span><span class="nx">title</span>  <span class="o">=</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">title</span> <span class="o">||</span> <span class="s1">&#39;Untitled Note&#39;</span><span class="p">;</span>
  <span class="nx">anno</span><span class="p">.</span><span class="nx">text</span>   <span class="o">=</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">content</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="nx">anno</span><span class="p">.</span><span class="nx">access</span> <span class="o">=</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">access</span> <span class="o">||</span> <span class="s1">&#39;public&#39;</span><span class="p">;</span>
  <span class="nx">anno</span><span class="p">.</span><span class="nx">type</span>   <span class="o">=</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">location</span> <span class="o">&amp;&amp;</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">image</span> <span class="o">?</span> <span class="s1">&#39;region&#39;</span> <span class="o">:</span> <span class="s1">&#39;page&#39;</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">anno</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;region&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">loc</span> <span class="o">=</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">anno</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">image</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span> <span class="p">});</span>
    <span class="nx">anno</span><span class="p">.</span><span class="nx">y1</span> <span class="o">=</span> <span class="nx">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">x2</span> <span class="o">=</span> <span class="nx">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">y2</span> <span class="o">=</span> <span class="nx">loc</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">x1</span> <span class="o">=</span> <span class="nx">loc</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
  <span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">anno</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;page&#39;</span><span class="p">){</span>
    <span class="nx">anno</span><span class="p">.</span><span class="nx">y1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">x2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">y2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">x1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">annotationsById</span><span class="p">[</span><span class="nx">anno</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">anno</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">page</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">annotationsByPage</span><span class="p">[</span><span class="nx">idx</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">annotationsByPage</span><span class="p">[</span><span class="nx">idx</span><span class="p">]</span> <span class="o">||</span> <span class="p">[];</span>
  <span class="kd">var</span> <span class="nx">insertionIndex</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">sortedIndex</span><span class="p">(</span><span class="nx">page</span><span class="p">,</span> <span class="nx">anno</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">){</span> <span class="k">return</span> <span class="nx">a</span><span class="p">.</span><span class="nx">y1</span><span class="p">;</span> <span class="p">});</span>
  <span class="nx">page</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">insertionIndex</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">anno</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">anno</span><span class="p">;</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-91'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-91">&#182;</a>
        </div>
        <p>We cache DOM references to improve speed and reduce DOM queries</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-92'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-92">&#182;</a>
        </div>
        <p>additions include well2</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">Schema</span><span class="p">.</span><span class="nx">elements</span> <span class="o">=</span>
<span class="p">[</span>
  <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;browserDocument&#39;</span><span class="p">,</span>    <span class="nx">query</span><span class="o">:</span> <span class="nb">document</span> <span class="p">},</span>
  <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;browserWindow&#39;</span><span class="p">,</span>      <span class="nx">query</span><span class="o">:</span> <span class="nb">window</span> <span class="p">},</span>
  <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;header&#39;</span><span class="p">,</span>             <span class="nx">query</span><span class="o">:</span> <span class="s1">&#39;div.DV-header&#39;</span><span class="p">},</span>
  <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;viewer&#39;</span><span class="p">,</span>             <span class="nx">query</span><span class="o">:</span> <span class="s1">&#39;div.DV-docViewer&#39;</span><span class="p">},</span>
  <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;window&#39;</span><span class="p">,</span>             <span class="nx">query</span><span class="o">:</span> <span class="s1">&#39;div.DV-pages&#39;</span><span class="p">},</span>
  <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;sets&#39;</span><span class="p">,</span>               <span class="nx">query</span><span class="o">:</span> <span class="s1">&#39;div.DV-set&#39;</span><span class="p">},</span>
  <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;pages&#39;</span><span class="p">,</span>              <span class="nx">query</span><span class="o">:</span> <span class="s1">&#39;div.DV-page&#39;</span><span class="p">},</span>
  <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;metas&#39;</span><span class="p">,</span>              <span class="nx">query</span><span class="o">:</span> <span class="s1">&#39;div.DV-pageMeta&#39;</span><span class="p">},</span>
  <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span>                <span class="nx">query</span><span class="o">:</span> <span class="s1">&#39;div.DV-bar&#39;</span><span class="p">},</span>
  <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;currentPage&#39;</span><span class="p">,</span>        <span class="nx">query</span><span class="o">:</span> <span class="s1">&#39;span.DV-currentPage&#39;</span><span class="p">},</span>
  <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;well&#39;</span><span class="p">,</span>               <span class="nx">query</span><span class="o">:</span> <span class="s1">&#39;div.DV-well&#39;</span><span class="p">},</span>
  <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;collection&#39;</span><span class="p">,</span>         <span class="nx">query</span><span class="o">:</span> <span class="s1">&#39;div.DV-pageCollection&#39;</span><span class="p">},</span>
  <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;annotations&#39;</span><span class="p">,</span>        <span class="nx">query</span><span class="o">:</span> <span class="s1">&#39;div.DV-allAnnotations&#39;</span><span class="p">},</span>
  <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;navigation&#39;</span><span class="p">,</span>         <span class="nx">query</span><span class="o">:</span> <span class="s1">&#39;div.DV-navigation&#39;</span> <span class="p">},</span>
  <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;chaptersContainer&#39;</span><span class="p">,</span>  <span class="nx">query</span><span class="o">:</span> <span class="s1">&#39;div.DV-chaptersContainer&#39;</span> <span class="p">},</span>
  <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;searchInput&#39;</span><span class="p">,</span>        <span class="nx">query</span><span class="o">:</span> <span class="s1">&#39;input.DV-searchInput&#39;</span> <span class="p">},</span>
  <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;textCurrentPage&#39;</span><span class="p">,</span>    <span class="nx">query</span><span class="o">:</span> <span class="s1">&#39;span.DV-textCurrentPage&#39;</span> <span class="p">},</span>
  <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;coverPages&#39;</span><span class="p">,</span>         <span class="nx">query</span><span class="o">:</span> <span class="s1">&#39;div.DV-cover&#39;</span> <span class="p">},</span>
  <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;fullscreen&#39;</span><span class="p">,</span>         <span class="nx">query</span><span class="o">:</span> <span class="s1">&#39;div.DV-fullscreen&#39;</span> <span class="p">},</span>
<span class="p">];</span>
<span class="nx">DV</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">Annotations</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">viewer</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">LEFT_MARGIN</span>              <span class="o">=</span> <span class="mi">25</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">PAGE_NOTE_FUDGE</span>          <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">dc</span> <span class="o">&amp;&amp;</span> <span class="nx">dc</span><span class="p">.</span><span class="nx">account</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">dc</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">isOwner</span> <span class="o">||</span> <span class="nx">dc</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">isReviewer</span><span class="p">)</span> <span class="o">?</span> <span class="mi">46</span> <span class="o">:</span> <span class="mi">26</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span>                   <span class="o">=</span> <span class="nx">viewer</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">offsetsAdjustments</span>       <span class="o">=</span> <span class="p">[];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">offsetAdjustmentSum</span>      <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">saveCallbacks</span>            <span class="o">=</span> <span class="p">[];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">deleteCallbacks</span>          <span class="o">=</span> <span class="p">[];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">byId</span>                     <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">annotationsById</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">byPage</span>                   <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">annotationsByPage</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">bySortOrder</span>              <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sortAnnotations</span><span class="p">();</span>
<span class="p">};</span>

<span class="nx">DV</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">Annotations</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-93'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-93">&#182;</a>
        </div>
        <p>Render an annotation model to HTML, calculating all of the dimenstions
and offsets, and running a template function.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">annotation</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">documentModel</span>             <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">pageModel</span>                 <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">pages</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">zoom</span>                      <span class="o">=</span> <span class="nx">pageModel</span><span class="p">.</span><span class="nx">zoomFactor</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">adata</span>                     <span class="o">=</span> <span class="nx">annotation</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">x1</span><span class="p">,</span> <span class="nx">x2</span><span class="p">,</span> <span class="nx">y1</span><span class="p">,</span> <span class="nx">y2</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">adata</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;page&#39;</span><span class="p">){</span>
      <span class="nx">x1</span> <span class="o">=</span> <span class="nx">x2</span> <span class="o">=</span> <span class="nx">y1</span> <span class="o">=</span> <span class="nx">y2</span>           <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="nx">adata</span><span class="p">.</span><span class="nx">top</span>                   <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="nx">y1</span>                          <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">adata</span><span class="p">.</span><span class="nx">y1</span> <span class="o">*</span> <span class="nx">zoom</span><span class="p">);</span>
      <span class="nx">y2</span>                          <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">adata</span><span class="p">.</span><span class="nx">y2</span> <span class="o">*</span> <span class="nx">zoom</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">x1</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">LEFT_MARGIN</span><span class="p">)</span> <span class="nx">x1</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">LEFT_MARGIN</span><span class="p">;</span>
      <span class="nx">x1</span>                          <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">adata</span><span class="p">.</span><span class="nx">x1</span> <span class="o">*</span> <span class="nx">zoom</span><span class="p">);</span>
      <span class="nx">x2</span>                          <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">adata</span><span class="p">.</span><span class="nx">x2</span> <span class="o">*</span> <span class="nx">zoom</span><span class="p">);</span>
      <span class="nx">adata</span><span class="p">.</span><span class="nx">top</span>                   <span class="o">=</span> <span class="nx">y1</span> <span class="o">-</span> <span class="mi">5</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">adata</span><span class="p">.</span><span class="nx">owns_note</span>               <span class="o">=</span> <span class="nx">adata</span><span class="p">.</span><span class="nx">owns_note</span> <span class="o">||</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">adata</span><span class="p">.</span><span class="nx">width</span>                   <span class="o">=</span> <span class="nx">pageModel</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
    <span class="nx">adata</span><span class="p">.</span><span class="nx">pageNumber</span>              <span class="o">=</span> <span class="nx">adata</span><span class="p">.</span><span class="nx">page</span><span class="p">;</span>
    <span class="nx">adata</span><span class="p">.</span><span class="nx">author</span>                  <span class="o">=</span> <span class="nx">adata</span><span class="p">.</span><span class="nx">author</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
    <span class="nx">adata</span><span class="p">.</span><span class="nx">author_organization</span>     <span class="o">=</span> <span class="nx">adata</span><span class="p">.</span><span class="nx">author_organization</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
    <span class="nx">adata</span><span class="p">.</span><span class="nx">bgWidth</span>                 <span class="o">=</span> <span class="nx">adata</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
    <span class="nx">adata</span><span class="p">.</span><span class="nx">bWidth</span>                  <span class="o">=</span> <span class="nx">adata</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="mi">16</span><span class="p">;</span>
    <span class="nx">adata</span><span class="p">.</span><span class="nx">excerptWidth</span>            <span class="o">=</span> <span class="p">(</span><span class="nx">x2</span> <span class="o">-</span> <span class="nx">x1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">8</span><span class="p">;</span>
    <span class="nx">adata</span><span class="p">.</span><span class="nx">excerptMarginLeft</span>       <span class="o">=</span> <span class="nx">x1</span> <span class="o">-</span> <span class="mi">3</span><span class="p">;</span>
    <span class="nx">adata</span><span class="p">.</span><span class="nx">excerptHeight</span>           <span class="o">=</span> <span class="nx">y2</span> <span class="o">-</span> <span class="nx">y1</span><span class="p">;</span>
    <span class="nx">adata</span><span class="p">.</span><span class="nx">index</span>                   <span class="o">=</span> <span class="nx">adata</span><span class="p">.</span><span class="nx">page</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nx">adata</span><span class="p">.</span><span class="nx">image</span>                   <span class="o">=</span> <span class="nx">pageModel</span><span class="p">.</span><span class="nx">imageURL</span><span class="p">(</span><span class="nx">adata</span><span class="p">.</span><span class="nx">index</span><span class="p">);</span>
    <span class="nx">adata</span><span class="p">.</span><span class="nx">imageTop</span>                <span class="o">=</span> <span class="nx">y1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nx">adata</span><span class="p">.</span><span class="nx">tabTop</span>                  <span class="o">=</span> <span class="p">(</span><span class="nx">y1</span> <span class="o">&lt;</span> <span class="mi">35</span> <span class="o">?</span> <span class="mi">35</span> <span class="o">-</span> <span class="nx">y1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">8</span><span class="p">;</span>
    <span class="nx">adata</span><span class="p">.</span><span class="nx">imageWidth</span>              <span class="o">=</span> <span class="nx">pageModel</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
    <span class="nx">adata</span><span class="p">.</span><span class="nx">imageHeight</span>             <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">pageModel</span><span class="p">.</span><span class="nx">height</span> <span class="o">*</span> <span class="nx">zoom</span><span class="p">);</span>
    <span class="nx">adata</span><span class="p">.</span><span class="nx">regionLeft</span>              <span class="o">=</span> <span class="nx">x1</span><span class="p">;</span>
    <span class="nx">adata</span><span class="p">.</span><span class="nx">regionWidth</span>             <span class="o">=</span> <span class="nx">x2</span> <span class="o">-</span> <span class="nx">x1</span> <span class="p">;</span>
    <span class="nx">adata</span><span class="p">.</span><span class="nx">regionHeight</span>            <span class="o">=</span> <span class="nx">y2</span> <span class="o">-</span> <span class="nx">y1</span><span class="p">;</span>
    <span class="nx">adata</span><span class="p">.</span><span class="nx">excerptDSHeight</span>         <span class="o">=</span> <span class="nx">adata</span><span class="p">.</span><span class="nx">excerptHeight</span> <span class="o">-</span> <span class="mi">6</span><span class="p">;</span>
    <span class="nx">adata</span><span class="p">.</span><span class="nx">DSOffset</span>                <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">adata</span><span class="p">.</span><span class="nx">access</span> <span class="o">==</span> <span class="s1">&#39;public&#39;</span><span class="p">)</span>         <span class="nx">adata</span><span class="p">.</span><span class="nx">accessClass</span> <span class="o">=</span> <span class="s1">&#39;DV-accessPublic&#39;</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">adata</span><span class="p">.</span><span class="nx">access</span> <span class="o">==</span><span class="s1">&#39;exclusive&#39;</span><span class="p">)</span>  <span class="nx">adata</span><span class="p">.</span><span class="nx">accessClass</span> <span class="o">=</span> <span class="s1">&#39;DV-accessExclusive&#39;</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">adata</span><span class="p">.</span><span class="nx">access</span> <span class="o">==</span><span class="s1">&#39;private&#39;</span><span class="p">)</span>    <span class="nx">adata</span><span class="p">.</span><span class="nx">accessClass</span> <span class="o">=</span> <span class="s1">&#39;DV-accessPrivate&#39;</span><span class="p">;</span>

    <span class="nx">adata</span><span class="p">.</span><span class="nx">orderClass</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="nx">adata</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">options</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">adata</span><span class="p">.</span><span class="nx">position</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="nx">adata</span><span class="p">.</span><span class="nx">orderClass</span> <span class="o">+=</span> <span class="s1">&#39; DV-firstAnnotation&#39;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">adata</span><span class="p">.</span><span class="nx">position</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">bySortOrder</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="nx">adata</span><span class="p">.</span><span class="nx">orderClass</span> <span class="o">+=</span> <span class="s1">&#39; DV-lastAnnotation&#39;</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">template</span> <span class="o">=</span> <span class="p">(</span><span class="nx">adata</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;page&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;pageAnnotation&#39;</span> <span class="o">:</span> <span class="s1">&#39;annotation&#39;</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">JST</span><span class="p">[</span><span class="nx">template</span><span class="p">](</span><span class="nx">adata</span><span class="p">);</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-94'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-94">&#182;</a>
        </div>
        <p>Re-sort the list of annotations when its contents change. Annotations
are ordered by page primarily, and then their y position on the page.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">sortAnnotations</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">bySortOrder</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">sortBy</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">values</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">byId</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">anno</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">page</span> <span class="o">*</span> <span class="mi">10000</span> <span class="o">+</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">y1</span><span class="p">;</span>
    <span class="p">});</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-95'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-95">&#182;</a>
        </div>
        <p>Renders each annotation into it&rsquo;s HTML format.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">renderAnnotations</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">showAnnotations</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
            
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="k">this</span><span class="p">.</span><span class="nx">bySortOrder</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">anno</span>      <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">bySortOrder</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="nx">anno</span><span class="p">.</span><span class="nx">of</span>       <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">byPage</span><span class="p">[</span><span class="nx">anno</span><span class="p">.</span><span class="nx">page</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="nx">anno</span><span class="p">);</span>
      <span class="nx">anno</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="nx">anno</span><span class="p">.</span><span class="nx">html</span>     <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">anno</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">renderAnnotationsByIndex</span><span class="p">();</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-96'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-96">&#182;</a>
        </div>
        <p>Renders each annotation for the &ldquo;Annotation List&rdquo; tab, in order.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">renderAnnotationsByIndex</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">rendered</span>  <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bySortOrder</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">anno</span><span class="p">){</span> <span class="k">return</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">html</span><span class="p">;</span> <span class="p">});</span>
    <span class="kd">var</span> <span class="nx">html</span>      <span class="o">=</span> <span class="nx">rendered</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/class=&quot;DV-img&quot; src=&quot;/g</span><span class="p">,</span> <span class="s1">&#39;class=&quot;DV-img&quot; data-src=&quot;&#39;</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/id=&quot;DV-annotation-(\d+)&quot;/g</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s1">&#39;id=&quot;DV-listAnnotation-&#39;</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39;&quot; rel=&quot;aid-&#39;</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">;</span>
    <span class="p">});</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;div.DV-allAnnotations&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">html</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">renderAnnotationsByIndex</span><span class="p">.</span><span class="nx">rendered</span>  <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">renderAnnotationsByIndex</span><span class="p">.</span><span class="nx">zoomLevel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">zoomLevel</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-97'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-97">&#182;</a>
        </div>
        <p>TODO: This is hacky, but seems to be necessary. When fixing, be sure to
test with both autozoom and page notes.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">updateAnnotationOffsets</span><span class="p">();</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">defer</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">updateAnnotationOffsets</span><span class="p">,</span> <span class="k">this</span><span class="p">));</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-98'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-98">&#182;</a>
        </div>
        <p>Refresh the annotation&rsquo;s title and content from the model, in both
The document and list views.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">refreshAnnotation</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">anno</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">viewer</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">;</span>
    <span class="nx">anno</span><span class="p">.</span><span class="nx">html</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">anno</span><span class="p">);</span>
    <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#DV-annotation-&#39;</span> <span class="o">+</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">replaceWith</span><span class="p">(</span><span class="nx">anno</span><span class="p">.</span><span class="nx">html</span><span class="p">);</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-99'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-99">&#182;</a>
        </div>
        <p>Removes a given annotation from the Annotations model (and DOM).</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">removeAnnotation</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">anno</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">byId</span><span class="p">[</span><span class="nx">anno</span><span class="p">.</span><span class="nx">id</span><span class="p">];</span>
    <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">page</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">byPage</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">without</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">byPage</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">anno</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">sortAnnotations</span><span class="p">();</span>
    <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#DV-annotation-&#39;</span> <span class="o">+</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39;, #DV-listAnnotation-&#39;</span> <span class="o">+</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">api</span><span class="p">.</span><span class="nx">redraw</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">byId</span><span class="p">))</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;ViewDocument&#39;</span><span class="p">);</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-100'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-100">&#182;</a>
        </div>
        <p>Offsets all document pages based on interleaved page annotations.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">updateAnnotationOffsets</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">offsetsAdjustments</span>   <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">offsetAdjustmentSum</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">documentModel</span>         <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">annotationsContainer</span>  <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;div.DV-allAnnotations&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">pageAnnotationEls</span>     <span class="o">=</span> <span class="nx">annotationsContainer</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.DV-pageNote&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">pageNoteHeights</span>       <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">pages</span><span class="p">.</span><span class="nx">pageNoteHeights</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">me</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;div.DV-docViewer&#39;</span><span class="p">).</span><span class="nx">hasClass</span><span class="p">(</span><span class="s1">&#39;DV-viewAnnotations&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">false</span><span class="p">){</span>
      <span class="nx">annotationsContainer</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;DV-getHeights&#39;</span><span class="p">);</span>
    <span class="p">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-101'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-101">&#182;</a>
        </div>
        <p>First, collect the list of page annotations, and associate them with
their DOM elements.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="kd">var</span> <span class="nx">pageAnnos</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bySortOrder</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">anno</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s1">&#39;page&#39;</span><span class="p">;</span>
    <span class="p">}),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">anno</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">anno</span><span class="p">.</span><span class="nx">el</span> <span class="o">=</span> <span class="nx">pageAnnotationEls</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="nx">pageAnnos</span><span class="p">[</span><span class="nx">anno</span><span class="p">.</span><span class="nx">pageNumber</span><span class="p">]</span> <span class="o">=</span> <span class="nx">anno</span><span class="p">;</span>
    <span class="p">});</span></pre></div>
      </td>
    </tr>
    <tr id='section-102'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-102">&#182;</a>
        </div>
        <p>Then, loop through the pages and store the cumulative offset due to
page annotations.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">documentModel</span><span class="p">.</span><span class="nx">totalPages</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">pageNoteHeights</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pageAnnos</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">height</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="nx">pageAnnos</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">el</span><span class="p">).</span><span class="nx">height</span><span class="p">()</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">PAGE_NOTE_FUDGE</span><span class="p">);</span>
        <span class="nx">pageNoteHeights</span><span class="p">[</span><span class="nx">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">height</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">offsetAdjustmentSum</span> <span class="o">+=</span> <span class="nx">height</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">offsetsAdjustments</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">offsetAdjustmentSum</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">annotationsContainer</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;DV-getHeights&#39;</span><span class="p">);</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-103'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-103">&#182;</a>
        </div>
        <p>When an annotation is successfully saved, fire any registered
save callbacks.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">fireSaveCallbacks</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">anno</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">saveCallbacks</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">){</span> <span class="nx">c</span><span class="p">(</span><span class="nx">anno</span><span class="p">);</span> <span class="p">});</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-104'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-104">&#182;</a>
        </div>
        <p>When an annotation is successfully removed, fire any registered
delete callbacks.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">fireDeleteCallbacks</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">anno</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">deleteCallbacks</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">){</span> <span class="nx">c</span><span class="p">(</span><span class="nx">anno</span><span class="p">);</span> <span class="p">});</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-105'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-105">&#182;</a>
        </div>
        <p>Returns the list of annotations on a given page.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">getAnnotations</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">_index</span><span class="p">){</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">byPage</span><span class="p">[</span><span class="nx">_index</span><span class="p">];</span>
  <span class="p">},</span>

  <span class="nx">getFirstAnnotation</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">first</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bySortOrder</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">getNextAnnotation</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">currentId</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">anno</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">byId</span><span class="p">[</span><span class="nx">currentId</span><span class="p">];</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">bySortOrder</span><span class="p">[</span><span class="nx">_</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bySortOrder</span><span class="p">,</span> <span class="nx">anno</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
  <span class="p">},</span>

  <span class="nx">getPreviousAnnotation</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">currentId</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">anno</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">byId</span><span class="p">[</span><span class="nx">currentId</span><span class="p">];</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">bySortOrder</span><span class="p">[</span><span class="nx">_</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bySortOrder</span><span class="p">,</span> <span class="nx">anno</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-106'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-106">&#182;</a>
        </div>
        <p>Get an annotation by id, with backwards compatibility for argument hashes.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">getAnnotation</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">identifier</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">identifier</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">byId</span><span class="p">[</span><span class="nx">identifier</span><span class="p">.</span><span class="nx">id</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">identifier</span><span class="p">.</span><span class="nx">index</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">identifier</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;looked up an annotation without an id&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">byId</span><span class="p">[</span><span class="nx">identifier</span><span class="p">];</span>
  <span class="p">}</span>

<span class="p">};</span>

<span class="nx">DV</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">Chapters</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">viewer</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span> <span class="o">=</span> <span class="nx">viewer</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">loadChapters</span><span class="p">();</span>
<span class="p">};</span>

<span class="nx">DV</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">Chapters</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-107'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-107">&#182;</a>
        </div>
        <p>Load (or reload) the chapter model from the schema&rsquo;s defined sections.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">loadChapters</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">sections</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">sections</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">chapters</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">chapters</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">chapters</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">sections</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">sec</span><span class="p">){</span> <span class="nx">sec</span><span class="p">.</span><span class="nx">id</span> <span class="o">||</span> <span class="p">(</span><span class="nx">sec</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">());</span> <span class="p">});</span>

    <span class="kd">var</span> <span class="nx">sectionIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">totalPages</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">section</span> <span class="o">=</span> <span class="nx">sections</span><span class="p">[</span><span class="nx">sectionIndex</span><span class="p">];</span>
      <span class="kd">var</span> <span class="nx">nextSection</span> <span class="o">=</span> <span class="nx">sections</span><span class="p">[</span><span class="nx">sectionIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">nextSection</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="nx">nextSection</span><span class="p">.</span><span class="nx">page</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span> <span class="p">{</span>
        <span class="nx">sectionIndex</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="nx">section</span> <span class="o">=</span> <span class="nx">nextSection</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">section</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="nx">section</span><span class="p">.</span><span class="nx">page</span> <span class="o">&gt;</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="nx">chapters</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">section</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">},</span>

  <span class="nx">getChapterId</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">){</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">chapters</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
  <span class="p">},</span>

  <span class="nx">getChapterPosition</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">chapterId</span><span class="p">){</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="nx">len</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">chapters</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
      <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">chapters</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="nx">chapterId</span><span class="p">){</span>
        <span class="k">return</span> <span class="nx">i</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">DV</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">Document</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">viewer</span><span class="p">){</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span>                    <span class="o">=</span> <span class="nx">viewer</span><span class="p">;</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">currentPageIndex</span>          <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">offsets</span>                   <span class="o">=</span> <span class="p">[];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">baseHeightsPortion</span>        <span class="o">=</span> <span class="p">[];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">baseHeightsPortionOffsets</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">paddedOffsets</span>             <span class="o">=</span> <span class="p">[];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">originalPageText</span>          <span class="o">=</span> <span class="p">{};</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">totalDocumentHeight</span>       <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">totalPages</span>                <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">additionalPaddingOnPage</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">ZOOM_RANGES</span>               <span class="o">=</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">900</span><span class="p">,</span> <span class="mi">1000</span><span class="p">];</span>

  <span class="kd">var</span> <span class="nx">data</span>                       <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">state</span>                     <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">state</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">baseImageURL</span>              <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">baseImageURL</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">canonicalURL</span>              <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">canonicalURL</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">additionalPaddingOnPage</span>   <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">additionalPaddingOnPage</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">pageWidthPadding</span>          <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">pageWidthPadding</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">totalPages</span>                <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">totalPages</span><span class="p">;</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">onPageChangeCallbacks</span> <span class="o">=</span> <span class="p">[];</span>

  <span class="kd">var</span> <span class="nx">zoom</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">zoomLevel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">zoom</span> <span class="o">||</span> <span class="nx">data</span><span class="p">.</span><span class="nx">zoomLevel</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">zoom</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">zoomLevel</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">zoomLevel</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-108'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-108">&#182;</a>
        </div>
        <p>The zoom level cannot go over the maximum image width.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="kd">var</span> <span class="nx">maxZoom</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">last</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ZOOM_RANGES</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">zoomLevel</span> <span class="o">&gt;</span> <span class="nx">maxZoom</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">zoomLevel</span> <span class="o">=</span> <span class="nx">maxZoom</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">DV</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">Document</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>

  <span class="nx">setPageIndex</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">currentPageIndex</span> <span class="o">=</span> <span class="nx">index</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">currentPage</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">currentPage</span><span class="p">());</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">setActiveChapter</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">chapters</span><span class="p">.</span><span class="nx">getChapterId</span><span class="p">(</span><span class="nx">index</span><span class="p">));</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">onPageChangeCallbacks</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span> <span class="nx">c</span><span class="p">();</span> <span class="p">});</span>
    <span class="k">return</span> <span class="nx">index</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">currentPage</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentPageIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">currentIndex</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentPageIndex</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">nextPage</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">nextIndex</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentIndex</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">nextIndex</span> <span class="o">&gt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">totalPages</span><span class="p">)</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentIndex</span><span class="p">();</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">setPageIndex</span><span class="p">(</span><span class="nx">nextIndex</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">previousPage</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">previousIndex</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentIndex</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">previousIndex</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentIndex</span><span class="p">();</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">setPageIndex</span><span class="p">(</span><span class="nx">previousIndex</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">zoom</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">zoomLevel</span><span class="p">,</span><span class="nx">force</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">zoomLevel</span> <span class="o">!=</span> <span class="nx">zoomLevel</span> <span class="o">||</span> <span class="nx">force</span> <span class="o">===</span> <span class="kc">true</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">zoomLevel</span>   <span class="o">=</span> <span class="nx">zoomLevel</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">pages</span><span class="p">.</span><span class="nx">resize</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">zoomLevel</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">renderAnnotations</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">computeOffsets</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">},</span>

  <span class="nx">computeOffsets</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">annotationModel</span>  <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">annotations</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">totalDocHeight</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">adjustedOffset</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">len</span>              <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">totalPages</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">diff</span>             <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">scrollPos</span>        <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nb">window</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">scrollTop</span><span class="p">;</span>

    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">annotationModel</span><span class="p">.</span><span class="nx">offsetsAdjustments</span><span class="p">[</span><span class="nx">i</span><span class="p">]){</span>
        <span class="nx">adjustedOffset</span>   <span class="o">=</span> <span class="nx">annotationModel</span><span class="p">.</span><span class="nx">offsetsAdjustments</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="p">}</span>

      <span class="kd">var</span> <span class="nx">pageHeight</span>     <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">pages</span><span class="p">.</span><span class="nx">getPageHeight</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">previousOffset</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">offsets</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">h</span>              <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">offsets</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">adjustedOffset</span> <span class="o">+</span> <span class="nx">totalDocHeight</span><span class="p">;</span>

      <span class="k">if</span><span class="p">((</span><span class="nx">previousOffset</span> <span class="o">!==</span> <span class="nx">h</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">h</span> <span class="o">&lt;</span> <span class="nx">scrollPos</span><span class="p">))</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">delta</span> <span class="o">=</span> <span class="nx">h</span> <span class="o">-</span> <span class="nx">previousOffset</span> <span class="o">-</span> <span class="nx">diff</span><span class="p">;</span>
        <span class="nx">scrollPos</span> <span class="o">+=</span> <span class="nx">delta</span><span class="p">;</span>
        <span class="nx">diff</span> <span class="o">+=</span> <span class="nx">delta</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">baseHeightsPortion</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>        <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">((</span><span class="nx">pageHeight</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">additionalPaddingOnPage</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">baseHeightsPortionOffsets</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="nx">h</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">baseHeightsPortion</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

      <span class="nx">totalDocHeight</span>                    <span class="o">+=</span> <span class="p">(</span><span class="nx">pageHeight</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">additionalPaddingOnPage</span><span class="p">);</span>
    <span class="p">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-109'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-109">&#182;</a>
        </div>
        <p>Add the sum of the page note heights to the total document height.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="nx">totalDocHeight</span> <span class="o">+=</span> <span class="nx">adjustedOffset</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-110'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-110">&#182;</a>
        </div>
        <p>artificially set the scrollbar height</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">if</span><span class="p">(</span><span class="nx">totalDocHeight</span> <span class="o">!=</span> <span class="k">this</span><span class="p">.</span><span class="nx">totalDocumentHeight</span><span class="p">){</span>
      <span class="nx">diff</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">totalDocumentHeight</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="nx">diff</span> <span class="o">:</span> <span class="nx">totalDocHeight</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">totalDocumentHeight</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">setDocHeight</span><span class="p">(</span><span class="nx">totalDocHeight</span><span class="p">,</span><span class="nx">diff</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">totalDocumentHeight</span> <span class="o">=</span> <span class="nx">totalDocHeight</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">},</span>

  <span class="nx">getOffset</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">_index</span><span class="p">){</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">offsets</span><span class="p">[</span><span class="nx">_index</span><span class="p">];</span>
  <span class="p">},</span>

  <span class="nx">resetRemovedPages</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">removedPages</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="p">},</span>

  <span class="nx">addPageToRemovedPages</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">page</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">removedPages</span><span class="p">[</span><span class="nx">page</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">removePageFromRemovedPages</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">page</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">removedPages</span><span class="p">[</span><span class="nx">page</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">redrawPages</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">pageSet</span><span class="p">.</span><span class="nx">pages</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">page</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">page</span><span class="p">.</span><span class="nx">drawRemoveOverlay</span><span class="p">();</span>
    <span class="p">});</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">thumbnails</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">thumbnails</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">},</span>

  <span class="nx">redrawReorderedPages</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">thumbnails</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">thumbnails</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>

<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-111'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-111">&#182;</a>
        </div>
        <p>The Pages model represents the set of pages in the document, containing the
image sources for each page, and the page proportions.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">Pages</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">viewer</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span>     <span class="o">=</span> <span class="nx">viewer</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-112'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-112">&#182;</a>
        </div>
        <p>Rolling average page height.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">averageHeight</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-113'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-113">&#182;</a>
        </div>
        <p>Real page heights.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">pageHeights</span>     <span class="o">=</span> <span class="p">[];</span></pre></div>
      </td>
    </tr>
    <tr id='section-114'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-114">&#182;</a>
        </div>
        <p>Real page note heights.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">pageNoteHeights</span> <span class="o">=</span> <span class="p">[];</span></pre></div>
      </td>
    </tr>
    <tr id='section-115'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-115">&#182;</a>
        </div>
        <p>In pixels.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">BASE_WIDTH</span>      <span class="o">=</span> <span class="mi">700</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">BASE_HEIGHT</span>     <span class="o">=</span> <span class="mi">906</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-116'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-116">&#182;</a>
        </div>
        <p>Factors for scaling from image size to zoomlevel.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">SCALE_FACTORS</span>   <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;500&#39;</span><span class="o">:</span> <span class="mf">0.714</span><span class="p">,</span> <span class="s1">&#39;700&#39;</span><span class="o">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;800&#39;</span><span class="o">:</span> <span class="mf">0.8</span><span class="p">,</span> <span class="s1">&#39;900&#39;</span><span class="o">:</span> <span class="mf">0.9</span><span class="p">,</span> <span class="s1">&#39;1000&#39;</span><span class="o">:</span> <span class="mf">1.0</span><span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-117'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-117">&#182;</a>
        </div>
        <p>For viewing page text.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">DEFAULT_PADDING</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-118'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-118">&#182;</a>
        </div>
        <p>Embed reduces padding.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">REDUCED_PADDING</span> <span class="o">=</span> <span class="mi">44</span><span class="p">;</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">zoomLevel</span>  <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">zoomLevel</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">baseWidth</span>  <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">BASE_WIDTH</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">baseHeight</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">BASE_HEIGHT</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">width</span>      <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">zoomLevel</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">height</span>     <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">baseHeight</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">zoomFactor</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">numPagesLoaded</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">DV</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">Pages</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-119'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-119">&#182;</a>
        </div>
        <p>Get the complete image URL for a particular page.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">imageURL</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">url</span>  <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">image</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">size</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">zoomLevel</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">BASE_WIDTH</span> <span class="o">?</span> <span class="s1">&#39;large&#39;</span> <span class="o">:</span> <span class="s1">&#39;normal&#39;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">pageNumber</span> <span class="o">=</span> <span class="nx">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">zeropad</span><span class="p">)</span> <span class="nx">pageNumber</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">zeroPad</span><span class="p">(</span><span class="nx">pageNumber</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
    <span class="nx">url</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\{size\}/</span><span class="p">,</span> <span class="nx">size</span><span class="p">);</span>
    <span class="nx">url</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\{page\}/</span><span class="p">,</span> <span class="nx">pageNumber</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">url</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">zeroPad</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">num</span><span class="p">,</span> <span class="nx">count</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">string</span> <span class="o">=</span> <span class="nx">num</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
    <span class="k">while</span> <span class="p">(</span><span class="nx">string</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="nx">count</span><span class="p">)</span> <span class="nx">string</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="nx">string</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">string</span><span class="p">;</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-120'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-120">&#182;</a>
        </div>
        <p>The zoom factor is the ratio of the image width to the baseline width.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">zoomFactor</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">zoomLevel</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">BASE_WIDTH</span><span class="p">;</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-121'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-121">&#182;</a>
        </div>
        <p>Resize or zoom the pages width and height.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">resize</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">zoomLevel</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">padding</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">pages</span><span class="p">.</span><span class="nx">DEFAULT_PADDING</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">zoomLevel</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">zoomLevel</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">zoomLevel</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">previousFactor</span>  <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">zoomFactor</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">zoomLevel</span>      <span class="o">=</span> <span class="nx">zoomLevel</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">zoomLevel</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">scale</span>           <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">zoomFactor</span><span class="p">()</span> <span class="o">/</span> <span class="nx">previousFactor</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">width</span>          <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">baseWidth</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">zoomFactor</span><span class="p">());</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">height</span>         <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">*</span> <span class="nx">scale</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">averageHeight</span>  <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">averageHeight</span> <span class="o">*</span> <span class="nx">scale</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">sets</span><span class="p">.</span><span class="nx">width</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">zoomLevel</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span><span class="nx">width</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">+</span> <span class="nx">padding</span> <span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-textContents&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span><span class="s1">&#39;font-size&#39;</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">zoomLevel</span> <span class="o">*</span> <span class="mf">0.02</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="p">});</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-122'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-122">&#182;</a>
        </div>
        <p>Update the height for a page, when its real image has loaded.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">updateHeight</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">image</span><span class="p">,</span> <span class="nx">pageIndex</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">h</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getPageHeight</span><span class="p">(</span><span class="nx">pageIndex</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">height</span> <span class="o">=</span> <span class="nx">image</span><span class="p">.</span><span class="nx">height</span> <span class="o">*</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">zoomLevel</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">BASE_WIDTH</span> <span class="o">?</span> <span class="mf">0.7</span> <span class="o">:</span> <span class="mf">1.0</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">image</span><span class="p">.</span><span class="nx">width</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">baseWidth</span><span class="p">)</span> <span class="p">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-123'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-123">&#182;</a>
        </div>
        <p>Not supposed to happen, but too-small images sometimes do.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="nx">height</span> <span class="o">*=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">baseWidth</span> <span class="o">/</span> <span class="nx">image</span><span class="p">.</span><span class="nx">width</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setPageHeight</span><span class="p">(</span><span class="nx">pageIndex</span><span class="p">,</span> <span class="nx">height</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">averageHeight</span> <span class="o">=</span> <span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">averageHeight</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">numPagesLoaded</span><span class="p">)</span> <span class="o">+</span> <span class="nx">height</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">numPagesLoaded</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">numPagesLoaded</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">h</span> <span class="o">===</span> <span class="nx">height</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">computeOffsets</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">pageSet</span><span class="p">.</span><span class="nx">simpleReflowPages</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotation</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">pageIndex</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">currentIndex</span><span class="p">()))</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">diff</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">height</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">zoomFactor</span><span class="p">()</span> <span class="o">-</span> <span class="nx">h</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nb">window</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">scrollTop</span> <span class="o">+=</span> <span class="nx">diff</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-124'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-124">&#182;</a>
        </div>
        <p>set the real page height</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">setPageHeight</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pageIndex</span><span class="p">,</span> <span class="nx">pageHeight</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">pageHeights</span><span class="p">[</span><span class="nx">pageIndex</span><span class="p">]</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">pageHeight</span><span class="p">);</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-125'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-125">&#182;</a>
        </div>
        <p>get the real page height</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">getPageHeight</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pageIndex</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">realHeight</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">pageHeights</span><span class="p">[</span><span class="nx">pageIndex</span><span class="p">];</span>
    <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">realHeight</span> <span class="o">?</span> <span class="nx">realHeight</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">zoomFactor</span><span class="p">()</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
  <span class="p">}</span>

<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-126'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-126">&#182;</a>
        </div>
        <p>This manages events for different states activated through DV interface actions like clicks, mouseovers, etc.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">Schema</span><span class="p">.</span><span class="nx">events</span> <span class="o">=</span> <span class="p">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-127'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-127">&#182;</a>
        </div>
        <p>Change zoom level and causes a reflow and redraw of pages.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">zoom</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">level</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">viewer</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">continuation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">viewer</span><span class="p">.</span><span class="nx">pageSet</span><span class="p">.</span><span class="nx">zoom</span><span class="p">({</span> <span class="nx">zoomLevel</span><span class="o">:</span> <span class="nx">level</span> <span class="p">});</span>
      <span class="kd">var</span> <span class="nx">ranges</span> <span class="o">=</span> <span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">ZOOM_RANGES</span><span class="p">;</span>
      <span class="nx">viewer</span><span class="p">.</span><span class="nx">dragReporter</span><span class="p">.</span><span class="nx">sensitivity</span> <span class="o">=</span> <span class="nx">ranges</span><span class="p">[</span><span class="nx">ranges</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nx">level</span> <span class="o">?</span> <span class="mf">1.5</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
      <span class="nx">viewer</span><span class="p">.</span><span class="nx">notifyChangedState</span><span class="p">();</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">viewer</span><span class="p">.</span><span class="nx">confirmStateChange</span> <span class="o">?</span> <span class="nx">viewer</span><span class="p">.</span><span class="nx">confirmStateChange</span><span class="p">(</span><span class="nx">continuation</span><span class="p">)</span> <span class="o">:</span> <span class="nx">continuation</span><span class="p">();</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-128'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-128">&#182;</a>
        </div>
        <p>Draw (or redraw) the visible pages on the screen.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">drawPages</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">state</span> <span class="o">!=</span> <span class="s1">&#39;ViewDocument&#39;</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">doc</span>           <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">win</span>           <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nb">window</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="kd">var</span> <span class="nx">offsets</span>       <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">baseHeightsPortionOffsets</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">scrollPos</span>     <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">scrollPosition</span> <span class="o">=</span> <span class="nx">win</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">midpoint</span>      <span class="o">=</span> <span class="nx">scrollPos</span> <span class="o">+</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="nx">win</span><span class="p">).</span><span class="nx">height</span><span class="p">()</span> <span class="o">/</span> <span class="mi">3</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">currentPage</span>   <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">sortedIndex</span><span class="p">(</span><span class="nx">offsets</span><span class="p">,</span> <span class="nx">scrollPos</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">middlePage</span>    <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">sortedIndex</span><span class="p">(</span><span class="nx">offsets</span><span class="p">,</span> <span class="nx">midpoint</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">offsets</span><span class="p">[</span><span class="nx">currentPage</span><span class="p">]</span> <span class="o">==</span> <span class="nx">scrollPos</span><span class="p">)</span> <span class="nx">currentPage</span><span class="o">++</span> <span class="o">&amp;&amp;</span> <span class="nx">middlePage</span><span class="o">++</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">pageIds</span>       <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">sortPages</span><span class="p">(</span><span class="nx">middlePage</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">total</span>         <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">totalPages</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">currentPage</span><span class="p">()</span> <span class="o">!=</span> <span class="nx">currentPage</span><span class="p">)</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">setPageIndex</span><span class="p">(</span><span class="nx">currentPage</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">drawPageAt</span><span class="p">(</span><span class="nx">pageIds</span><span class="p">,</span> <span class="nx">middlePage</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-129'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-129">&#182;</a>
        </div>
        <p>Draw the page at the given index.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">drawPageAt</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pageIds</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">first</span> <span class="o">=</span> <span class="nx">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">last</span>  <span class="o">=</span> <span class="nx">index</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">totalPages</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">first</span><span class="p">)</span> <span class="nx">index</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">pages</span> <span class="o">=</span> <span class="p">[</span>
      <span class="p">{</span> <span class="nx">label</span><span class="o">:</span> <span class="nx">pageIds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">index</span><span class="o">:</span> <span class="nx">index</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">},</span>
      <span class="p">{</span> <span class="nx">label</span><span class="o">:</span> <span class="nx">pageIds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">index</span><span class="o">:</span> <span class="nx">index</span> <span class="p">},</span>
      <span class="p">{</span> <span class="nx">label</span><span class="o">:</span> <span class="nx">pageIds</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nx">index</span><span class="o">:</span> <span class="nx">index</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">}</span>
    <span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">last</span><span class="p">)</span> <span class="nx">pages</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
    <span class="nx">pages</span><span class="p">[</span><span class="nx">first</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="nx">pages</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="nx">currentPage</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">pageSet</span><span class="p">.</span><span class="nx">draw</span><span class="p">(</span><span class="nx">pages</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">check</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">viewer</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">busy</span> <span class="o">===</span> <span class="kc">false</span><span class="p">){</span>
      <span class="nx">viewer</span><span class="p">.</span><span class="nx">busy</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">observers</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">this</span><span class="p">[</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">observers</span><span class="p">[</span><span class="nx">i</span><span class="p">]].</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">viewer</span><span class="p">.</span><span class="nx">busy</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">},</span>

  <span class="nx">loadText</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pageIndex</span><span class="p">,</span><span class="nx">afterLoad</span><span class="p">){</span>

    <span class="nx">pageIndex</span> <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="nx">pageIndex</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">currentIndex</span><span class="p">()</span> <span class="o">:</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">pageIndex</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_previousTextIndex</span> <span class="o">=</span> <span class="nx">pageIndex</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">me</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">processText</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span>

      <span class="kd">var</span> <span class="nx">pageNumber</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">pageIndex</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
      <span class="nx">me</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-textContents&#39;</span><span class="p">).</span><span class="nx">replaceWith</span><span class="p">(</span><span class="s1">&#39;&lt;pre class=&quot;DV-textContents&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">text</span> <span class="o">+</span> <span class="s1">&#39;&lt;/pre&gt;&#39;</span><span class="p">);</span>
      <span class="nx">me</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">currentPage</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">pageNumber</span><span class="p">);</span>
      <span class="nx">me</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">textCurrentPage</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;p. &#39;</span><span class="o">+</span><span class="p">(</span><span class="nx">pageNumber</span><span class="p">));</span>
      <span class="nx">me</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">setPageIndex</span><span class="p">(</span><span class="nx">pageIndex</span><span class="p">);</span>
      <span class="nx">me</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">setActiveChapter</span><span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">chapters</span><span class="p">.</span><span class="nx">getChapterId</span><span class="p">(</span><span class="nx">pageIndex</span><span class="p">));</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">openEditor</span> <span class="o">==</span> <span class="s1">&#39;editText&#39;</span> <span class="o">&amp;&amp;</span>
          <span class="o">!</span><span class="p">(</span><span class="nx">pageNumber</span> <span class="k">in</span> <span class="nx">me</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">originalPageText</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">me</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">originalPageText</span><span class="p">[</span><span class="nx">pageNumber</span><span class="p">]</span> <span class="o">=</span> <span class="nx">text</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">openEditor</span> <span class="o">==</span> <span class="s1">&#39;editText&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">me</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-textContents&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;contentEditable&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;DV-editing&#39;</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">if</span><span class="p">(</span><span class="nx">afterLoad</span><span class="p">)</span> <span class="nx">afterLoad</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">helpers</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nx">text</span><span class="p">[</span><span class="nx">pageIndex</span><span class="p">])</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">processText</span><span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nx">text</span><span class="p">[</span><span class="nx">pageIndex</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">handleResponse</span> <span class="o">=</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">processText</span><span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nx">text</span><span class="p">[</span><span class="nx">pageIndex</span><span class="p">]</span> <span class="o">=</span> <span class="nx">response</span><span class="p">);</span>
    <span class="p">},</span> <span class="k">this</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-textContents&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">textURI</span> <span class="o">=</span> <span class="nx">me</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;{page}&#39;</span><span class="p">,</span> <span class="nx">pageIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">crossDomain</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">isCrossDomain</span><span class="p">(</span><span class="nx">textURI</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">crossDomain</span><span class="p">)</span> <span class="nx">textURI</span> <span class="o">+=</span> <span class="s1">&#39;?callback=?&#39;</span><span class="p">;</span>
    <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">[</span><span class="nx">crossDomain</span> <span class="o">?</span> <span class="s1">&#39;getJSON&#39;</span> <span class="o">:</span> <span class="s1">&#39;get&#39;</span><span class="p">](</span><span class="nx">textURI</span><span class="p">,</span> <span class="p">{},</span> <span class="nx">handleResponse</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">resetTracker</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotation</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">trackAnnotation</span><span class="p">.</span><span class="nx">combined</span>     <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">trackAnnotation</span><span class="p">.</span><span class="nx">h</span>            <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">trackAnnotation</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">viewer</span>          <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">helpers</span>         <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">scrollPosition</span>  <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nb">window</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">scrollTop</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotation</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">annotation</span>      <span class="o">=</span> <span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotation</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">trackAnnotation</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">trackAnnotation</span><span class="p">;</span>


      <span class="k">if</span><span class="p">(</span><span class="nx">trackAnnotation</span><span class="p">.</span><span class="nx">id</span> <span class="o">!=</span> <span class="nx">annotation</span><span class="p">.</span><span class="nx">id</span><span class="p">){</span>
        <span class="nx">trackAnnotation</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">annotation</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
        <span class="nx">helpers</span><span class="p">.</span><span class="nx">setActiveAnnotationLimits</span><span class="p">(</span><span class="nx">annotation</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotation</span><span class="p">.</span><span class="nx">annotationEl</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span><span class="s1">&#39;DV-editing&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
         <span class="p">(</span><span class="nx">scrollPosition</span> <span class="o">&gt;</span> <span class="p">(</span><span class="nx">trackAnnotation</span><span class="p">.</span><span class="nx">h</span><span class="p">)</span> <span class="o">||</span> <span class="nx">scrollPosition</span> <span class="o">&lt;</span> <span class="nx">trackAnnotation</span><span class="p">.</span><span class="nx">combined</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">annotation</span><span class="p">.</span><span class="nx">hide</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
        <span class="nx">viewer</span><span class="p">.</span><span class="nx">pageSet</span><span class="p">.</span><span class="nx">setActiveAnnotation</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
        <span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotation</span>   <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="nx">trackAnnotation</span><span class="p">.</span><span class="nx">h</span>         <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="nx">trackAnnotation</span><span class="p">.</span><span class="nx">id</span>        <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="nx">trackAnnotation</span><span class="p">.</span><span class="nx">combined</span>  <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="nx">viewer</span><span class="p">.</span><span class="nx">pageSet</span><span class="p">.</span><span class="nx">setActiveAnnotation</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
      <span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotation</span>   <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="nx">trackAnnotation</span><span class="p">.</span><span class="nx">h</span>         <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="nx">trackAnnotation</span><span class="p">.</span><span class="nx">id</span>        <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="nx">trackAnnotation</span><span class="p">.</span><span class="nx">combined</span>  <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="nx">helpers</span><span class="p">.</span><span class="nx">removeObserver</span><span class="p">(</span><span class="s1">&#39;trackAnnotation&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="nx">DV</span><span class="p">.</span><span class="nx">Schema</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">ViewAnnotation</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">next</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">viewer</span>              <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">activeAnnotationId</span>  <span class="o">=</span> <span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotationId</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">annotationsModel</span>    <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">annotations</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">nextAnnotation</span>      <span class="o">=</span> <span class="p">(</span><span class="nx">activeAnnotationId</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="o">?</span>
        <span class="nx">annotationsModel</span><span class="p">.</span><span class="nx">getFirstAnnotation</span><span class="p">()</span> <span class="o">:</span> <span class="nx">annotationsModel</span><span class="p">.</span><span class="nx">getNextAnnotation</span><span class="p">(</span><span class="nx">activeAnnotationId</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">nextAnnotation</span><span class="p">){</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">viewer</span><span class="p">.</span><span class="nx">pageSet</span><span class="p">.</span><span class="nx">showAnnotation</span><span class="p">(</span><span class="nx">nextAnnotation</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">setAnnotationPosition</span><span class="p">(</span><span class="nx">nextAnnotation</span><span class="p">.</span><span class="nx">position</span><span class="p">);</span>


  <span class="p">},</span>
  <span class="nx">previous</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">viewer</span>              <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">activeAnnotationId</span>  <span class="o">=</span> <span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotationId</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">annotationsModel</span>    <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">annotations</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">previousAnnotation</span> <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="nx">activeAnnotationId</span><span class="p">)</span> <span class="o">?</span>
    <span class="nx">annotationsModel</span><span class="p">.</span><span class="nx">getFirstAnnotation</span><span class="p">()</span> <span class="o">:</span> <span class="nx">annotationsModel</span><span class="p">.</span><span class="nx">getPreviousAnnotation</span><span class="p">(</span><span class="nx">activeAnnotationId</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">previousAnnotation</span><span class="p">){</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">viewer</span><span class="p">.</span><span class="nx">pageSet</span><span class="p">.</span><span class="nx">showAnnotation</span><span class="p">(</span><span class="nx">previousAnnotation</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">setAnnotationPosition</span><span class="p">(</span><span class="nx">previousAnnotation</span><span class="p">.</span><span class="nx">position</span><span class="p">);</span>


  <span class="p">},</span>
  <span class="nx">search</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;ViewSearch&#39;</span><span class="p">);</span>

    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="nx">DV</span><span class="p">.</span><span class="nx">Schema</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">ViewDocument</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">next</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">nextPage</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">nextPage</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">jump</span><span class="p">(</span><span class="nx">nextPage</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-130'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-130">&#182;</a>
        </div>
        <p>this.viewer.history.save(&lsquo;document/p&rsquo;+(nextPage+1));</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="p">},</span>
  <span class="nx">previous</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">previousPage</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">previousPage</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">jump</span><span class="p">(</span><span class="nx">previousPage</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-131'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-131">&#182;</a>
        </div>
        <p>this.viewer.history.save(&lsquo;document/p&rsquo;+(previousPage+1));</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="p">},</span>
  <span class="nx">search</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;ViewSearch&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">DV</span><span class="p">.</span><span class="nx">Schema</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">ViewSearch</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">next</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">nextPage</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">nextPage</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">loadText</span><span class="p">(</span><span class="nx">nextPage</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;ViewText&#39;</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">previous</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">previousPage</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">previousPage</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">loadText</span><span class="p">(</span><span class="nx">previousPage</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;ViewText&#39;</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">search</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">getSearchResponse</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">searchInput</span><span class="p">.</span><span class="nx">val</span><span class="p">());</span>

    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="nx">DV</span><span class="p">.</span><span class="nx">Schema</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">ViewText</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">next</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">nextPage</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">nextPage</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">loadText</span><span class="p">(</span><span class="nx">nextPage</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">previous</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">previousPage</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">previousPage</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">loadText</span><span class="p">(</span><span class="nx">previousPage</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">search</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;ViewSearch&#39;</span><span class="p">);</span>

    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="nx">DV</span><span class="p">.</span><span class="nx">Schema</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">ViewThumbnails</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">next</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">nextPage</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">nextPage</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">jump</span><span class="p">(</span><span class="nx">nextPage</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">previous</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">previousPage</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">previousPage</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">jump</span><span class="p">(</span><span class="nx">previousPage</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">search</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;ViewSearch&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">DV</span><span class="p">.</span><span class="nx">Schema</span><span class="p">.</span><span class="nx">events</span><span class="p">,</span> <span class="p">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-document/p[pageID]'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-document/p[pageID]">&#182;</a>
        </div>
        <h1>document/p[pageID]</h1>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">handleHashChangeViewDocumentPage</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">page</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">pageIndex</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">page</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">state</span> <span class="o">===</span> <span class="s1">&#39;ViewDocument&#39;</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">pageSet</span><span class="p">.</span><span class="nx">cleanUp</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">jump</span><span class="p">(</span><span class="nx">pageIndex</span><span class="p">);</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">setPageIndex</span><span class="p">(</span><span class="nx">pageIndex</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;ViewDocument&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-p[pageID]'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-p[pageID]">&#182;</a>
        </div>
        <h1>p[pageID]</h1>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">handleHashChangeLegacyViewDocumentPage</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">page</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">pageIndex</span>   <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">page</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">handleHashChangeViewDocumentPage</span><span class="p">(</span><span class="nx">page</span><span class="p">);</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-document/p[pageID]/a[annotationID]'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-document/p[pageID]/a[annotationID]">&#182;</a>
        </div>
        <h1>document/p[pageID]/a[annotationID]</h1>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">handleHashChangeViewDocumentAnnotation</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">page</span><span class="p">,</span><span class="nx">annotation</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">pageIndex</span>   <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">page</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">annotation</span>  <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">annotation</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">state</span> <span class="o">===</span> <span class="s1">&#39;ViewDocument&#39;</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">pageSet</span><span class="p">.</span><span class="nx">showAnnotation</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">byId</span><span class="p">[</span><span class="nx">annotation</span><span class="p">]);</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">setPageIndex</span><span class="p">(</span><span class="nx">pageIndex</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">pageSet</span><span class="p">.</span><span class="nx">setActiveAnnotation</span><span class="p">(</span><span class="nx">annotation</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">openingAnnotationFromHash</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;ViewDocument&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-annotation/a[annotationID]'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-annotation/a[annotationID]">&#182;</a>
        </div>
        <h1>annotation/a[annotationID]</h1>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">handleHashChangeViewAnnotationAnnotation</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">annotation</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">annotation</span>  <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">annotation</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">viewer</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">state</span> <span class="o">===</span> <span class="s1">&#39;ViewAnnotation&#39;</span><span class="p">){</span>
      <span class="nx">viewer</span><span class="p">.</span><span class="nx">pageSet</span><span class="p">.</span><span class="nx">showAnnotation</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">byId</span><span class="p">[</span><span class="nx">annotation</span><span class="p">]);</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotationId</span> <span class="o">=</span> <span class="nx">annotation</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;ViewAnnotation&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-136'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-136">&#182;</a>
        </div>
        <p>Default route if all else fails</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">handleHashChangeDefault</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">pageSet</span><span class="p">.</span><span class="nx">cleanUp</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">setPageIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">state</span> <span class="o">===</span> <span class="s1">&#39;ViewDocument&#39;</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">jump</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-137'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-137">&#182;</a>
        </div>
        <p>this.viewer.history.save(&lsquo;document/p1&rsquo;);</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;ViewDocument&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-text/p[pageID]'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-text/p[pageID]">&#182;</a>
        </div>
        <h1>text/p[pageID]</h1>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">handleHashChangeViewText</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">page</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">pageIndex</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">page</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">state</span> <span class="o">===</span> <span class="s1">&#39;ViewText&#39;</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">loadText</span><span class="p">(</span><span class="nx">pageIndex</span><span class="p">);</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">setPageIndex</span><span class="p">(</span><span class="nx">pageIndex</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;ViewText&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span>

  <span class="nx">handleHashChangeViewPages</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">state</span> <span class="o">==</span> <span class="s1">&#39;ViewThumbnails&#39;</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;ViewThumbnails&#39;</span><span class="p">);</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-search/[searchString]'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-search/[searchString]">&#182;</a>
        </div>
        <h1>search/[searchString]</h1>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">handleHashChangeViewSearchRequest</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">page</span><span class="p">,</span><span class="nx">query</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">pageIndex</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">page</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">searchInput</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nx">query</span><span class="p">));</span>

    <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">state</span> <span class="o">!==</span> <span class="s1">&#39;ViewSearch&#39;</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">setPageIndex</span><span class="p">(</span><span class="nx">pageIndex</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;ViewSearch&#39;</span><span class="p">);</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-entity/p[pageID]/[searchString]/[offset]:[length]'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-entity/p[pageID]/[searchString]/[offset]:[length]">&#182;</a>
        </div>
        <h1>entity/p[pageID]/[searchString]/[offset]:[length]</h1>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">handleHashChangeViewEntity</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">page</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">page</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">page</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nx">name</span> <span class="o">=</span> <span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">searchInput</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">setPageIndex</span><span class="p">(</span><span class="nx">page</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">states</span><span class="p">.</span><span class="nx">ViewEntity</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">offset</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">length</span><span class="p">,</span> <span class="mi">10</span><span class="p">));</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">DV</span><span class="p">.</span><span class="nx">Schema</span><span class="p">.</span><span class="nx">events</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">handleNavigation</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">el</span>          <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">triggerEl</span>   <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;.DV-trigger&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">noteEl</span>      <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;.DV-annotationMarker&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">chapterEl</span>   <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;.DV-chapter&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">triggerEl</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span><span class="s1">&#39;DV-expander&#39;</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">chapterEl</span><span class="p">.</span><span class="nx">toggleClass</span><span class="p">(</span><span class="s1">&#39;DV-collapsed&#39;</span><span class="p">);</span>

    <span class="p">}</span><span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">noteEl</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">aid</span>         <span class="o">=</span> <span class="nx">noteEl</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">id</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;DV-annotationMarker-&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">annotation</span>  <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">getAnnotation</span><span class="p">(</span><span class="nx">aid</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">pageNumber</span>  <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">annotation</span><span class="p">.</span><span class="nx">index</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>

      <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">state</span> <span class="o">===</span> <span class="s1">&#39;ViewText&#39;</span><span class="p">){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">loadText</span><span class="p">(</span><span class="nx">annotation</span><span class="p">.</span><span class="nx">index</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-141'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-141">&#182;</a>
        </div>
        <p>this.viewer.history.save(&lsquo;text/p&rsquo;+pageNumber);</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">state</span> <span class="o">===</span> <span class="s1">&#39;ViewThumbnails&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;ViewDocument&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">pageSet</span><span class="p">.</span><span class="nx">showAnnotation</span><span class="p">(</span><span class="nx">annotation</span><span class="p">);</span>
      <span class="p">}</span>

    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">chapterEl</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-142'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-142">&#182;</a>
        </div>
        <p>its a header, take it to the page</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="nx">chapterEl</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;DV-collapsed&#39;</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">cid</span>           <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">chapterEl</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">id</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;DV-chapter-&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="mi">10</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">chapterIndex</span>  <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">chapters</span><span class="p">.</span><span class="nx">getChapterPosition</span><span class="p">(</span><span class="nx">cid</span><span class="p">),</span><span class="mi">10</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">pageNumber</span>    <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">chapterIndex</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>

      <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">state</span> <span class="o">===</span> <span class="s1">&#39;ViewText&#39;</span><span class="p">){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">loadText</span><span class="p">(</span><span class="nx">chapterIndex</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-143'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-143">&#182;</a>
        </div>
        <p>this.viewer.history.save(&lsquo;text/p&rsquo;+pageNumber);</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">state</span> <span class="o">===</span> <span class="s1">&#39;ViewDocument&#39;</span> <span class="o">||</span>
               <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">state</span> <span class="o">===</span> <span class="s1">&#39;ViewThumbnails&#39;</span><span class="p">){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">jump</span><span class="p">(</span><span class="nx">chapterIndex</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-144'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-144">&#182;</a>
        </div>
        <p>this.viewer.history.save(&lsquo;document/p&rsquo;+pageNumber);</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">state</span> <span class="o">===</span> <span class="s1">&#39;ViewThumbnails&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;ViewDocument&#39;</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span>

    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
<span class="nx">DV</span><span class="p">.</span><span class="nx">Schema</span><span class="p">.</span><span class="nx">helpers</span> <span class="o">=</span> <span class="p">{</span>

    <span class="nx">HOST_EXTRACTOR</span> <span class="o">:</span> <span class="p">(</span><span class="sr">/https?:\/\/([^\/]+)\//</span><span class="p">),</span>

    <span class="nx">annotationClassName</span><span class="o">:</span> <span class="s1">&#39;.DV-annotation&#39;</span><span class="p">,</span></pre></div>
      </td>
    </tr>
    <tr id='section-145'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-145">&#182;</a>
        </div>
        <p>Bind all events for the docviewer
live/delegate are the preferred methods of event attachment</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="nx">bindEvents</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">context</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">boundZoom</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="s1">&#39;zoom&#39;</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">doc</span>       <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">value</span>     <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">ZOOM_RANGES</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">zoomLevel</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">viewer</span>    <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">;</span>
      <span class="nx">viewer</span><span class="p">.</span><span class="nx">slider</span> <span class="o">=</span> <span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-zoomBox&#39;</span><span class="p">).</span><span class="nx">slider</span><span class="p">({</span>
        <span class="nx">step</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nx">min</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">max</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="nx">value</span><span class="o">:</span> <span class="nx">value</span><span class="p">,</span>
        <span class="nx">slide</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span><span class="nx">d</span><span class="p">){</span>
          <span class="nx">boundZoom</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">ZOOM_RANGES</span><span class="p">[</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="mi">10</span><span class="p">)]);</span>
        <span class="p">},</span>
        <span class="nx">change</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span><span class="nx">d</span><span class="p">){</span>
          <span class="nx">boundZoom</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">ZOOM_RANGES</span><span class="p">[</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="mi">10</span><span class="p">)]);</span>
        <span class="p">}</span>
      <span class="p">});</span></pre></div>
      </td>
    </tr>
    <tr id='section-146'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-146">&#182;</a>
        </div>
        <p>next/previous</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="kd">var</span> <span class="nx">history</span>         <span class="o">=</span> <span class="nx">viewer</span><span class="p">.</span><span class="nx">history</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">compiled</span>        <span class="o">=</span> <span class="nx">viewer</span><span class="p">.</span><span class="nx">compiled</span><span class="p">;</span>
      <span class="nx">compiled</span><span class="p">.</span><span class="nx">next</span>       <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="s1">&#39;next&#39;</span><span class="p">);</span>
      <span class="nx">compiled</span><span class="p">.</span><span class="nx">previous</span>   <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="s1">&#39;previous&#39;</span><span class="p">);</span>


      <span class="kd">var</span> <span class="nx">states</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">states</span><span class="p">;</span>
      <span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-navControls&#39;</span><span class="p">).</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;span.DV-next&#39;</span><span class="p">,</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">compiled</span><span class="p">.</span><span class="nx">next</span><span class="p">);</span>
      <span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-navControls&#39;</span><span class="p">).</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;span.DV-previous&#39;</span><span class="p">,</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">compiled</span><span class="p">.</span><span class="nx">previous</span><span class="p">);</span>

      <span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-annotationView&#39;</span><span class="p">).</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;.DV-trigger&#39;</span><span class="p">,</span><span class="s1">&#39;click&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;ViewAnnotation&#39;</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-documentView&#39;</span><span class="p">).</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;.DV-trigger&#39;</span><span class="p">,</span><span class="s1">&#39;click&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span></pre></div>
      </td>
    </tr>
    <tr id='section-147'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-147">&#182;</a>
        </div>
        <p>history.save(&lsquo;document/p&rsquo;+context.models.document.currentPage());</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="nx">context</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;ViewDocument&#39;</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-thumbnailsView&#39;</span><span class="p">).</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;.DV-trigger&#39;</span><span class="p">,</span><span class="s1">&#39;click&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
        <span class="nx">context</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;ViewThumbnails&#39;</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-textView&#39;</span><span class="p">).</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;.DV-trigger&#39;</span><span class="p">,</span><span class="s1">&#39;click&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span></pre></div>
      </td>
    </tr>
    <tr id='section-148'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-148">&#182;</a>
        </div>
        <p>history.save(&lsquo;text/p&rsquo;+context.models.document.currentPage());</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="nx">context</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;ViewText&#39;</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-allAnnotations&#39;</span><span class="p">).</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;.DV-annotationGoto .DV-trigger&#39;</span><span class="p">,</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">gotoPage</span><span class="p">,</span> <span class="k">this</span><span class="p">));</span>

      <span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;form.DV-searchDocument&#39;</span><span class="p">).</span><span class="nx">submit</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="s1">&#39;search&#39;</span><span class="p">));</span>
      <span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-searchBar&#39;</span><span class="p">).</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;.DV-closeSearch&#39;</span><span class="p">,</span><span class="s1">&#39;click&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span></pre></div>
      </td>
    </tr>
    <tr id='section-149'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-149">&#182;</a>
        </div>
        <p>history.save(&lsquo;text/p&rsquo;+context.models.document.currentPage());</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="nx">context</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;ViewText&#39;</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-searchBox&#39;</span><span class="p">).</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;.DV-searchInput-cancel&#39;</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">clearSearch</span><span class="p">,</span> <span class="k">this</span><span class="p">));</span>

      <span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-searchResults&#39;</span><span class="p">).</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;span.DV-resultPrevious&#39;</span><span class="p">,</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">highlightPreviousMatch</span><span class="p">,</span> <span class="k">this</span><span class="p">));</span>

      <span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-searchResults&#39;</span><span class="p">).</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;span.DV-resultNext&#39;</span><span class="p">,</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">highlightNextMatch</span><span class="p">,</span> <span class="k">this</span><span class="p">));</span></pre></div>
      </td>
    </tr>
    <tr id='section-150'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-150">&#182;</a>
        </div>
        <p>Prevent navigation elements from being selectable when clicked.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-trigger&#39;</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;selectstart&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="p">});</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;.DV-fullscreen&#39;</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">openFullScreen</span><span class="p">,</span> <span class="k">this</span><span class="p">));</span>

      <span class="kd">var</span> <span class="nx">boundToggle</span>  <span class="o">=</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">annotationBridgeToggle</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">collection</span>   <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">collection</span><span class="p">;</span>

      <span class="nx">collection</span><span class="p">.</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;.DV-annotationTab&#39;</span><span class="p">,</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">boundToggle</span><span class="p">);</span>
      <span class="nx">collection</span><span class="p">.</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;.DV-annotationRegion&#39;</span><span class="p">,</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">annotationBridgeShow</span><span class="p">,</span> <span class="k">this</span><span class="p">));</span>
      <span class="nx">collection</span><span class="p">.</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;.DV-annotationNext&#39;</span><span class="p">,</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">annotationBridgeNext</span><span class="p">,</span> <span class="k">this</span><span class="p">));</span>
      <span class="nx">collection</span><span class="p">.</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;.DV-annotationPrevious&#39;</span><span class="p">,</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">annotationBridgePrevious</span><span class="p">,</span> <span class="k">this</span><span class="p">));</span>
      <span class="nx">collection</span><span class="p">.</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;.DV-showEdit&#39;</span><span class="p">,</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">showAnnotationEdit</span><span class="p">,</span> <span class="k">this</span><span class="p">));</span>
      <span class="nx">collection</span><span class="p">.</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;.DV-cancelEdit&#39;</span><span class="p">,</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cancelAnnotationEdit</span><span class="p">,</span> <span class="k">this</span><span class="p">));</span>
      <span class="nx">collection</span><span class="p">.</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;.DV-saveAnnotation&#39;</span><span class="p">,</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">saveAnnotation</span><span class="p">,</span> <span class="k">this</span><span class="p">));</span>
      <span class="nx">collection</span><span class="p">.</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;.DV-saveAnnotationDraft&#39;</span><span class="p">,</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">saveAnnotation</span><span class="p">,</span> <span class="k">this</span><span class="p">));</span>
      <span class="nx">collection</span><span class="p">.</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;.DV-deleteAnnotation&#39;</span><span class="p">,</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">deleteAnnotation</span><span class="p">,</span> <span class="k">this</span><span class="p">));</span>
      <span class="nx">collection</span><span class="p">.</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;.DV-pageNumber&#39;</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">permalinkPage</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="s1">&#39;document&#39;</span><span class="p">));</span>
      <span class="nx">collection</span><span class="p">.</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;.DV-textCurrentPage&#39;</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">permalinkPage</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">));</span>
      <span class="nx">collection</span><span class="p">.</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;.DV-annotationTitle&#39;</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">permalinkAnnotation</span><span class="p">,</span> <span class="k">this</span><span class="p">));</span>
      <span class="nx">collection</span><span class="p">.</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;.DV-permalink&#39;</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">permalinkAnnotation</span><span class="p">,</span> <span class="k">this</span><span class="p">));</span></pre></div>
      </td>
    </tr>
    <tr id='section-151'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-151">&#182;</a>
        </div>
        <p>Thumbnails</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-thumbnails&#39;</span><span class="p">).</span><span class="nx">delegate</span><span class="p">(</span><span class="s1">&#39;.DV-thumbnail-page&#39;</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">$thumbnail</span> <span class="o">=</span> <span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">openEditor</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">pageIndex</span> <span class="o">=</span> <span class="nx">$thumbnail</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;.DV-thumbnail&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-pageNumber&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
          <span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">setPageIndex</span><span class="p">(</span><span class="nx">pageIndex</span><span class="p">);</span>
          <span class="nx">viewer</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;ViewDocument&#39;</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-152'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-152">&#182;</a>
        </div>
        <p>viewer.history.save(&lsquo;document/p&rsquo;+pageNumber);</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="p">}</span>
      <span class="p">});</span></pre></div>
      </td>
    </tr>
    <tr id='section-153'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-153">&#182;</a>
        </div>
        <p>Handle iPad / iPhone scroll events&hellip;</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;touchStart&#39;</span><span class="p">,</span> <span class="s1">&#39;touchMove&#39;</span><span class="p">,</span> <span class="s1">&#39;touchEnd&#39;</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nb">window</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">ontouchstart</span>  <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchStart</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nb">window</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">ontouchmove</span>   <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchMove</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nb">window</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">ontouchend</span>    <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchEnd</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">well</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">ontouchstart</span>    <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchStart</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">well</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">ontouchmove</span>     <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchMove</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">well</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">ontouchend</span>      <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">touchEnd</span><span class="p">;</span>

      <span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-descriptionToggle&#39;</span><span class="p">).</span><span class="nx">live</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>

        <span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-descriptionText&#39;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">();</span>
        <span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-descriptionToggle&#39;</span><span class="p">).</span><span class="nx">toggleClass</span><span class="p">(</span><span class="s1">&#39;DV-showDescription&#39;</span><span class="p">);</span>
      <span class="p">});</span>

      <span class="kd">var</span> <span class="nx">cleanUp</span> <span class="o">=</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">pageSet</span><span class="p">.</span><span class="nx">cleanUp</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">live</span><span class="p">(</span><span class="s1">&#39;mousedown&#39;</span><span class="p">,</span>
        <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
          <span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">parents</span><span class="p">().</span><span class="nx">is</span><span class="p">(</span><span class="s1">&#39;.DV-annotation&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">el</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="s1">&#39;.DV-annotation&#39;</span><span class="p">))</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
          <span class="k">if</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span><span class="s1">&#39;DV-coverVisible&#39;</span><span class="p">)){</span>
            <span class="k">if</span><span class="p">((</span><span class="nx">el</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">-</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="mi">15</span><span class="p">){</span>
              <span class="nx">cleanUp</span><span class="p">();</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">);</span>

      <span class="kd">var</span> <span class="nx">docId</span> <span class="o">=</span> <span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>

      <span class="k">if</span><span class="p">(</span><span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">browser</span><span class="p">.</span><span class="nx">msie</span> <span class="o">==</span> <span class="kc">true</span><span class="p">){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">browserDocument</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;focus.&#39;</span> <span class="o">+</span> <span class="nx">docId</span><span class="p">,</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">focusWindow</span><span class="p">,</span><span class="k">this</span><span class="p">));</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">browserDocument</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;focusout.&#39;</span> <span class="o">+</span> <span class="nx">docId</span><span class="p">,</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">focusOut</span><span class="p">,</span><span class="k">this</span><span class="p">));</span>
      <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">browserWindow</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;focus.&#39;</span> <span class="o">+</span> <span class="nx">docId</span><span class="p">,</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">focusWindow</span><span class="p">,</span><span class="k">this</span><span class="p">));</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">browserWindow</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;blur.&#39;</span> <span class="o">+</span> <span class="nx">docId</span><span class="p">,</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">blurWindow</span><span class="p">,</span><span class="k">this</span><span class="p">));</span>
      <span class="p">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-154'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-154">&#182;</a>
        </div>
        <p>When the document is scrolled, even in the background, resume polling.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;scroll.&#39;</span> <span class="o">+</span> <span class="nx">docId</span><span class="p">,</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">focusWindow</span><span class="p">,</span> <span class="k">this</span><span class="p">));</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">coverPages</span><span class="p">.</span><span class="nx">live</span><span class="p">(</span><span class="s1">&#39;mousedown&#39;</span><span class="p">,</span> <span class="nx">cleanUp</span><span class="p">);</span>

      <span class="nx">viewer</span><span class="p">.</span><span class="nx">acceptInput</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">currentPage</span><span class="p">.</span><span class="nx">acceptInput</span><span class="p">({</span> <span class="nx">changeCallBack</span><span class="o">:</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">acceptInputCallBack</span><span class="p">,</span><span class="k">this</span><span class="p">)</span> <span class="p">});</span>

    <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-155'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-155">&#182;</a>
        </div>
        <p>Unbind jQuery events that have been bound to objects outside of the viewer.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="nx">unbindEvents</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">viewer</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">docId</span> <span class="o">=</span> <span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">browser</span><span class="p">.</span><span class="nx">msie</span> <span class="o">==</span> <span class="kc">true</span><span class="p">){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">browserDocument</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s1">&#39;focus.&#39;</span> <span class="o">+</span> <span class="nx">docId</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">browserDocument</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s1">&#39;focusout.&#39;</span> <span class="o">+</span> <span class="nx">docId</span><span class="p">);</span>
      <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="nx">viewer</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">browserWindow</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s1">&#39;focus.&#39;</span> <span class="o">+</span> <span class="nx">docId</span><span class="p">);</span>
        <span class="nx">viewer</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">browserWindow</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s1">&#39;blur.&#39;</span> <span class="o">+</span> <span class="nx">docId</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">viewer</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">browserWindow</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s1">&#39;scroll.&#39;</span> <span class="o">+</span> <span class="nx">docId</span><span class="p">);</span>
      <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">observers</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obs</span><span class="p">){</span> <span class="nx">viewer</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">removeObserver</span><span class="p">(</span><span class="nx">obs</span><span class="p">);</span> <span class="p">});</span>
    <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-156'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-156">&#182;</a>
        </div>
        <p>We&rsquo;re entering the Notes tab &mdash; make sure that there are no data-src
attributes remaining.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="nx">ensureAnnotationImages</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.DV-img[data-src]&quot;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="nx">el</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">,</span> <span class="nx">el</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-src&#39;</span><span class="p">));</span>
      <span class="p">});</span>
    <span class="p">},</span>

    <span class="nx">startCheckTimer</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="kd">var</span> <span class="nx">_t</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">_check</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="nx">_t</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">check</span><span class="p">();</span>
      <span class="p">};</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">checkTimer</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="nx">_check</span><span class="p">,</span><span class="mi">100</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">stopCheckTimer</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="nx">clearInterval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">checkTimer</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">blurWindow</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">isFocus</span> <span class="o">===</span> <span class="kc">true</span><span class="p">){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">isFocus</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-157'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-157">&#182;</a>
        </div>
        <p>pause draw timer</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">stopCheckTimer</span><span class="p">();</span>
      <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">focusOut</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">activeElement</span> <span class="o">!=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">activeElement</span><span class="p">){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">activeElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">activeElement</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">isFocus</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span><span class="k">else</span><span class="p">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-158'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-158">&#182;</a>
        </div>
        <p>pause draw timer</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">isFocus</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">stopCheckTimer</span><span class="p">();</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">focusWindow</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">isFocus</span> <span class="o">===</span> <span class="kc">true</span><span class="p">){</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">isFocus</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-159'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-159">&#182;</a>
        </div>
        <p>restart draw timer</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">startCheckTimer</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">touchStart</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
      <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
      <span class="kd">var</span> <span class="nx">touch</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">changedTouches</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_moved</span>  <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_touchX</span> <span class="o">=</span> <span class="nx">touch</span><span class="p">.</span><span class="nx">pageX</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_touchY</span> <span class="o">=</span> <span class="nx">touch</span><span class="p">.</span><span class="nx">pageY</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">touchMove</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">el</span>    <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">touch</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">changedTouches</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
      <span class="kd">var</span> <span class="nx">xDiff</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_touchX</span> <span class="o">-</span> <span class="nx">touch</span><span class="p">.</span><span class="nx">pageX</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">yDiff</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_touchY</span> <span class="o">-</span> <span class="nx">touch</span><span class="p">.</span><span class="nx">pageY</span><span class="p">;</span>
      <span class="nx">el</span><span class="p">.</span><span class="nx">scrollLeft</span> <span class="o">+=</span> <span class="nx">xDiff</span><span class="p">;</span>
      <span class="nx">el</span><span class="p">.</span><span class="nx">scrollTop</span>  <span class="o">+=</span> <span class="nx">yDiff</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_touchX</span>  <span class="o">-=</span> <span class="nx">xDiff</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_touchY</span>  <span class="o">-=</span> <span class="nx">yDiff</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">yDiff</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">xDiff</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">_moved</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">touchEnd</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_moved</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">touch</span>     <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">changedTouches</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="kd">var</span> <span class="nx">target</span>    <span class="o">=</span> <span class="nx">touch</span><span class="p">.</span><span class="nx">target</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">fakeClick</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createEvent</span><span class="p">(</span><span class="s1">&#39;MouseEvent&#39;</span><span class="p">);</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">!==</span> <span class="mi">1</span><span class="p">)</span> <span class="nx">target</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">;</span>
        <span class="nx">fakeClick</span><span class="p">.</span><span class="nx">initMouseEvent</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">touch</span><span class="p">.</span><span class="nx">view</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
          <span class="nx">touch</span><span class="p">.</span><span class="nx">screenX</span><span class="p">,</span> <span class="nx">touch</span><span class="p">.</span><span class="nx">screenY</span><span class="p">,</span> <span class="nx">touch</span><span class="p">.</span><span class="nx">clientX</span><span class="p">,</span> <span class="nx">touch</span><span class="p">.</span><span class="nx">clientY</span><span class="p">,</span>
          <span class="kc">false</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
        <span class="nx">target</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="nx">fakeClick</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_moved</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-160'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-160">&#182;</a>
        </div>
        <p>Click to open a page&rsquo;s permalink.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="nx">permalinkPage</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">mode</span><span class="p">,</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span> <span class="o">==</span> <span class="s1">&#39;text&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">number</span>  <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">currentPage</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">pageId</span>  <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;.DV-set&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-id&#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">page</span>    <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">pageSet</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">pageId</span><span class="p">];</span>
        <span class="kd">var</span> <span class="nx">number</span>  <span class="o">=</span> <span class="nx">page</span><span class="p">.</span><span class="nx">pageNumber</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">jump</span><span class="p">(</span><span class="nx">page</span><span class="p">.</span><span class="nx">index</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="nx">mode</span> <span class="o">+</span> <span class="s1">&#39;/p&#39;</span> <span class="o">+</span> <span class="nx">number</span><span class="p">);</span>
    <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-161'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-161">&#182;</a>
        </div>
        <p>Click to open an annotation&rsquo;s permalink.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="nx">permalinkAnnotation</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">id</span>   <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;.DV-annotation&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-id&#39;</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">anno</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">getAnnotation</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">sid</span>  <span class="o">=</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">server_id</span> <span class="o">||</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">state</span> <span class="o">==</span> <span class="s1">&#39;ViewDocument&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">pageSet</span><span class="p">.</span><span class="nx">showAnnotation</span><span class="p">(</span><span class="nx">anno</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="s1">&#39;document/p&#39;</span> <span class="o">+</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">pageNumber</span> <span class="o">+</span> <span class="s1">&#39;/a&#39;</span> <span class="o">+</span> <span class="nx">sid</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="s1">&#39;annotation/a&#39;</span> <span class="o">+</span> <span class="nx">sid</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">setDocHeight</span><span class="o">:</span>   <span class="kd">function</span><span class="p">(</span><span class="nx">height</span><span class="p">,</span><span class="nx">diff</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">bar</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="nx">height</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nb">window</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">scrollTop</span> <span class="o">+=</span> <span class="nx">diff</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">getWindowDimensions</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">height</span><span class="o">:</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span> <span class="o">?</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">browserWindow</span><span class="p">.</span><span class="nx">height</span><span class="p">(),</span>
        <span class="nx">width</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">browserWindow</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span>
      <span class="p">};</span>
      <span class="k">return</span> <span class="nx">d</span><span class="p">;</span>
    <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-162'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-162">&#182;</a>
        </div>
        <p>Is the given URL on a remote domain?</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="nx">isCrossDomain</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">match</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">HOST_EXTRACTOR</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">match</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">match</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">host</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">resetScrollState</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">gotoPage</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
      <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
      <span class="kd">var</span> <span class="nx">aid</span>           <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">parents</span><span class="p">(</span><span class="s1">&#39;.DV-annotation&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;rel&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;aid-&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">annotation</span>    <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">getAnnotation</span><span class="p">(</span><span class="nx">aid</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">viewer</span>        <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">;</span>

      <span class="k">if</span><span class="p">(</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">state</span> <span class="o">!==</span> <span class="s1">&#39;ViewDocument&#39;</span><span class="p">){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">setPageIndex</span><span class="p">(</span><span class="nx">annotation</span><span class="p">.</span><span class="nx">index</span><span class="p">);</span>
        <span class="nx">viewer</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;ViewDocument&#39;</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-163'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-163">&#182;</a>
        </div>
        <p>this.viewer.history.save(&lsquo;document/p&rsquo;+(parseInt(annotation.index,10)+1));</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">openFullScreen</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">canonicalURL</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/#\S+$/</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">currentPage</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">currentPage</span><span class="p">();</span></pre></div>
      </td>
    </tr>
    <tr id='section-164'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-164">&#182;</a>
        </div>
        <p>construct url fragment based on current viewer state</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="k">switch</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="s1">&#39;ViewAnnotation&#39;</span><span class="o">:</span>
          <span class="nx">url</span> <span class="o">+=</span> <span class="s1">&#39;#annotation/a&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotationId</span><span class="p">;</span> <span class="c1">// default to the top of the annotations page.</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;ViewDocument&#39;</span><span class="o">:</span>
          <span class="nx">url</span> <span class="o">+=</span> <span class="s1">&#39;#document/p&#39;</span> <span class="o">+</span> <span class="nx">currentPage</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;ViewSearch&#39;</span><span class="o">:</span>
          <span class="nx">url</span> <span class="o">+=</span> <span class="s1">&#39;#search/p&#39;</span> <span class="o">+</span> <span class="nx">currentPage</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">searchInput</span><span class="p">.</span><span class="nx">val</span><span class="p">());</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;ViewText&#39;</span><span class="o">:</span>
          <span class="nx">url</span> <span class="o">+=</span> <span class="s1">&#39;#text/p&#39;</span> <span class="o">+</span> <span class="nx">currentPage</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;ViewThumbnails&#39;</span><span class="o">:</span>
          <span class="nx">url</span> <span class="o">+=</span> <span class="s1">&#39;#pages/p&#39;</span> <span class="o">+</span> <span class="nx">currentPage</span><span class="p">;</span> <span class="c1">// need to set up a route to catch this.</span>
          <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="s2">&quot;documentviewer&quot;</span><span class="p">,</span> <span class="s2">&quot;toolbar=no,resizable=yes,scrollbars=no,status=no&quot;</span><span class="p">);</span>
    <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-165'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-165">&#182;</a>
        </div>
        <p>Determine the correct DOM page ordering for a given page index.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="nx">sortPages</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pageIndex</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pageIndex</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">pageIndex</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;p0&#39;</span><span class="p">,</span> <span class="s1">&#39;p1&#39;</span><span class="p">,</span> <span class="s1">&#39;p2&#39;</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pageIndex</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>                   <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;p1&#39;</span><span class="p">,</span> <span class="s1">&#39;p2&#39;</span><span class="p">,</span> <span class="s1">&#39;p0&#39;</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pageIndex</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>                   <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;p2&#39;</span><span class="p">,</span> <span class="s1">&#39;p0&#39;</span><span class="p">,</span> <span class="s1">&#39;p1&#39;</span><span class="p">];</span>
    <span class="p">},</span>

    <span class="nx">addObserver</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">observerName</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">removeObserver</span><span class="p">(</span><span class="nx">observerName</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">observers</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">observerName</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">removeObserver</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">observerName</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">observers</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">observers</span><span class="p">;</span>
      <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="nx">len</span><span class="o">=</span><span class="nx">observers</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">len</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">observerName</span> <span class="o">===</span> <span class="nx">observers</span><span class="p">[</span><span class="nx">i</span><span class="p">]){</span>
          <span class="nx">observers</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-166'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-166">&#182;</a>
        </div>
        <p>TODO: This function is not currently being called. Candidate for removal.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-167'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-167">&#182;</a>
        </div>
        <p>setWindowSize: function(windowDimensions){
  var viewer          = this.viewer;
  var elements        = this.elements;
  var headerHeight    = elements.header.outerHeight() + 15;
  var offset          = DV.jQuery(this.viewer.options.container).offset().top;
  var uiHeight        = Math.round((windowDimensions.height) &ndash; headerHeight &ndash; offset);</p>

<p>// doc window
  elements.window.css({ height: uiHeight, width: windowDimensions.width-267 });</p>

<p>// well
  elements.well.css( { height: uiHeight });</p>

<p>// store this for later
  viewer.windowDimensions = windowDimensions;
},</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="nx">toggleContent</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">toggleClassName</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;DV-viewText DV-viewSearch DV-viewDocument DV-viewAnnotations DV-viewThumbnails&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;DV-&#39;</span><span class="o">+</span><span class="nx">toggleClassName</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">jump</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pageIndex</span><span class="p">,</span> <span class="nx">modifier</span><span class="p">,</span> <span class="nx">forceRedraw</span><span class="p">){</span>
      <span class="nx">modifier</span> <span class="o">=</span> <span class="p">(</span><span class="nx">modifier</span><span class="p">)</span> <span class="o">?</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">modifier</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">position</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">getOffset</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">pageIndex</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span> <span class="o">+</span> <span class="nx">modifier</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nb">window</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">scrollTop</span> <span class="o">=</span> <span class="nx">position</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">setPageIndex</span><span class="p">(</span><span class="nx">pageIndex</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">forceRedraw</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">pageSet</span><span class="p">.</span><span class="nx">redraw</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">state</span> <span class="o">===</span> <span class="s1">&#39;ViewThumbnails&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">thumbnails</span><span class="p">.</span><span class="nx">highlightCurrentPage</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">shift</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">argHash</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">windowEl</span>        <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nb">window</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">scrollTopShift</span>  <span class="o">=</span> <span class="nx">windowEl</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">()</span> <span class="o">+</span> <span class="nx">argHash</span><span class="p">.</span><span class="nx">deltaY</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">scrollLeftShift</span>  <span class="o">=</span> <span class="nx">windowEl</span><span class="p">.</span><span class="nx">scrollLeft</span><span class="p">()</span> <span class="o">+</span> <span class="nx">argHash</span><span class="p">.</span><span class="nx">deltaX</span><span class="p">;</span>

      <span class="nx">windowEl</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">(</span><span class="nx">scrollTopShift</span><span class="p">);</span>
      <span class="nx">windowEl</span><span class="p">.</span><span class="nx">scrollLeft</span><span class="p">(</span><span class="nx">scrollLeftShift</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">getAppState</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="kd">var</span> <span class="nx">docModel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">currentPage</span> <span class="o">=</span> <span class="p">(</span><span class="nx">docModel</span><span class="p">.</span><span class="nx">currentIndex</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="nx">docModel</span><span class="p">.</span><span class="nx">currentPage</span><span class="p">();</span>

      <span class="k">return</span> <span class="p">{</span> <span class="nx">page</span><span class="o">:</span> <span class="nx">currentPage</span><span class="p">,</span> <span class="nx">zoom</span><span class="o">:</span> <span class="nx">docModel</span><span class="p">.</span><span class="nx">zoomLevel</span><span class="p">,</span> <span class="nx">view</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">state</span> <span class="p">};</span>
    <span class="p">},</span>

    <span class="nx">constructPages</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="kd">var</span> <span class="nx">pages</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="kd">var</span> <span class="nx">totalPagesToCreate</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">totalPages</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">totalPages</span> <span class="o">:</span> <span class="mi">3</span><span class="p">;</span>

      <span class="kd">var</span> <span class="nx">height</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">pages</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">totalPagesToCreate</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">pages</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">JST</span><span class="p">.</span><span class="nx">pages</span><span class="p">({</span> <span class="nx">pageNumber</span><span class="o">:</span> <span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">pageIndex</span><span class="o">:</span> <span class="nx">i</span> <span class="p">,</span> <span class="nx">pageImageSource</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">baseHeight</span><span class="o">:</span> <span class="nx">height</span> <span class="p">}));</span>
      <span class="p">}</span>

      <span class="k">return</span> <span class="nx">pages</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
    <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-168'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-168">&#182;</a>
        </div>
        <p>Position the viewer on the page. For a full screen viewer, this means
absolute from the current y offset to the bottom of the viewport.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="nx">positionViewer</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">offset</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">position</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span><span class="nx">position</span><span class="o">:</span> <span class="s1">&#39;absolute&#39;</span><span class="p">,</span> <span class="nx">top</span><span class="o">:</span> <span class="nx">offset</span><span class="p">.</span><span class="nx">top</span><span class="p">,</span> <span class="nx">bottom</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">left</span><span class="o">:</span> <span class="nx">offset</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span> <span class="nx">right</span><span class="o">:</span> <span class="nx">offset</span><span class="p">.</span><span class="nx">left</span><span class="p">});</span>
    <span class="p">},</span>

    <span class="nx">unsupportedBrowser</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">browser</span><span class="p">.</span><span class="nx">msie</span> <span class="o">&amp;&amp;</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">browser</span><span class="p">.</span><span class="nx">version</span> <span class="o">&lt;=</span> <span class="s2">&quot;6.0&quot;</span><span class="p">))</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">container</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">JST</span><span class="p">.</span><span class="nx">unsupported</span><span class="p">({</span><span class="nx">viewer</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">}));</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">registerHashChangeEvents</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="kd">var</span> <span class="nx">events</span>  <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">history</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">history</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-169'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-169">&#182;</a>
        </div>
        <p>Default route</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="nx">history</span><span class="p">.</span><span class="nx">defaultCallback</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">events</span><span class="p">.</span><span class="nx">handleHashChangeDefault</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-170'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-170">&#182;</a>
        </div>
        <p>Handle page loading</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="nx">history</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="sr">/document\/p(\d*)$/</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">events</span><span class="p">.</span><span class="nx">handleHashChangeViewDocumentPage</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">));</span></pre></div>
      </td>
    </tr>
    <tr id='section-171'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-171">&#182;</a>
        </div>
        <p>Legacy NYT stuff</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="nx">history</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="sr">/p(\d*)$/</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">events</span><span class="p">.</span><span class="nx">handleHashChangeLegacyViewDocumentPage</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">));</span>
      <span class="nx">history</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="sr">/p=(\d*)$/</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">events</span><span class="p">.</span><span class="nx">handleHashChangeLegacyViewDocumentPage</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">));</span></pre></div>
      </td>
    </tr>
    <tr id='section-172'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-172">&#182;</a>
        </div>
        <p>Handle annotation loading in document view</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="nx">history</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="sr">/document\/p(\d*)\/a(\d*)$/</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">events</span><span class="p">.</span><span class="nx">handleHashChangeViewDocumentAnnotation</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">));</span></pre></div>
      </td>
    </tr>
    <tr id='section-173'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-173">&#182;</a>
        </div>
        <p>Handle annotation loading in annotation view</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="nx">history</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="sr">/annotation\/a(\d*)$/</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">events</span><span class="p">.</span><span class="nx">handleHashChangeViewAnnotationAnnotation</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">));</span></pre></div>
      </td>
    </tr>
    <tr id='section-174'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-174">&#182;</a>
        </div>
        <p>Handle loading of the pages view</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="nx">history</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="sr">/pages$/</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">events</span><span class="p">.</span><span class="nx">handleHashChangeViewPages</span><span class="p">,</span> <span class="nx">events</span><span class="p">));</span></pre></div>
      </td>
    </tr>
    <tr id='section-175'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-175">&#182;</a>
        </div>
        <p>Handle page loading in text view</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="nx">history</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="sr">/text\/p(\d*)$/</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">events</span><span class="p">.</span><span class="nx">handleHashChangeViewText</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">));</span></pre></div>
      </td>
    </tr>
    <tr id='section-176'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-176">&#182;</a>
        </div>
        <p>Handle entity display requests.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="nx">history</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="sr">/entity\/p(\d*)\/(.*)\/(\d+):(\d+)$/</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">events</span><span class="p">.</span><span class="nx">handleHashChangeViewEntity</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">));</span></pre></div>
      </td>
    </tr>
    <tr id='section-177'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-177">&#182;</a>
        </div>
        <p>Handle search requests</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="nx">history</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="sr">/search\/p(\d*)\/(.*)$/</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">events</span><span class="p">.</span><span class="nx">handleHashChangeViewSearchRequest</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">));</span>
    <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-178'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-178">&#182;</a>
        </div>
        <p>Sets up the zoom slider to match the appropriate for the specified
initial zoom level, and real document page sizes.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="nx">autoZoomPage</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">windowWidth</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">outerWidth</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">zoom</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">zoom</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">zoom</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span>
          <span class="mi">700</span><span class="p">,</span>
          <span class="nx">windowWidth</span> <span class="o">-</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">pages</span><span class="p">.</span><span class="nx">REDUCED_PADDING</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
        <span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">zoom</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">zoom</span><span class="p">;</span>
      <span class="p">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-179'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-179">&#182;</a>
        </div>
        <p>Setup ranges for auto-width zooming</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="kd">var</span> <span class="nx">ranges</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">zoom</span> <span class="o">&lt;=</span> <span class="mi">500</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">zoom2</span> <span class="o">=</span> <span class="p">(</span><span class="nx">zoom</span> <span class="o">+</span> <span class="mi">700</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
        <span class="nx">ranges</span> <span class="o">=</span> <span class="p">[</span><span class="nx">zoom</span><span class="p">,</span> <span class="nx">zoom2</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span> <span class="mi">850</span><span class="p">,</span> <span class="mi">1000</span><span class="p">];</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">zoom</span> <span class="o">&lt;=</span> <span class="mi">750</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">zoom2</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1000</span> <span class="o">-</span> <span class="mi">700</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="nx">zoom</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">zoom3</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1000</span> <span class="o">-</span> <span class="mi">700</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="nx">zoom</span><span class="p">;</span>
        <span class="nx">ranges</span> <span class="o">=</span> <span class="p">[.</span><span class="mi">66</span><span class="o">*</span><span class="nx">zoom</span><span class="p">,</span> <span class="nx">zoom</span><span class="p">,</span> <span class="nx">zoom2</span><span class="p">,</span> <span class="nx">zoom3</span><span class="p">,</span> <span class="mi">1000</span><span class="p">];</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="mi">750</span> <span class="o">&lt;</span> <span class="nx">zoom</span> <span class="o">&amp;&amp;</span> <span class="nx">zoom</span> <span class="o">&lt;=</span> <span class="mi">850</span><span class="p">){</span>
        <span class="kd">var</span> <span class="nx">zoom2</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1000</span> <span class="o">-</span> <span class="nx">zoom</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="nx">zoom</span><span class="p">;</span>
        <span class="nx">ranges</span> <span class="o">=</span> <span class="p">[.</span><span class="mi">66</span><span class="o">*</span><span class="nx">zoom</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span> <span class="nx">zoom</span><span class="p">,</span> <span class="nx">zoom2</span><span class="p">,</span> <span class="mi">1000</span><span class="p">];</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="mi">850</span> <span class="o">&lt;</span> <span class="nx">zoom</span> <span class="o">&amp;&amp;</span> <span class="nx">zoom</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">){</span>
        <span class="kd">var</span> <span class="nx">zoom2</span> <span class="o">=</span> <span class="p">((</span><span class="nx">zoom</span> <span class="o">-</span> <span class="mi">700</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">700</span><span class="p">;</span>
        <span class="nx">ranges</span> <span class="o">=</span> <span class="p">[.</span><span class="mi">66</span><span class="o">*</span><span class="nx">zoom</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span> <span class="nx">zoom2</span><span class="p">,</span> <span class="nx">zoom</span><span class="p">,</span> <span class="mi">1000</span><span class="p">];</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">zoom</span> <span class="o">&gt;=</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">zoom</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
        <span class="nx">ranges</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">ZOOM_RANGES</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">ZOOM_RANGES</span> <span class="o">=</span> <span class="nx">ranges</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">slider</span><span class="p">.</span><span class="nx">slider</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="o">:</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">ranges</span><span class="p">,</span> <span class="nx">zoom</span><span class="p">),</span> <span class="mi">10</span><span class="p">)});</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">zoom</span><span class="p">(</span><span class="nx">zoom</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">handleInitialState</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="kd">var</span> <span class="nx">initialRouteMatch</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">loadURL</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">initialRouteMatch</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">opts</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">options</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;ViewDocument&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">note</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">pageSet</span><span class="p">.</span><span class="nx">showAnnotation</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">byId</span><span class="p">[</span><span class="nx">opts</span><span class="p">.</span><span class="nx">note</span><span class="p">]);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">page</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">jump</span><span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">page</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>

<span class="p">};</span>

<span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">DV</span><span class="p">.</span><span class="nx">Schema</span><span class="p">.</span><span class="nx">helpers</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">getAnnotationModel</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">annoEl</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">annoId</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">annoEl</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;rel&#39;</span><span class="p">).</span><span class="nx">match</span><span class="p">(</span><span class="sr">/\d+/</span><span class="p">),</span> <span class="mi">10</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">getAnnotation</span><span class="p">(</span><span class="nx">annoId</span><span class="p">);</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-180'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-180">&#182;</a>
        </div>
        <p>Return the annotation Object that connects with the element in the DOM</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">getAnnotationObject</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">annotation</span><span class="p">){</span>

    <span class="kd">var</span> <span class="nx">annotation</span>    <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="nx">annotation</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">annotationId</span>  <span class="o">=</span> <span class="nx">annotation</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/DV\-annotation\-|DV\-listAnnotation\-/</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">pageId</span>        <span class="o">=</span> <span class="nx">annotation</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;div.DV-set&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-id&#39;</span><span class="p">);</span>

    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">(</span><span class="nx">annotationObject</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">pageSet</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">pageId</span><span class="p">].</span><span class="nx">annotations</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">annotationObject</span><span class="p">.</span><span class="nx">id</span> <span class="o">==</span> <span class="nx">annotationId</span><span class="p">){</span></pre></div>
      </td>
    </tr>
    <tr id='section-181'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-181">&#182;</a>
        </div>
        <p>cleanup</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="nx">annotation</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">annotationObject</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>

  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-182'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-182">&#182;</a>
        </div>
        <p>Set of bridges to access annotation methods
Toggle</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">annotationBridgeToggle</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">annotationObject</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getAnnotationObject</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">annotationClassName</span><span class="p">));</span>
    <span class="nx">annotationObject</span><span class="p">.</span><span class="nx">toggle</span><span class="p">();</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-183'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-183">&#182;</a>
        </div>
        <p>Show annotation</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">annotationBridgeShow</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">annotationObject</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getAnnotationObject</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">annotationClassName</span><span class="p">));</span>
    <span class="nx">annotationObject</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-184'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-184">&#182;</a>
        </div>
        <p>Hide annotation</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">annotationBridgeHide</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">annotationObject</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getAnnotationObject</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">annotationClassName</span><span class="p">));</span>
    <span class="nx">annotationObject</span><span class="p">.</span><span class="nx">hide</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-185'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-185">&#182;</a>
        </div>
        <p>Jump to the next annotation</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">annotationBridgeNext</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">annotationObject</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getAnnotationObject</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">annotationClassName</span><span class="p">));</span>
    <span class="nx">annotationObject</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-186'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-186">&#182;</a>
        </div>
        <p>Jump to the previous annotation</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">annotationBridgePrevious</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">annotationObject</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getAnnotationObject</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">annotationClassName</span><span class="p">));</span>
    <span class="nx">annotationObject</span><span class="p">.</span><span class="nx">previous</span><span class="p">();</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-187'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-187">&#182;</a>
        </div>
        <p>Update currentpage text to indicate current annotation</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">setAnnotationPosition</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">_position</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">currentPage</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">_position</span><span class="p">);</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-188'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-188">&#182;</a>
        </div>
        <p>Update active annotation limits</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">setActiveAnnotationLimits</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">annotation</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">annotation</span> <span class="o">=</span> <span class="p">(</span><span class="nx">annotation</span><span class="p">)</span> <span class="o">?</span> <span class="nx">annotation</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotation</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">annotation</span> <span class="o">||</span> <span class="nx">annotation</span> <span class="o">==</span> <span class="kc">null</span><span class="p">){</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">elements</span>  <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">aPage</span>     <span class="o">=</span> <span class="nx">annotation</span><span class="p">.</span><span class="nx">page</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">aEl</span>       <span class="o">=</span> <span class="nx">annotation</span><span class="p">.</span><span class="nx">annotationEl</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">aPosTop</span>   <span class="o">=</span> <span class="nx">annotation</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">top</span> <span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">pages</span><span class="p">.</span><span class="nx">zoomFactor</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">_trackAnnotation</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">trackAnnotation</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">annotation</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;page&#39;</span><span class="p">){</span>
      <span class="nx">_trackAnnotation</span><span class="p">.</span><span class="nx">h</span>          <span class="o">=</span> <span class="nx">aEl</span><span class="p">.</span><span class="nx">outerHeight</span><span class="p">()</span><span class="o">+</span><span class="nx">aPage</span><span class="p">.</span><span class="nx">getOffset</span><span class="p">();</span>
      <span class="nx">_trackAnnotation</span><span class="p">.</span><span class="nx">combined</span>   <span class="o">=</span> <span class="p">(</span><span class="nx">aPage</span><span class="p">.</span><span class="nx">getOffset</span><span class="p">())</span> <span class="o">-</span> <span class="nx">elements</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">height</span><span class="p">();</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="nx">_trackAnnotation</span><span class="p">.</span><span class="nx">h</span>          <span class="o">=</span> <span class="nx">aEl</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span><span class="o">+</span><span class="nx">aPosTop</span><span class="o">-</span><span class="mi">20</span><span class="o">+</span><span class="nx">aPage</span><span class="p">.</span><span class="nx">getOffset</span><span class="p">()</span><span class="o">+</span><span class="nx">aPage</span><span class="p">.</span><span class="nx">getPageNoteHeight</span><span class="p">();</span>
      <span class="nx">_trackAnnotation</span><span class="p">.</span><span class="nx">combined</span>   <span class="o">=</span> <span class="p">(</span><span class="nx">aPosTop</span><span class="o">-</span><span class="mi">20</span><span class="o">+</span><span class="nx">aPage</span><span class="p">.</span><span class="nx">getOffset</span><span class="p">()</span><span class="o">+</span><span class="nx">aPage</span><span class="p">.</span><span class="nx">getPageNoteHeight</span><span class="p">())</span> <span class="o">-</span> <span class="nx">elements</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">height</span><span class="p">();</span>
    <span class="p">}</span>

  <span class="p">}</span>
<span class="p">});</span></pre></div>
      </td>
    </tr>
    <tr id='section-189'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-189">&#182;</a>
        </div>
        <p>Renders the navigation sidebar for chapters and annotations.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">DV</span><span class="p">.</span><span class="nx">Schema</span><span class="p">.</span><span class="nx">helpers</span><span class="p">,</span> <span class="p">{</span>

  <span class="nx">showAnnotations</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">showAnnotations</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">size</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">byId</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">renderViewer</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">doc</span>         <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">pagesHTML</span>   <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">constructPages</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">description</span> <span class="o">=</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">description</span><span class="p">)</span> <span class="o">?</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">description</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">storyURL</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">related_article</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">headerHTML</span>  <span class="o">=</span> <span class="nx">JST</span><span class="p">.</span><span class="nx">header</span><span class="p">({</span>
      <span class="nx">options</span>     <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">options</span><span class="p">,</span>
      <span class="nx">id</span>          <span class="o">:</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
      <span class="nx">story_url</span>   <span class="o">:</span> <span class="nx">storyURL</span><span class="p">,</span>
      <span class="nx">title</span>       <span class="o">:</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">title</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span>
    <span class="p">});</span>
    <span class="kd">var</span> <span class="nx">footerHTML</span> <span class="o">=</span> <span class="nx">JST</span><span class="p">.</span><span class="nx">footer</span><span class="p">({</span><span class="nx">options</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">options</span><span class="p">});</span>
    <span class="kd">var</span> <span class="nx">sidebarLeftHTML</span> <span class="o">=</span> <span class="nx">JST</span><span class="p">.</span><span class="nx">sidebarLeft</span><span class="p">({</span><span class="nx">options</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">options</span><span class="p">,</span> <span class="nx">descriptionContainer</span><span class="o">:</span> <span class="nx">JST</span><span class="p">.</span><span class="nx">descriptionContainer</span><span class="p">({</span> <span class="nx">description</span><span class="o">:</span> <span class="nx">description</span><span class="p">})});</span>
    <span class="kd">var</span> <span class="nx">sidebarRightHTML</span> <span class="o">=</span> <span class="nx">JST</span><span class="p">.</span><span class="nx">sidebarRight</span><span class="p">({</span><span class="nx">options</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">options</span><span class="p">});</span>

    <span class="kd">var</span> <span class="nx">pdfURL</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">pdf</span><span class="p">;</span>
    <span class="nx">pdfURL</span> <span class="o">=</span> <span class="nx">pdfURL</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">pdf</span> <span class="o">!==</span> <span class="kc">false</span> <span class="o">?</span> <span class="s1">&#39;&lt;a target=&quot;_blank&quot; href=&quot;&#39;</span> <span class="o">+</span> <span class="nx">pdfURL</span> <span class="o">+</span> <span class="s1">&#39;&quot;&gt;Original Document (PDF) &amp;raquo;&lt;/a&gt;&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    
    <span class="kd">var</span> <span class="nx">contributorList</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">contributor</span> <span class="o">+</span><span class="s1">&#39;, &#39;</span><span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">contributor_organization</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">showAnnotations</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">showAnnotations</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">printNotesURL</span> <span class="o">=</span> <span class="p">(</span><span class="nx">showAnnotations</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">print_annotations</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">viewerOptions</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">options</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">options</span><span class="p">,</span>
      <span class="nx">pages</span><span class="o">:</span> <span class="nx">pagesHTML</span><span class="p">,</span>
      <span class="nx">header</span><span class="o">:</span> <span class="nx">headerHTML</span><span class="p">,</span>
      <span class="nx">footer</span><span class="o">:</span> <span class="nx">footerHTML</span><span class="p">,</span>
      <span class="nx">sidebar_left</span><span class="o">:</span> <span class="nx">sidebarLeftHTML</span><span class="p">,</span>
      <span class="nx">sidebar_right</span><span class="o">:</span> <span class="nx">sidebarRightHTML</span><span class="p">,</span>
      <span class="nx">pdf_url</span><span class="o">:</span> <span class="nx">pdfURL</span><span class="p">,</span>
      <span class="nx">print_notes_url</span><span class="o">:</span> <span class="nx">printNotesURL</span><span class="p">,</span>
      <span class="nx">autoZoom</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">zoom</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span>
    <span class="p">};</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">width</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">container</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span>
        <span class="nx">position</span><span class="o">:</span> <span class="s1">&#39;relative&#39;</span><span class="p">,</span>
        <span class="nx">width</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span>
        <span class="nx">height</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">height</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">container</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">container</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">containerEl</span> <span class="o">=</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">(</span><span class="nx">container</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">containerEl</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">throw</span> <span class="s2">&quot;Document Viewer container element not found: &quot;</span> <span class="o">+</span> <span class="nx">container</span><span class="p">;</span>
    <span class="nx">containerEl</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">JST</span><span class="p">.</span><span class="nx">viewer</span><span class="p">(</span><span class="nx">viewerOptions</span><span class="p">));</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-190'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-190">&#182;</a>
        </div>
        <p>If there is no description, no navigation, and no sections, tighten up
the sidebar.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">displayNavigation</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">missing</span> <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="nx">doc</span><span class="p">.</span><span class="nx">description</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">size</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">annotationsById</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">sections</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-supplemental&#39;</span><span class="p">).</span><span class="nx">toggleClass</span><span class="p">(</span><span class="s1">&#39;DV-noNavigation&#39;</span><span class="p">,</span> <span class="nx">missing</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">renderSpecificPageCss</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">classes</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">totalPages</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">classes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;.DV-page-&#39;</span> <span class="o">+</span> <span class="nx">i</span> <span class="o">+</span> <span class="s1">&#39; .DV-pageSpecific-&#39;</span> <span class="o">+</span> <span class="nx">i</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">css</span> <span class="o">=</span> <span class="nx">classes</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; { display: block; }&#39;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">stylesheet</span> <span class="o">=</span> <span class="s1">&#39;&lt;style type=&quot;text/css&quot; media=&quot;all&quot;&gt;\n&#39;</span> <span class="o">+</span> <span class="nx">css</span> <span class="o">+</span><span class="s1">&#39;\n&lt;/style&gt;&#39;</span><span class="p">;</span>
    <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">(</span><span class="s2">&quot;head&quot;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">stylesheet</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">renderNavigation</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">me</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">chapterViews</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">bolds</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">expandIcons</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">expanded</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">navigationExpander</span> <span class="o">=</span> <span class="nx">JST</span><span class="p">.</span><span class="nx">navigationExpander</span><span class="p">({}),</span><span class="nx">nav</span><span class="o">=</span><span class="p">[],</span><span class="nx">notes</span> <span class="o">=</span> <span class="p">[],</span><span class="nx">chapters</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="kd">var</span> <span class="nx">boldsId</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">boldsId</span> <span class="o">||</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">boldsId</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">());</span>

    <span class="cm">/* ---------------------------------------------------- start the nav helper methods */</span>
    <span class="kd">var</span> <span class="nx">getAnnotionsByRange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">rangeStart</span><span class="p">,</span> <span class="nx">rangeEnd</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">annotations</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">rangeStart</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">rangeEnd</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">notes</span><span class="p">[</span><span class="nx">i</span><span class="p">]){</span>
          <span class="nx">annotations</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">notes</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
          <span class="nx">nav</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">annotations</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="kd">var</span> <span class="nx">createChapter</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">chapter</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">selectionRule</span> <span class="o">=</span> <span class="s2">&quot;#DV-selectedChapter-&quot;</span> <span class="o">+</span> <span class="nx">chapter</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot; #DV-chapter-&quot;</span> <span class="o">+</span> <span class="nx">chapter</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>

      <span class="nx">bolds</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">selectionRule</span><span class="o">+</span><span class="s2">&quot; .DV-navChapterTitle&quot;</span><span class="p">);</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">JST</span><span class="p">.</span><span class="nx">chapterNav</span><span class="p">(</span><span class="nx">chapter</span><span class="p">));</span>
    <span class="p">};</span>

    <span class="kd">var</span> <span class="nx">createNavAnnotations</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">annotationIndex</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">renderedAnnotations</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="kd">var</span> <span class="nx">annotations</span> <span class="o">=</span> <span class="nx">me</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">annotationsByPage</span><span class="p">[</span><span class="nx">annotationIndex</span><span class="p">];</span>

      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">j</span><span class="o">&lt;</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">annotation</span> <span class="o">=</span> <span class="nx">annotations</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
        <span class="nx">renderedAnnotations</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">JST</span><span class="p">.</span><span class="nx">annotationNav</span><span class="p">(</span><span class="nx">annotation</span><span class="p">));</span>
        <span class="nx">bolds</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;#DV-selectedAnnotation-&quot;</span> <span class="o">+</span> <span class="nx">annotation</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot; #DV-annotationMarker-&quot;</span> <span class="o">+</span> <span class="nx">annotation</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot; .DV-navAnnotationTitle&quot;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">renderedAnnotations</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="cm">/* ---------------------------------------------------- end the nav helper methods */</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">showAnnotations</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="nx">len</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">totalPages</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">annotationsByPage</span><span class="p">[</span><span class="nx">i</span><span class="p">]){</span>
          <span class="nx">nav</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>   <span class="o">=</span> <span class="nx">createNavAnnotations</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
          <span class="nx">notes</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">nav</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">sections</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">sections</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">sections</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">sections</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">section</span>        <span class="o">=</span> <span class="nx">sections</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="kd">var</span> <span class="nx">nextSection</span>    <span class="o">=</span> <span class="nx">sections</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
        <span class="nx">section</span><span class="p">.</span><span class="nx">id</span>         <span class="o">=</span> <span class="nx">section</span><span class="p">.</span><span class="nx">id</span> <span class="o">||</span> <span class="nx">_</span><span class="p">.</span><span class="nx">uniqueId</span><span class="p">();</span>
        <span class="nx">section</span><span class="p">.</span><span class="nx">pageNumber</span> <span class="o">=</span> <span class="nx">section</span><span class="p">.</span><span class="nx">page</span><span class="p">;</span>
        <span class="nx">section</span><span class="p">.</span><span class="nx">endPage</span>    <span class="o">=</span> <span class="nx">nextSection</span> <span class="o">?</span> <span class="nx">nextSection</span><span class="p">.</span><span class="nx">page</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">totalPages</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">annotations</span>    <span class="o">=</span> <span class="nx">getAnnotionsByRange</span><span class="p">(</span><span class="nx">section</span><span class="p">.</span><span class="nx">pageNumber</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">section</span><span class="p">.</span><span class="nx">endPage</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="nx">annotations</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">section</span><span class="p">.</span><span class="nx">navigationExpander</span>       <span class="o">=</span> <span class="nx">navigationExpander</span><span class="p">;</span>
          <span class="nx">section</span><span class="p">.</span><span class="nx">navigationExpanderClass</span>  <span class="o">=</span> <span class="s1">&#39;DV-hasChildren&#39;</span><span class="p">;</span>
          <span class="nx">section</span><span class="p">.</span><span class="nx">noteViews</span>                <span class="o">=</span> <span class="nx">annotations</span><span class="p">;</span>
          <span class="nx">nav</span><span class="p">[</span><span class="nx">section</span><span class="p">.</span><span class="nx">pageNumber</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>      <span class="o">=</span> <span class="nx">createChapter</span><span class="p">(</span><span class="nx">section</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">section</span><span class="p">.</span><span class="nx">navigationExpanderClass</span>  <span class="o">=</span> <span class="s1">&#39;DV-noChildren&#39;</span><span class="p">;</span>
          <span class="nx">section</span><span class="p">.</span><span class="nx">noteViews</span>                <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
          <span class="nx">section</span><span class="p">.</span><span class="nx">navigationExpander</span>       <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
          <span class="nx">nav</span><span class="p">[</span><span class="nx">section</span><span class="p">.</span><span class="nx">pageNumber</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>      <span class="o">=</span> <span class="nx">createChapter</span><span class="p">(</span><span class="nx">section</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-191'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-191">&#182;</a>
        </div>
        <p>insert and observe the nav</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="kd">var</span> <span class="nx">navigationView</span> <span class="o">=</span> <span class="nx">nav</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">chaptersContainer</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;div.DV-chaptersContainer&#39;</span><span class="p">);</span>
    <span class="nx">chaptersContainer</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">navigationView</span><span class="p">);</span>
    <span class="nx">chaptersContainer</span><span class="p">.</span><span class="nx">unbind</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="s1">&#39;handleNavigation&#39;</span><span class="p">));</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">sections</span><span class="p">.</span><span class="nx">length</span> <span class="o">||</span> <span class="nx">_</span><span class="p">.</span><span class="nx">size</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">annotationsById</span><span class="p">)</span> <span class="o">?</span>
       <span class="nx">chaptersContainer</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span> <span class="o">:</span> <span class="nx">chaptersContainer</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">displayNavigation</span><span class="p">();</span>

    <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;#DV-navigationBolds-&#39;</span> <span class="o">+</span> <span class="nx">boldsId</span><span class="p">,</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">(</span><span class="s2">&quot;head&quot;</span><span class="p">)).</span><span class="nx">remove</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">boldsContents</span> <span class="o">=</span> <span class="nx">bolds</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; { font-weight:bold; color:#000 !important; }&#39;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">navStylesheet</span> <span class="o">=</span> <span class="s1">&#39;&lt;style id=&quot;DV-navigationBolds-&#39;</span> <span class="o">+</span> <span class="nx">boldsId</span> <span class="o">+</span> <span class="s1">&#39;&quot; type=&quot;text/css&quot; media=&quot;screen,print&quot;&gt;\n&#39;</span> <span class="o">+</span> <span class="nx">boldsContents</span> <span class="o">+</span><span class="s1">&#39;\n&lt;/style&gt;&#39;</span><span class="p">;</span>
    <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">(</span><span class="s2">&quot;head&quot;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">navStylesheet</span><span class="p">);</span>
    <span class="nx">chaptersContainer</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-192'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-192">&#182;</a>
        </div>
        <p>Hide or show all of the components on the page that may or may not be
present, depending on what the document provides.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">renderComponents</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-193'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-193">&#182;</a>
        </div>
        <p>Hide the overflow of the body, unless we&rsquo;re positioned.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="kd">var</span> <span class="nx">containerEl</span> <span class="o">=</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">container</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">position</span> <span class="o">=</span> <span class="nx">containerEl</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">position</span> <span class="o">!=</span> <span class="s1">&#39;relative&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">position</span> <span class="o">!=</span> <span class="s1">&#39;absolute&#39;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">fixedSize</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">(</span><span class="s2">&quot;html, body&quot;</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span><span class="nx">overflow</span> <span class="o">:</span> <span class="s1">&#39;hidden&#39;</span><span class="p">});</span></pre></div>
      </td>
    </tr>
    <tr id='section-194'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-194">&#182;</a>
        </div>
        <p>Hide the border, if we&rsquo;re a full-screen viewer in the body tag.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">containerEl</span><span class="p">.</span><span class="nx">offset</span><span class="p">().</span><span class="nx">top</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span><span class="nx">border</span><span class="o">:</span> <span class="mi">0</span><span class="p">});</span>
      <span class="p">}</span>
    <span class="p">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-195'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-195">&#182;</a>
        </div>
        <p>Hide and show navigation flags:</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="kd">var</span> <span class="nx">showAnnotations</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">showAnnotations</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">showPages</span>       <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">totalPages</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">showSearch</span>      <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">search</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
                          <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">text</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
                          <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">width</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">width</span> <span class="o">&gt;=</span> <span class="mi">540</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">noFooter</span> <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="nx">showAnnotations</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">showPages</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">showSearch</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">sidebar</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-196'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-196">&#182;</a>
        </div>
        <p>Hide annotations, if there are none:</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="kd">var</span> <span class="nx">$annotationsView</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-annotationView&#39;</span><span class="p">);</span>
    <span class="nx">$annotationsView</span><span class="p">[</span><span class="nx">showAnnotations</span> <span class="o">?</span> <span class="s1">&#39;show&#39;</span> <span class="o">:</span> <span class="s1">&#39;hide&#39;</span><span class="p">]();</span></pre></div>
      </td>
    </tr>
    <tr id='section-197'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-197">&#182;</a>
        </div>
        <p>Hide the text tab, if it&rsquo;s disabled.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">showSearch</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;DV-searchable&#39;</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;input.DV-searchInput&#39;</span><span class="p">,</span> <span class="nx">containerEl</span><span class="p">).</span><span class="nx">placeholder</span><span class="p">({</span>
        <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;Search&#39;</span><span class="p">,</span>
        <span class="nx">clearClassName</span><span class="o">:</span> <span class="s1">&#39;DV-searchInput-show-search-cancel&#39;</span>
      <span class="p">});</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-textView&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
    <span class="p">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-198'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-198">&#182;</a>
        </div>
        <p>Hide the Pages tab if there is only 1 page in the document.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">showPages</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-thumbnailsView&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
    <span class="p">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-199'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-199">&#182;</a>
        </div>
        <p>Hide the Documents tab if it&rsquo;s the only tab left.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">showAnnotations</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">showPages</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">showSearch</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-views&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">api</span><span class="p">.</span><span class="nx">roundTabCorners</span><span class="p">();</span></pre></div>
      </td>
    </tr>
    <tr id='section-200'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-200">&#182;</a>
        </div>
        <p>Remove and re-render the nav controls.
Don&rsquo;t show the nav controls if there&rsquo;s no sidebar, and it&rsquo;s a one-page doc.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-navControls&#39;</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">showPages</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">navControls</span> <span class="o">=</span> <span class="nx">JST</span><span class="p">.</span><span class="nx">navControls</span><span class="p">({</span>
        <span class="nx">totalPages</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">totalPages</span><span class="p">,</span>
        <span class="nx">totalAnnotations</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">totalAnnotations</span>
      <span class="p">});</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-navControlsContainer&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">navControls</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-fullscreenControl&#39;</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">canonicalURL</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">fullscreenControl</span> <span class="o">=</span> <span class="nx">JST</span><span class="p">.</span><span class="nx">fullscreenControl</span><span class="p">({});</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">noFooter</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-collapsibleControls&#39;</span><span class="p">).</span><span class="nx">prepend</span><span class="p">(</span><span class="nx">fullscreenControl</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;DV-hideFooter&#39;</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-fullscreenContainer&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">fullscreenControl</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">sidebar</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-sidebar-left&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-sidebar-right&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
    <span class="p">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-201'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-201">&#182;</a>
        </div>
        <p>Check if the zoom is showing, and if not, shorten the width of search</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="nx">_</span><span class="p">.</span><span class="nx">defer</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">((</span><span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">700</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">showAnnotations</span> <span class="o">||</span> <span class="nx">showPages</span> <span class="o">||</span> <span class="nx">showSearch</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-controls&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;DV-narrowControls&#39;</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">},</span> <span class="k">this</span><span class="p">));</span></pre></div>
      </td>
    </tr>
    <tr id='section-202'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-202">&#182;</a>
        </div>
        <p>Set the currentPage element reference.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">currentPage</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;span.DV-currentPage&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">setPageIndex</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">currentIndex</span><span class="p">());</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-203'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-203">&#182;</a>
        </div>
        <p>Reset the view state to a baseline, when transitioning between views.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">reset</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">resetNavigationState</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">cleanUpSearch</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">pageSet</span><span class="p">.</span><span class="nx">cleanUp</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">removeObserver</span><span class="p">(</span><span class="s1">&#39;drawPages&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">dragReporter</span><span class="p">.</span><span class="nx">unBind</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="p">}</span>

<span class="p">});</span>
<span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">DV</span><span class="p">.</span><span class="nx">Schema</span><span class="p">.</span><span class="nx">helpers</span><span class="p">,{</span>
  <span class="nx">showAnnotationEdit</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">annoEl</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">annotationClassName</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">area</span>   <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-annotationTextArea&#39;</span><span class="p">,</span> <span class="nx">annoEl</span><span class="p">);</span>
    <span class="nx">annoEl</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;DV-editing&#39;</span><span class="p">);</span>
    <span class="nx">area</span><span class="p">.</span><span class="nx">focus</span><span class="p">();</span>
  <span class="p">},</span>
  <span class="nx">cancelAnnotationEdit</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">annoEl</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">annotationClassName</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">anno</span>   <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getAnnotationModel</span><span class="p">(</span><span class="nx">annoEl</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-annotationTitleInput&#39;</span><span class="p">,</span> <span class="nx">annoEl</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">anno</span><span class="p">.</span><span class="nx">title</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-annotationTextArea&#39;</span><span class="p">,</span> <span class="nx">annoEl</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">anno</span><span class="p">.</span><span class="nx">text</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">anno</span><span class="p">.</span><span class="nx">unsaved</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">removeAnnotation</span><span class="p">(</span><span class="nx">anno</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">annoEl</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;DV-editing&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">saveAnnotation</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">option</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">annoEl</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">annotationClassName</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">anno</span>   <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getAnnotationModel</span><span class="p">(</span><span class="nx">annoEl</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">anno</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="nx">anno</span><span class="p">.</span><span class="nx">title</span>     <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-annotationTitleInput&#39;</span><span class="p">,</span> <span class="nx">annoEl</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
    <span class="nx">anno</span><span class="p">.</span><span class="nx">text</span>      <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-annotationTextArea&#39;</span><span class="p">,</span> <span class="nx">annoEl</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
    <span class="nx">anno</span><span class="p">.</span><span class="nx">owns_note</span> <span class="o">=</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">unsaved</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">owns_note</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">anno</span><span class="p">.</span><span class="nx">owns_note</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">anno</span><span class="p">.</span><span class="nx">author</span>              <span class="o">=</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">author</span> <span class="o">||</span> <span class="nx">dc</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
      <span class="nx">anno</span><span class="p">.</span><span class="nx">author_organization</span> <span class="o">=</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">author_organization</span> <span class="o">||</span> <span class="p">(</span><span class="nx">dc</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">isReal</span> <span class="o">&amp;&amp;</span> <span class="nx">dc</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">organization</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span><span class="s1">&#39;DV-saveAnnotationDraft&#39;</span><span class="p">))</span>  <span class="nx">anno</span><span class="p">.</span><span class="nx">access</span> <span class="o">=</span> <span class="s1">&#39;exclusive&#39;</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">annoEl</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span><span class="s1">&#39;DV-accessExclusive&#39;</span><span class="p">))</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">access</span> <span class="o">=</span> <span class="s1">&#39;public&#39;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">option</span> <span class="o">==</span> <span class="s1">&#39;onlyIfText&#39;</span> <span class="o">&amp;&amp;</span>
        <span class="p">(</span><span class="o">!</span><span class="nx">anno</span><span class="p">.</span><span class="nx">title</span> <span class="o">||</span> <span class="nx">anno</span><span class="p">.</span><span class="nx">title</span> <span class="o">==</span> <span class="s1">&#39;Untitled Note&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
        <span class="o">!</span><span class="nx">anno</span><span class="p">.</span><span class="nx">text</span> <span class="o">&amp;&amp;</span>
        <span class="o">!</span><span class="nx">anno</span><span class="p">.</span><span class="nx">server_id</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">removeAnnotation</span><span class="p">(</span><span class="nx">anno</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">annoEl</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;DV-editing&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">fireSaveCallbacks</span><span class="p">(</span><span class="nx">anno</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">api</span><span class="p">.</span><span class="nx">redraw</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">activeAnnotation</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">pageSet</span><span class="p">.</span><span class="nx">showAnnotation</span><span class="p">(</span><span class="nx">anno</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">deleteAnnotation</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">annoEl</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">annotationClassName</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">anno</span>   <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getAnnotationModel</span><span class="p">(</span><span class="nx">annoEl</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">removeAnnotation</span><span class="p">(</span><span class="nx">anno</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">fireDeleteCallbacks</span><span class="p">(</span><span class="nx">anno</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
<span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">DV</span><span class="p">.</span><span class="nx">Schema</span><span class="p">.</span><span class="nx">helpers</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">resetNavigationState</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">elements</span>                      <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">elements</span><span class="p">.</span><span class="nx">chaptersContainer</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="nx">elements</span><span class="p">.</span><span class="nx">chaptersContainer</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">id</span>  <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">elements</span><span class="p">.</span><span class="nx">navigation</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>        <span class="nx">elements</span><span class="p">.</span><span class="nx">navigation</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">id</span>         <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">setActiveChapter</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">chapterId</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">chapterId</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">chaptersContainer</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;DV-selectedChapter-&#39;</span><span class="o">+</span><span class="nx">chapterId</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">setActiveAnnotationInNav</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">annotationId</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">annotationId</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">navigation</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;DV-selectedAnnotation-&#39;</span><span class="o">+</span><span class="nx">annotationId</span><span class="p">);</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">navigation</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">DV</span><span class="p">.</span><span class="nx">Schema</span><span class="p">.</span><span class="nx">helpers</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">getSearchResponse</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">query</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">handleResponse</span> <span class="o">=</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">searchResponse</span> <span class="o">=</span> <span class="nx">response</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">hasResults</span> <span class="o">=</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">results</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="kc">false</span><span class="p">;</span>

      <span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">hasResults</span> <span class="o">?</span> <span class="s1">&#39;of &#39;</span><span class="o">+</span><span class="nx">response</span><span class="p">.</span><span class="nx">results</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">:</span> <span class="s1">&#39; &#39;</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;span.DV-totalSearchResult&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;span.DV-searchQuery&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">query</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">hasResults</span><span class="p">)</span> <span class="p">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-204'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-204">&#182;</a>
        </div>
        <p>this.viewer.history.save(&lsquo;search/p&rsquo;+response.results[0]+&lsquo;/&rsquo;+response.query);</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>        <span class="kd">var</span> <span class="nx">currentPage</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">currentPage</span><span class="p">();</span>
        <span class="kd">var</span> <span class="nx">page</span> <span class="o">=</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">include</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">results</span><span class="p">,</span> <span class="nx">currentPage</span><span class="p">))</span> <span class="o">?</span> <span class="nx">currentPage</span> <span class="o">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">loadText</span><span class="p">(</span><span class="nx">page</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">highlightSearchResponses</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">highlightSearchResponses</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">},</span> <span class="k">this</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">failResponse</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-currentSearchResult&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;Search is not available at this time&#39;</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;span.DV-searchQuery&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-searchResults&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;DV-noResults&#39;</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="kd">var</span> <span class="nx">searchURI</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">search</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;{query}&#39;</span><span class="p">,</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">query</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">isCrossDomain</span><span class="p">(</span><span class="nx">searchURI</span><span class="p">))</span> <span class="nx">searchURI</span> <span class="o">+=</span> <span class="s1">&#39;&amp;callback=?&#39;</span><span class="p">;</span>
    <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span><span class="nx">url</span> <span class="o">:</span> <span class="nx">searchURI</span><span class="p">,</span> <span class="nx">dataType</span> <span class="o">:</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="nx">success</span> <span class="o">:</span> <span class="nx">handleResponse</span><span class="p">,</span> <span class="nx">error</span> <span class="o">:</span> <span class="nx">failResponse</span><span class="p">});</span>
  <span class="p">},</span>
  <span class="nx">acceptInputCallBack</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">pageIndex</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">currentPage</span><span class="p">.</span><span class="nx">text</span><span class="p">(),</span><span class="mi">10</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-205'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-205">&#182;</a>
        </div>
        <p>sanitize input</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="nx">pageIndex</span>       <span class="o">=</span> <span class="p">(</span><span class="nx">pageIndex</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="nx">pageIndex</span><span class="p">;</span>
    <span class="nx">pageIndex</span>       <span class="o">=</span> <span class="p">(</span><span class="nx">pageIndex</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="nx">pageIndex</span><span class="p">;</span>
    <span class="nx">pageIndex</span>       <span class="o">=</span> <span class="p">(</span><span class="nx">pageIndex</span><span class="o">+</span><span class="mi">1</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">totalPages</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">totalPages</span><span class="o">-</span><span class="mi">1</span> <span class="o">:</span> <span class="nx">pageIndex</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">pageNumber</span>  <span class="o">=</span> <span class="nx">pageIndex</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">currentPage</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">pageNumber</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-pageNumberContainer input&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">pageNumber</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">state</span> <span class="o">===</span> <span class="s1">&#39;ViewDocument&#39;</span> <span class="o">||</span>
       <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">state</span> <span class="o">===</span> <span class="s1">&#39;ViewThumbnails&#39;</span><span class="p">){</span></pre></div>
      </td>
    </tr>
    <tr id='section-206'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-206">&#182;</a>
        </div>
        <p>this.viewer.history.save(&lsquo;document/p&rsquo;+pageNumber);</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">jump</span><span class="p">(</span><span class="nx">pageIndex</span><span class="p">);</span>
    <span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">state</span> <span class="o">===</span> <span class="s1">&#39;ViewText&#39;</span><span class="p">){</span></pre></div>
      </td>
    </tr>
    <tr id='section-207'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-207">&#182;</a>
        </div>
        <p>this.viewer.history.save(&lsquo;text/p&rsquo;+pageNumber);</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">loadText</span><span class="p">(</span><span class="nx">pageIndex</span><span class="p">);</span>
    <span class="p">}</span>

  <span class="p">},</span>
  <span class="nx">highlightSearchResponses</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>

    <span class="kd">var</span> <span class="nx">viewer</span>    <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">response</span>  <span class="o">=</span> <span class="nx">viewer</span><span class="p">.</span><span class="nx">searchResponse</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">results</span>         <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">results</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">currentResultEl</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-currentSearchResult&#39;</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">results</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
      <span class="nx">currentResultEl</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;No Results&#39;</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-searchResults&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;DV-noResults&#39;</span><span class="p">);</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-searchResults&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;DV-noResults&#39;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">response</span><span class="p">.</span><span class="nx">results</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
      <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">currentPage</span><span class="p">()</span> <span class="o">===</span> <span class="nx">response</span><span class="p">.</span><span class="nx">results</span><span class="p">[</span><span class="nx">i</span><span class="p">]){</span>
        <span class="nx">currentResultEl</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;Page &#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-208'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-208">&#182;</a>
        </div>
        <p>Replaces spaces in query with <code>\s+</code> to match newlines in textContent,
escape regex char contents (like &ldquo;()&rdquo;), and only match on word boundaries.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="kd">var</span> <span class="nx">query</span>             <span class="o">=</span> <span class="s1">&#39;\\b&#39;</span> <span class="o">+</span> <span class="nx">response</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[-[\]{}()*+?.,\\^$|#]/g</span><span class="p">,</span> <span class="s2">&quot;\\$&amp;&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\s+/g</span><span class="p">,</span> <span class="s1">&#39;\\s+&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;\\b&#39;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">textContent</span>       <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-textContents&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">currentPageText</span>   <span class="o">=</span> <span class="nx">textContent</span><span class="p">.</span><span class="nx">text</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">pattern</span>           <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span><span class="s2">&quot;ig&quot;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">replacement</span>       <span class="o">=</span> <span class="nx">currentPageText</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">pattern</span><span class="p">,</span><span class="s1">&#39;&lt;span class=&quot;DV-searchMatch&quot;&gt;$&amp;&lt;/span&gt;&#39;</span><span class="p">);</span>

    <span class="nx">textContent</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">replacement</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">highlightIndex</span> <span class="o">=</span> <span class="p">(</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">toHighLight</span><span class="p">)</span> <span class="o">?</span> <span class="nx">viewer</span><span class="p">.</span><span class="nx">toHighLight</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">highlightMatch</span><span class="p">(</span><span class="nx">highlightIndex</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-209'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-209">&#182;</a>
        </div>
        <p>cleanup</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="nx">currentResultEl</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="nx">textContent</span>     <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-210'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-210">&#182;</a>
        </div>
        <p>Highlight a single instance of an entity on the page. Make sure to
convert into proper UTF8 before trying to get the entity length, and
then back into UTF16 again.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">highlightEntity</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">offset</span><span class="p">,</span> <span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-searchResults&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;DV-noResults&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">textContent</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-textContents&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">text</span>        <span class="o">=</span> <span class="nx">textContent</span><span class="p">.</span><span class="nx">text</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">pre</span>         <span class="o">=</span> <span class="nx">text</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">offset</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">entity</span>      <span class="o">=</span> <span class="nx">text</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">offset</span><span class="p">,</span> <span class="nx">length</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">post</span>        <span class="o">=</span> <span class="nx">text</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">offset</span> <span class="o">+</span> <span class="nx">length</span><span class="p">);</span>
    <span class="nx">text</span>            <span class="o">=</span> <span class="p">[</span><span class="nx">pre</span><span class="p">,</span> <span class="s1">&#39;&lt;span class=&quot;DV-searchMatch&quot;&gt;&#39;</span><span class="p">,</span> <span class="nx">entity</span><span class="p">,</span> <span class="s1">&#39;&lt;/span&gt;&#39;</span><span class="p">,</span> <span class="nx">post</span><span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
    <span class="nx">textContent</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">highlightMatch</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">highlightMatch</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">highlightsOnThisPage</span>   <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-textContents span.DV-searchMatch&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">highlightsOnThisPage</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">currentPageIndex</span>    <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getCurrentSearchPageIndex</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">toHighLight</span>         <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">toHighLight</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">toHighLight</span><span class="p">){</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">toHighLight</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">toHighLight</span> <span class="o">===</span> <span class="s1">&#39;last&#39;</span><span class="p">){</span>
          <span class="nx">index</span> <span class="o">=</span> <span class="nx">highlightsOnThisPage</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">toHighLight</span> <span class="o">===</span> <span class="s1">&#39;first&#39;</span><span class="p">){</span>
          <span class="nx">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
          <span class="nx">index</span> <span class="o">=</span> <span class="nx">toHighLight</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="nx">toHighLight</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">searchResponse</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">searchResponse</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">searchResponse</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">index</span> <span class="o">===</span> <span class="p">(</span><span class="nx">highlightsOnThisPage</span><span class="p">.</span><span class="nx">length</span><span class="p">)){</span>

        <span class="k">if</span><span class="p">(</span><span class="nx">searchResponse</span><span class="p">.</span><span class="nx">results</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="nx">currentPageIndex</span><span class="o">+</span><span class="mi">1</span><span class="p">){</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">toHighLight</span> <span class="o">=</span> <span class="s1">&#39;first&#39;</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">loadText</span><span class="p">(</span><span class="nx">searchResponse</span><span class="p">.</span><span class="nx">results</span><span class="p">[</span><span class="nx">currentPageIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">highlightSearchResponses</span><span class="p">);</span>

        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">index</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">currentPageIndex</span><span class="o">-</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">){</span>
          <span class="k">return</span>  <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">toHighLight</span> <span class="o">=</span> <span class="s1">&#39;last&#39;</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">loadText</span><span class="p">(</span><span class="nx">searchResponse</span><span class="p">.</span><span class="nx">results</span><span class="p">[</span><span class="nx">currentPageIndex</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">highlightSearchResponses</span><span class="p">);</span>

        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">highlightsOnThisPage</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;DV-highlightedMatch&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-textContents span.DV-searchMatch:eq(&#39;</span><span class="o">+</span><span class="nx">index</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">);</span>
    <span class="nx">match</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;DV-highlightedMatch&#39;</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nb">window</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">scrollTop</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">position</span><span class="p">().</span><span class="nx">top</span> <span class="o">-</span> <span class="mi">50</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">searchResponse</span><span class="p">)</span> <span class="nx">searchResponse</span><span class="p">.</span><span class="nx">highlighted</span> <span class="o">=</span> <span class="nx">index</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-211'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-211">&#182;</a>
        </div>
        <p>cleanup</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="nx">highlightsOnThisPage</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">getCurrentSearchPageIndex</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">searchResponse</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">searchResponse</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">searchResponse</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">docModel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="nx">len</span> <span class="o">=</span> <span class="nx">searchResponse</span><span class="p">.</span><span class="nx">results</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">len</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">searchResponse</span><span class="p">.</span><span class="nx">results</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">===</span> <span class="nx">docModel</span><span class="p">.</span><span class="nx">currentPage</span><span class="p">()){</span>
        <span class="k">return</span> <span class="nx">i</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">highlightPreviousMatch</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">highlightMatch</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">searchResponse</span><span class="p">.</span><span class="nx">highlighted</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">highlightNextMatch</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">highlightMatch</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">searchResponse</span><span class="p">.</span><span class="nx">highlighted</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">clearSearch</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">searchInput</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">keyup</span><span class="p">().</span><span class="nx">focus</span><span class="p">();</span>
  <span class="p">},</span>

  <span class="nx">showEntity</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;span.DV-totalSearchResult&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;span.DV-searchQuery&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;span.DV-currentSearchResult&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;Searching&quot;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">loadText</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">currentIndex</span><span class="p">(),</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">highlightEntity</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">helpers</span><span class="p">,</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">length</span><span class="p">));</span>
  <span class="p">},</span>
  <span class="nx">cleanUpSearch</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">viewer</span>            <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">;</span>
    <span class="nx">viewer</span><span class="p">.</span><span class="nx">searchResponse</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="nx">viewer</span><span class="p">.</span><span class="nx">toHighLight</span>    <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">searchInput</span><span class="p">.</span><span class="nx">keyup</span><span class="p">().</span><span class="nx">blur</span><span class="p">();</span>
  <span class="p">}</span>

<span class="p">});</span>
<span class="nx">DV</span><span class="p">.</span><span class="nx">Schema</span><span class="p">.</span><span class="nx">states</span> <span class="o">=</span> <span class="p">{</span>

  <span class="nx">InitialLoad</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span></pre></div>
      </td>
    </tr>
    <tr id='section-212'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-212">&#182;</a>
        </div>
        <p>If we&rsquo;re in an unsupported browser &hellip; bail.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">unsupportedBrowser</span><span class="p">())</span> <span class="k">return</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-213'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-213">&#182;</a>
        </div>
        <p>Insert the Document Viewer HTML into the DOM.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">renderViewer</span><span class="p">();</span></pre></div>
      </td>
    </tr>
    <tr id='section-214'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-214">&#182;</a>
        </div>
        <p>Assign element references.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">elements</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">elements</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">elements</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">Elements</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-215'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-215">&#182;</a>
        </div>
        <p>Render included components, and hide unused portions of the UI.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">renderComponents</span><span class="p">();</span></pre></div>
      </td>
    </tr>
    <tr id='section-216'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-216">&#182;</a>
        </div>
        <p>Render chapters and notes navigation:</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">renderNavigation</span><span class="p">();</span></pre></div>
      </td>
    </tr>
    <tr id='section-217'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-217">&#182;</a>
        </div>
        <p>Render CSS rules for showing/hiding specific pages:</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">renderSpecificPageCss</span><span class="p">();</span></pre></div>
      </td>
    </tr>
    <tr id='section-218'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-218">&#182;</a>
        </div>
        <p>Instantiate pageset and build accordingly</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">pageSet</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">PageSet</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">pageSet</span><span class="p">.</span><span class="nx">buildPages</span><span class="p">();</span></pre></div>
      </td>
    </tr>
    <tr id='section-219'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-219">&#182;</a>
        </div>
        <p>BindEvents</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">bindEvents</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">positionViewer</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">computeOffsets</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">addObserver</span><span class="p">(</span><span class="s1">&#39;drawPages&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">registerHashChangeEvents</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">dragReporter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">DragReporter</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;.DV-pageCollection&#39;</span><span class="p">,</span><span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">shift</span><span class="p">,</span> <span class="k">this</span><span class="p">),</span> <span class="p">{</span> <span class="nx">ignoreSelector</span><span class="o">:</span> <span class="s1">&#39;.DV-annotationContent&#39;</span> <span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">startCheckTimer</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">handleInitialState</span><span class="p">();</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">defer</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">autoZoomPage</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">));</span>
  <span class="p">},</span>

  <span class="nx">ViewAnnotation</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">reset</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">ensureAnnotationImages</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">activeAnnotationId</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">acceptInput</span><span class="p">.</span><span class="nx">deny</span><span class="p">();</span></pre></div>
      </td>
    </tr>
    <tr id='section-220'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-220">&#182;</a>
        </div>
        <p>Nudge IE to force the annotations to repaint.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">browser</span><span class="p">.</span><span class="nx">msie</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span><span class="nx">zoom</span> <span class="o">:</span> <span class="mi">0</span><span class="p">});</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">css</span><span class="p">({</span><span class="nx">zoom</span> <span class="o">:</span> <span class="mi">1</span><span class="p">});</span>
    <span class="p">}</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">toggleContent</span><span class="p">(</span><span class="s1">&#39;viewAnnotations&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">compiled</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">ViewDocument</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">reset</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">addObserver</span><span class="p">(</span><span class="s1">&#39;drawPages&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">dragReporter</span><span class="p">.</span><span class="nx">setBinding</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">mouseleave</span><span class="p">(</span><span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">dragReporter</span><span class="p">.</span><span class="nx">stop</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">dragReporter</span><span class="p">));</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">acceptInput</span><span class="p">.</span><span class="nx">allow</span><span class="p">();</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">toggleContent</span><span class="p">(</span><span class="s1">&#39;viewDocument&#39;</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">setActiveChapter</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">chapters</span><span class="p">.</span><span class="nx">getChapterId</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">currentIndex</span><span class="p">()));</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">jump</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">currentIndex</span><span class="p">());</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">ViewEntity</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">reset</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">toggleContent</span><span class="p">(</span><span class="s1">&#39;viewSearch&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">showEntity</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">length</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">ViewSearch</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">reset</span><span class="p">();</span>

    <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">searchInput</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">searchInput</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="nx">searchRequest</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">searchRequest</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">searchInput</span><span class="p">.</span><span class="nx">val</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">getSearchResponse</span><span class="p">(</span><span class="nx">searchRequest</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">acceptInput</span><span class="p">.</span><span class="nx">deny</span><span class="p">();</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">toggleContent</span><span class="p">(</span><span class="s1">&#39;viewSearch&#39;</span><span class="p">);</span>

    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">ViewText</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">reset</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">acceptInput</span><span class="p">.</span><span class="nx">allow</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">pageSet</span><span class="p">.</span><span class="nx">zoomText</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">toggleContent</span><span class="p">(</span><span class="s1">&#39;viewText&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">loadText</span><span class="p">();</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">ViewThumbnails</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">reset</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">toggleContent</span><span class="p">(</span><span class="s1">&#39;viewThumbnails&#39;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">thumbnails</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">Thumbnails</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">thumbnails</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>

<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-221'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-221">&#182;</a>
        </div>
        <p>The API references it&rsquo;s viewer.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">Api</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">viewer</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span> <span class="o">=</span> <span class="nx">viewer</span><span class="p">;</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-222'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-222">&#182;</a>
        </div>
        <p>Set up the API class.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">Api</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span></pre></div>
      </td>
    </tr>
    <tr id='section-223'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-223">&#182;</a>
        </div>
        <p>Return the current page of the document.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">currentPage</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">currentPage</span><span class="p">();</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-224'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-224">&#182;</a>
        </div>
        <p>Set the current page of the document.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">setCurrentPage</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">page</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">jump</span><span class="p">(</span><span class="nx">page</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-225'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-225">&#182;</a>
        </div>
        <p>Register a callback for when the page is changed.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">onPageChange</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">onPageChangeCallbacks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-226'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-226">&#182;</a>
        </div>
        <p>Return the page number for one of the three physical page DOM elements, by id:</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">getPageNumberForId</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">page</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">pageSet</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>
    <span class="k">return</span> <span class="nx">page</span><span class="p">.</span><span class="nx">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-227'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-227">&#182;</a>
        </div>
        <p>Get the document&rsquo;s canonical schema</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">getSchema</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-228'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-228">&#182;</a>
        </div>
        <p>Get the document&rsquo;s canonical ID.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">getId</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-229'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-229">&#182;</a>
        </div>
        <p>Get the document&rsquo;s numerical ID.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">getModelId</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">parseInt</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getId</span><span class="p">(),</span> <span class="mi">10</span><span class="p">);</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-230'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-230">&#182;</a>
        </div>
        <p>Return the current zoom factor of the document.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">currentZoom</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">zoomLevel</span> <span class="o">/</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">ZOOM_RANGES</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-231'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-231">&#182;</a>
        </div>
        <p>Return the current zoom factor of the document relative to the base zoom.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">relativeZoom</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">models</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">zoom</span>   <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentZoom</span><span class="p">();</span>
    <span class="k">return</span> <span class="nx">zoom</span> <span class="o">*</span> <span class="p">(</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">ZOOM_RANGES</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="nx">models</span><span class="p">.</span><span class="nx">pages</span><span class="p">.</span><span class="nx">BASE_WIDTH</span><span class="p">);</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-232'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-232">&#182;</a>
        </div>
        <p>Return the total number of pages in the document.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">numberOfPages</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">totalPages</span><span class="p">;</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-233'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-233">&#182;</a>
        </div>
        <p>Return the name of the contributor, if available.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">getContributor</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">contributor</span><span class="p">;</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-234'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-234">&#182;</a>
        </div>
        <p>Return the name of the contributing organization, if available.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">getContributorOrganization</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">contributor_organization</span><span class="p">;</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-235'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-235">&#182;</a>
        </div>
        <p>Change the documents' sections, re-rendering the navigation. &ldquo;sections&rdquo;
should be an array of sections in the canonical format:
{title: &ldquo;Chapter 1&rdquo;, pages: &ldquo;1-12&rdquo;}</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">setSections</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">sections</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">sections</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">sortBy</span><span class="p">(</span><span class="nx">sections</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">){</span> <span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nx">page</span><span class="p">;</span> <span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">sections</span> <span class="o">=</span> <span class="nx">sections</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">chapters</span><span class="p">.</span><span class="nx">loadChapters</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">redraw</span><span class="p">();</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-236'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-236">&#182;</a>
        </div>
        <p>Get a list of every section in the document.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">getSections</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">sections</span> <span class="o">||</span> <span class="p">[]);</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-237'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-237">&#182;</a>
        </div>
        <p>Get the document&rsquo;s description.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">getDescription</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">description</span><span class="p">;</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-238'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-238">&#182;</a>
        </div>
        <p>Set the document&rsquo;s description and update the sidebar.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">setDescription</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">desc</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">description</span> <span class="o">=</span> <span class="nx">desc</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-description&#39;</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-navigation&#39;</span><span class="p">).</span><span class="nx">prepend</span><span class="p">(</span><span class="nx">JST</span><span class="p">.</span><span class="nx">descriptionContainer</span><span class="p">({</span><span class="nx">description</span><span class="o">:</span> <span class="nx">desc</span><span class="p">}));</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">displayNavigation</span><span class="p">();</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-239'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-239">&#182;</a>
        </div>
        <p>Get the document&rsquo;s related article url.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">getRelatedArticle</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">related_article</span><span class="p">;</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-240'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-240">&#182;</a>
        </div>
        <p>Set the document&rsquo;s related article url.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">setRelatedArticle</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">related_article</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-storyLink a&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">({</span><span class="nx">href</span> <span class="o">:</span> <span class="nx">url</span><span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-storyLink&#39;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">(</span><span class="o">!!</span><span class="nx">url</span><span class="p">);</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-241'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-241">&#182;</a>
        </div>
        <p>Get the document&rsquo;s published url.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">getPublishedUrl</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">published_url</span><span class="p">;</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-242'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-242">&#182;</a>
        </div>
        <p>Set the document&rsquo;s published url.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">setPublishedUrl</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">published_url</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-243'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-243">&#182;</a>
        </div>
        <p>Get the document&rsquo;s title.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">getTitle</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-244'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-244">&#182;</a>
        </div>
        <p>Set the document&rsquo;s title.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">setTitle</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">title</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="nx">title</span><span class="p">;</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="nx">title</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">getSource</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">source</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">setSource</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">source</span> <span class="o">=</span> <span class="nx">source</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">getPageText</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pageNumber</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nx">text</span><span class="p">[</span><span class="nx">pageNumber</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-245'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-245">&#182;</a>
        </div>
        <p>Set the page text for the given page of a document in the local cache.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">setPageText</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="nx">pageNumber</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nx">text</span><span class="p">[</span><span class="nx">pageNumber</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">text</span><span class="p">;</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-246'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-246">&#182;</a>
        </div>
        <p>Reset all modified page text to the original values from the server cache.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">resetPageText</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">overwriteOriginal</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">pageText</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nx">text</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">overwriteOriginal</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">originalPageText</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">originalPageText</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">originalPageText</span><span class="p">,</span> <span class="nx">pageNumber</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">pageNumber</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">pageNumber</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">originalPageText</span> <span class="o">!=</span> <span class="nx">pageText</span><span class="p">[</span><span class="nx">pageNumber</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
          <span class="nx">self</span><span class="p">.</span><span class="nx">setPageText</span><span class="p">(</span><span class="nx">originalPageText</span><span class="p">,</span> <span class="nx">pageNumber</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">pageNumber</span> <span class="o">==</span> <span class="nx">self</span><span class="p">.</span><span class="nx">currentPage</span><span class="p">())</span> <span class="p">{</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">loadText</span><span class="p">();</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">openEditor</span> <span class="o">==</span> <span class="s1">&#39;editText&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-textContents&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;contentEditable&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;DV-editing&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-247'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-247">&#182;</a>
        </div>
        <p>Redraw the UI. Call redraw(true) to also redraw annotations and pages.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">redraw</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">redrawAll</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">redrawAll</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">renderAnnotations</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">computeOffsets</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">renderNavigation</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">renderComponents</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">redrawAll</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nb">window</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;DV-coverVisible&#39;</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">pageSet</span><span class="p">.</span><span class="nx">buildPages</span><span class="p">({</span><span class="nx">noNotes</span> <span class="o">:</span> <span class="kc">true</span><span class="p">});</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">pageSet</span><span class="p">.</span><span class="nx">reflowPages</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">},</span>

  <span class="nx">getAnnotationsBySortOrder</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">sortAnnotations</span><span class="p">();</span>
  <span class="p">},</span>

  <span class="nx">getAnnotationsByPageIndex</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">idx</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">getAnnotations</span><span class="p">(</span><span class="nx">idx</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">getAnnotation</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">aid</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">getAnnotation</span><span class="p">(</span><span class="nx">aid</span><span class="p">);</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-248'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-248">&#182;</a>
        </div>
        <p>Add a new annotation to the document, prefilled to any extent.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">addAnnotation</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">anno</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">anno</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nx">loadAnnotation</span><span class="p">(</span><span class="nx">anno</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">sortAnnotations</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">redraw</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">pageSet</span><span class="p">.</span><span class="nx">showAnnotation</span><span class="p">(</span><span class="nx">anno</span><span class="p">,</span> <span class="p">{</span><span class="nx">active</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">edit</span> <span class="o">:</span> <span class="kc">true</span><span class="p">});</span>
    <span class="k">return</span> <span class="nx">anno</span><span class="p">;</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-249'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-249">&#182;</a>
        </div>
        <p>Register a callback for when an annotation is saved.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">onAnnotationSave</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">saveCallbacks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-250'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-250">&#182;</a>
        </div>
        <p>Register a callback for when an annotation is deleted.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">onAnnotationDelete</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">annotations</span><span class="p">.</span><span class="nx">deleteCallbacks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">setConfirmStateChange</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">confirmStateChange</span> <span class="o">=</span> <span class="nx">callback</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">onChangeState</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">onStateChangeCallbacks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">getState</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">state</span><span class="p">;</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-251'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-251">&#182;</a>
        </div>
        <p>set the state. This takes &ldquo;ViewDocument,&rdquo; &ldquo;ViewThumbnails&rdquo;, &ldquo;ViewText&rdquo;</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">setState</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">resetRemovedPages</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">resetRemovedPages</span><span class="p">();</span>
  <span class="p">},</span>

  <span class="nx">addPageToRemovedPages</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">page</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">addPageToRemovedPages</span><span class="p">(</span><span class="nx">page</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">removePageFromRemovedPages</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">page</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">removePageFromRemovedPages</span><span class="p">(</span><span class="nx">page</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">resetReorderedPages</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">redrawReorderedPages</span><span class="p">();</span>
  <span class="p">},</span>

  <span class="nx">reorderPages</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pageOrder</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">model</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getModelId</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">reorderPages</span><span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="nx">pageOrder</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-252'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-252">&#182;</a>
        </div>
        <p>Request the loading of an external JS file.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">loadJS</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">getScript</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-253'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-253">&#182;</a>
        </div>
        <p>Set first/last styles for tabs.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">roundTabCorners</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">tabs</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.DV-views &gt; div:visible&#39;</span><span class="p">);</span>
    <span class="nx">tabs</span><span class="p">.</span><span class="nx">first</span><span class="p">().</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;DV-first&#39;</span><span class="p">);</span>
    <span class="nx">tabs</span><span class="p">.</span><span class="nx">last</span><span class="p">().</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;DV-last&#39;</span><span class="p">);</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-254'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-254">&#182;</a>
        </div>
        <p>Register hooks into DV&rsquo;s hash history</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">registerHashListener</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">matcher</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="nx">matcher</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-255'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-255">&#182;</a>
        </div>
        <p>Clobber DV&rsquo;s existing history hooks</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">clearHashListeners</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">defaultCallback</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">handlers</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-256'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-256">&#182;</a>
        </div>
        <p>Unload the viewer.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">unload</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">viewer</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">unbindEvents</span><span class="p">();</span>
    <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">(</span><span class="s1">&#39;.DV-docViewer&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">container</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">stopCheckTimer</span><span class="p">();</span>
    <span class="k">delete</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">viewers</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">id</span><span class="p">];</span>
  <span class="p">},</span></pre></div>
      </td>
    </tr>
    <tr id='section-257'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-257">&#182;</a>
        </div>
        <p>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash; Enter/Leave Edit Modes &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="nx">enterRemovePagesMode</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">openEditor</span> <span class="o">=</span> <span class="s1">&#39;removePages&#39;</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">leaveRemovePagesMode</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">openEditor</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">enterAddPagesMode</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">openEditor</span> <span class="o">=</span> <span class="s1">&#39;addPages&#39;</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">leaveAddPagesMode</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">openEditor</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">enterReplacePagesMode</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">openEditor</span> <span class="o">=</span> <span class="s1">&#39;replacePages&#39;</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">leaveReplacePagesMode</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">openEditor</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">enterReorderPagesMode</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">openEditor</span> <span class="o">=</span> <span class="s1">&#39;reorderPages&#39;</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;DV-reorderPages&#39;</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">leaveReorderPagesMode</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">resetReorderedPages</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">openEditor</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;DV-reorderPages&#39;</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">enterEditPageTextMode</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">openEditor</span> <span class="o">=</span> <span class="s1">&#39;editText&#39;</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">loadText</span><span class="p">();</span>
  <span class="p">},</span>

  <span class="nx">leaveEditPageTextMode</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">.</span><span class="nx">openEditor</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">resetPageText</span><span class="p">();</span>
  <span class="p">}</span>

<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-258'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-258">&#182;</a>
        </div>
        <p>inherit main api</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">DV</span><span class="p">.</span><span class="nx">Api</span><span class="p">,</span> <span class="p">{</span>



<span class="p">});</span>
<span class="nx">DV</span><span class="p">.</span><span class="nx">DocumentViewer</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">options</span>        <span class="o">=</span> <span class="nx">options</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nb">window</span>         <span class="o">=</span> <span class="nb">window</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">$</span>              <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">schema</span>         <span class="o">=</span> <span class="k">new</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">Schema</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">api</span>            <span class="o">=</span> <span class="k">new</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">Api</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">history</span>        <span class="o">=</span> <span class="k">new</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">History</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-259'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-259">&#182;</a>
        </div>
        <p>Build the data models</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">models</span>     <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nx">models</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">events</span>     <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">Schema</span><span class="p">.</span><span class="nx">events</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span>    <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">Schema</span><span class="p">.</span><span class="nx">helpers</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">states</span>     <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">Schema</span><span class="p">.</span><span class="nx">states</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id='section-260'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-260">&#182;</a>
        </div>
        <p>state values</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">isFocus</span>            <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">openEditor</span>         <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">confirmStateChange</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">activeElement</span>      <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">observers</span>          <span class="o">=</span> <span class="p">[];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">windowDimensions</span>   <span class="o">=</span> <span class="p">{};</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">scrollPosition</span>     <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">checkTimer</span>         <span class="o">=</span> <span class="p">{};</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">busy</span>               <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">annotationToLoadId</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">dragReporter</span>       <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">compiled</span>           <span class="o">=</span> <span class="p">{};</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">tracker</span>            <span class="o">=</span> <span class="p">{};</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">onStateChangeCallbacks</span> <span class="o">=</span> <span class="p">[];</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">events</span>     <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">viewer</span>      <span class="o">:</span> <span class="k">this</span><span class="p">,</span>
    <span class="nx">states</span>      <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">states</span><span class="p">,</span>
    <span class="nx">elements</span>    <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">,</span>
    <span class="nx">helpers</span>     <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">,</span>
    <span class="nx">models</span>      <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">,</span></pre></div>
      </td>
    </tr>
    <tr id='section-261'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-261">&#182;</a>
        </div>
        <p>this allows us to bind events to call the method corresponding to the current state</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>    <span class="nx">compile</span>     <span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="kd">var</span> <span class="nx">a</span>           <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewer</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">methodName</span>  <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
      <span class="k">return</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">a</span><span class="p">.</span><span class="nx">events</span><span class="p">[</span><span class="nx">a</span><span class="p">.</span><span class="nx">state</span><span class="p">][</span><span class="nx">methodName</span><span class="p">]){</span>
          <span class="nx">a</span><span class="p">.</span><span class="nx">events</span><span class="p">[</span><span class="nx">methodName</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">events</span><span class="p">,</span><span class="nx">arguments</span><span class="p">);</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
          <span class="nx">a</span><span class="p">.</span><span class="nx">events</span><span class="p">[</span><span class="nx">a</span><span class="p">.</span><span class="nx">state</span><span class="p">][</span><span class="nx">methodName</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">events</span><span class="p">,</span><span class="nx">arguments</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">};</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span>  <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">viewer</span>      <span class="o">:</span> <span class="k">this</span><span class="p">,</span>
    <span class="nx">states</span>      <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">states</span><span class="p">,</span>
    <span class="nx">elements</span>    <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">,</span>
    <span class="nx">events</span>      <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">,</span>
    <span class="nx">models</span>      <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">models</span>
  <span class="p">});</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">states</span>   <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">states</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">viewer</span>      <span class="o">:</span> <span class="k">this</span><span class="p">,</span>
    <span class="nx">helpers</span>     <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">helpers</span><span class="p">,</span>
    <span class="nx">elements</span>    <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">elements</span><span class="p">,</span>
    <span class="nx">events</span>      <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">events</span><span class="p">,</span>
    <span class="nx">models</span>      <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">models</span>
  <span class="p">});</span>
<span class="p">};</span>

<span class="nx">DV</span><span class="p">.</span><span class="nx">DocumentViewer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">loadModels</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">chapters</span>     <span class="o">=</span> <span class="k">new</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">Chapters</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nb">document</span>     <span class="o">=</span> <span class="k">new</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">Document</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">pages</span>        <span class="o">=</span> <span class="k">new</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">Pages</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">annotations</span>  <span class="o">=</span> <span class="k">new</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">Annotations</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">removedPages</span> <span class="o">=</span> <span class="p">{};</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-262'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-262">&#182;</a>
        </div>
        <p>Transition to a given state &hellip; unless we&rsquo;re already in it.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">DocumentViewer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">open</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">==</span> <span class="nx">state</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">continuation</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">state</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">states</span><span class="p">[</span><span class="nx">state</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">slapIE</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">notifyChangedState</span><span class="p">();</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">confirmStateChange</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">confirmStateChange</span><span class="p">(</span><span class="nx">continuation</span><span class="p">)</span> <span class="o">:</span> <span class="nx">continuation</span><span class="p">();</span>
<span class="p">};</span>

<span class="nx">DV</span><span class="p">.</span><span class="nx">DocumentViewer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slapIE</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">container</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span><span class="nx">zoom</span><span class="o">:</span> <span class="mf">0.99</span><span class="p">}).</span><span class="nx">css</span><span class="p">({</span><span class="nx">zoom</span><span class="o">:</span> <span class="mi">1</span><span class="p">});</span>
<span class="p">};</span>

<span class="nx">DV</span><span class="p">.</span><span class="nx">DocumentViewer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">notifyChangedState</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">onStateChangeCallbacks</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span> <span class="nx">c</span><span class="p">();</span> <span class="p">});</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-263'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-263">&#182;</a>
        </div>
        <p>Record a hit on this document viewer.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">DocumentViewer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">recordHit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">hitUrl</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">loc</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">loc</span><span class="p">.</span><span class="nx">protocol</span> <span class="o">+</span> <span class="s1">&#39;//&#39;</span> <span class="o">+</span> <span class="nx">loc</span><span class="p">.</span><span class="nx">host</span> <span class="o">+</span> <span class="nx">loc</span><span class="p">.</span><span class="nx">pathname</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^file:/</span><span class="p">))</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">url</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[\/]+$/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">id</span>   <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">api</span><span class="p">.</span><span class="nx">getId</span><span class="p">(),</span> <span class="mi">10</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">key</span>  <span class="o">=</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="s1">&#39;document:&#39;</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="nx">url</span><span class="p">);</span>
  <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;&lt;img alt=&quot;&quot; width=&quot;1&quot; height=&quot;1&quot; src=&quot;&#39;</span> <span class="o">+</span> <span class="nx">hitUrl</span> <span class="o">+</span> <span class="s1">&#39;?key=&#39;</span> <span class="o">+</span> <span class="nx">key</span> <span class="o">+</span> <span class="s1">&#39;&quot; /&gt;&#39;</span><span class="p">);</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-264'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-264">&#182;</a>
        </div>
        <p>jQuery object, scoped to this viewer&rsquo;s container.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">DocumentViewer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">jQuery</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">selector</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">context</span> <span class="o">=</span> <span class="nx">context</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">container</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">,</span> <span class="nx">selector</span><span class="p">,</span> <span class="nx">context</span><span class="p">);</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-265'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-265">&#182;</a>
        </div>
        <p>The origin function, kicking off the entire documentViewer render.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nx">DV</span><span class="p">.</span><span class="nx">load</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">documentRep</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>
  <span class="kd">var</span> <span class="nx">id</span>  <span class="o">=</span> <span class="nx">documentRep</span><span class="p">.</span><span class="nx">id</span> <span class="o">||</span> <span class="nx">documentRep</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/([^\/]+)(\.js|\.json)$/</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span>
  <span class="kd">var</span> <span class="nx">defaults</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">container</span> <span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span>
    <span class="nx">zoom</span>      <span class="o">:</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>
    <span class="nx">sidebar</span>   <span class="o">:</span> <span class="kc">true</span>
  <span class="p">};</span>
  <span class="nx">options</span>            <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">defaults</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
  <span class="nx">options</span><span class="p">.</span><span class="nx">fixedSize</span>  <span class="o">=</span> <span class="o">!!</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">width</span> <span class="o">||</span> <span class="nx">options</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">viewer</span>         <span class="o">=</span> <span class="k">new</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">DocumentViewer</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
  <span class="nx">DV</span><span class="p">.</span><span class="nx">viewers</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span>     <span class="o">=</span> <span class="nx">viewer</span><span class="p">;</span></pre></div>
      </td>
    </tr>
    <tr id='section-266'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-266">&#182;</a>
        </div>
        <p>Once we have the JSON representation in-hand, finish loading the viewer.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="kd">var</span> <span class="nx">continueLoad</span> <span class="o">=</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">loadJSON</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">json</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">viewer</span> <span class="o">=</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">viewers</span><span class="p">[</span><span class="nx">json</span><span class="p">.</span><span class="nx">id</span><span class="p">];</span>
    <span class="nx">viewer</span><span class="p">.</span><span class="nx">schema</span><span class="p">.</span><span class="nx">importCanonicalDocument</span><span class="p">(</span><span class="nx">json</span><span class="p">);</span>
    <span class="nx">viewer</span><span class="p">.</span><span class="nx">loadModels</span><span class="p">();</span>
    <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">viewer</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;InitialLoad&#39;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">afterLoad</span><span class="p">)</span> <span class="nx">options</span><span class="p">.</span><span class="nx">afterLoad</span><span class="p">(</span><span class="nx">viewer</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">DV</span><span class="p">.</span><span class="nx">afterLoad</span><span class="p">)</span> <span class="nx">DV</span><span class="p">.</span><span class="nx">afterLoad</span><span class="p">(</span><span class="nx">viewer</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">DV</span><span class="p">.</span><span class="nx">recordHit</span><span class="p">)</span> <span class="nx">viewer</span><span class="p">.</span><span class="nx">recordHit</span><span class="p">(</span><span class="nx">DV</span><span class="p">.</span><span class="nx">recordHit</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-267'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-267">&#182;</a>
        </div>
        <p>If we&rsquo;ve been passed the JSON directly, we can go ahead,
otherwise make a JSONP request to fetch it.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="kd">var</span> <span class="nx">jsonLoad</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">documentRep</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">documentRep</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/\.js$/</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">getScript</span><span class="p">(</span><span class="nx">documentRep</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">crossDomain</span> <span class="o">=</span> <span class="nx">viewer</span><span class="p">.</span><span class="nx">helpers</span><span class="p">.</span><span class="nx">isCrossDomain</span><span class="p">(</span><span class="nx">documentRep</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">crossDomain</span><span class="p">)</span> <span class="nx">documentRep</span> <span class="o">=</span> <span class="nx">documentRep</span> <span class="o">+</span> <span class="s1">&#39;?callback=?&#39;</span><span class="p">;</span>
        <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="nx">documentRep</span><span class="p">,</span> <span class="nx">continueLoad</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">continueLoad</span><span class="p">(</span><span class="nx">documentRep</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-268'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-268">&#182;</a>
        </div>
        <p>If we&rsquo;re being asked the fetch the templates, load them remotely before
continuing.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">templates</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">DV</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">getScript</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">templates</span><span class="p">,</span> <span class="nx">jsonLoad</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">jsonLoad</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">viewer</span><span class="p">;</span>
<span class="p">};</span></pre></div>
      </td>
    </tr>
    <tr id='section-269'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-269">&#182;</a>
        </div>
        <p>If the document viewer has been loaded dynamically, allow the external
script to specify the onLoad behavior.</p>

      </td>
      <td class=code>
        <div class='highlight'><pre><span class="k">if</span> <span class="p">(</span><span class="nx">DV</span><span class="p">.</span><span class="nx">onload</span><span class="p">)</span> <span class="nx">_</span><span class="p">.</span><span class="nx">defer</span><span class="p">(</span><span class="nx">DV</span><span class="p">.</span><span class="nx">onload</span><span class="p">);</span></pre></div>
      </td>
    </tr>
  </table>
</div>
</body>
